<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Interactive SATs Practice</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=OpenDyslexic:wght@400;700&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* CSS Custom Properties for Modern Clean Theme */
        :root {
            /* Modern Golden Theme Palette */
            --quest-blue: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
            --forest-green: linear-gradient(135deg, #166534 0%, #15803d 100%);
            --deep-teal: linear-gradient(135deg, #0f766e 0%, #0d9488 100%);
            --mountain-gray: linear-gradient(135deg, #374151 0%, #4b5563 100%);
            --ocean-blue: linear-gradient(135deg, #1e40af 0%, #2563eb 100%);
            --amber-gold: linear-gradient(135deg, #d97706 0%, #f59e0b 100%);
            --iron-slate: linear-gradient(135deg, #475569 0%, #64748b 100%);
            --royal-gold: linear-gradient(135deg, #ca8a04 0%, #eab308 100%);
            --emerald-forest: linear-gradient(135deg, #047857 0%, #059669 100%);
            
            /* Core Modern Theme */
            --primary-color: #fbbf24;
            --secondary-color: #f59e0b;
            --accent-color: #d97706;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #dc2626;
            --text-color: #1f2937;
            --text-light: #6b7280;
            --background: #f8fafc;
            --card-bg: white;
            --border-color: #f1f5f9;
            --font-family: 'Inter', sans-serif;
            --font-size: 16px;
            --line-height: 1.6;
        }

        /* High Contrast Theme */
        [data-theme="high-contrast"] {
            --primary-color: #000000;
            --secondary-color: #000000;
            --accent-color: #000000;
            --success-color: #008000;
            --warning-color: #b45309;
            --error-color: #dc2626;
            --text-color: #000000;
            --text-light: #374151;
            --background: #ffffff;
            --card-bg: #ffffff;
            --border-color: #000000;
        }

        /* Dark Theme */
        [data-theme="dark"] {
            --primary-color: #fbbf24;
            --secondary-color: #f59e0b;
            --accent-color: #d97706;
            --success-color: #10b981;
            --warning-color: #fbbf24;
            --error-color: #f87171;
            --text-color: #f9fafb;
            --text-light: #d1d5db;
            --background: #111827;
            --card-bg: #1f2937;
            --border-color: #374151;
        }

        /* Dark Theme Body Override */
        [data-theme="dark"] body {
            background: #111827 !important;
            color: #f9fafb !important;
        }

        /* High Contrast Body Override */
        [data-theme="high-contrast"] body {
            background: #ffffff !important;
            color: #000000 !important;
        }

        /* Pack Title Theme Overrides */
        [data-theme="dark"] .pack-title {
            color: #f9fafb !important;
        }

        [data-theme="high-contrast"] .pack-title {
            color: #000000 !important;
        }

        /* Font Family Classes */
        .font-inter { font-family: 'Inter', sans-serif; }
        .font-dyslexic { font-family: 'OpenDyslexic', sans-serif; }
        .font-comic { font-family: 'Comic Neue', cursive; }
        .font-system { font-family: system-ui, -apple-system, sans-serif; }

        /* Font Size Classes */
        .text-small { font-size: 14px; }
        .text-normal { font-size: 16px; }
        .text-large { font-size: 18px; }
        .text-xl { font-size: 20px; }
        .text-xxl { font-size: 24px; }

        /* Line Height Classes */
        .leading-normal { line-height: 1.5; }
        .leading-relaxed { line-height: 1.625; }
        .leading-loose { line-height: 2; }

        /* CSS Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            font-size: var(--font-size);
            line-height: var(--line-height);
            color: var(--text-color);
            background: #f8fafc;
            min-height: 100vh;
            transition: all 0.3s ease;
            overflow-x: hidden;
            position: relative;
        }

        /* Premium 3D Floating Elements */
        .background-particles {
            display: none;
        }

        .floating-element {
            position: absolute;
            font-size: 2rem;
            animation: elementFloat 8s infinite ease-in-out;
            transform-style: preserve-3d;
            opacity: 0.7;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
        }

        .floating-element.book { left: 8%; top: 15%; animation-delay: 0s; }
        .floating-element.calculator { right: 12%; top: 25%; animation-delay: 1s; }
        .floating-element.globe { left: 15%; bottom: 30%; animation-delay: 2s; }
        .floating-element.pencil { right: 8%; bottom: 20%; animation-delay: 3s; }
        .floating-element.star { left: 25%; top: 35%; animation-delay: 4s; font-size: 1.5rem; }
        .floating-element.trophy { right: 25%; top: 45%; animation-delay: 5s; }
        .floating-element.lightbulb { left: 5%; top: 60%; animation-delay: 1.5s; }
        .floating-element.medal { right: 5%; top: 70%; animation-delay: 2.5s; }

        @keyframes elementFloat {
            0%, 100% { 
                transform: translateY(0px) rotateY(0deg) rotateX(0deg); 
                opacity: 0.6; 
            }
            25% { 
                transform: translateY(-20px) rotateY(90deg) rotateX(10deg); 
                opacity: 0.8; 
            }
            50% { 
                transform: translateY(-40px) rotateY(180deg) rotateX(0deg); 
                opacity: 1; 
            }
            75% { 
                transform: translateY(-20px) rotateY(270deg) rotateX(-10deg); 
                opacity: 0.8; 
            }
        }

        /* Sparkle Effects */
        .sparkle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            border-radius: 50%;
            animation: sparkleAnimation 3s infinite ease-in-out;
        }

        .sparkle:nth-child(1) { left: 20%; top: 20%; animation-delay: 0s; }
        .sparkle:nth-child(2) { right: 30%; top: 40%; animation-delay: 1s; }
        .sparkle:nth-child(3) { left: 60%; bottom: 25%; animation-delay: 2s; }
        .sparkle:nth-child(4) { right: 15%; bottom: 40%; animation-delay: 0.5s; }
        .sparkle:nth-child(5) { left: 80%; top: 60%; animation-delay: 1.5s; }

        @keyframes sparkleAnimation {
            0%, 100% { opacity: 0; transform: scale(0) rotate(0deg); }
            50% { opacity: 1; transform: scale(1) rotate(180deg); }
        }

        /* Skip Link for Screen Readers */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--primary-color);
            color: white;
            padding: 8px;
            text-decoration: none;
            border-radius: 4px;
            z-index: 1000;
        }

        .skip-link:focus {
            top: 6px;
        }

        /* Focus Indicators */
        *:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        button:focus,
        input:focus,
        .option:focus {
            outline: 3px solid var(--primary-color);
            outline-offset: 2px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* Creative Glassmorphism Cards */
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }

        .glass-card:hover::before {
            left: 100%;
        }

        .glass-card:hover {
            transform: translateY(-10px) rotateX(5deg);
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
        }



        /* Settings Panel */
        .settings-panel {
            position: fixed;
            top: 0;
            right: -350px;
            width: 350px;
            height: 100vh;
            background: white;
            border-left: 1px solid #f1f5f9;
            box-shadow: -4px 0 20px rgba(0,0,0,0.08);
            transition: right 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
            padding: 24px;
        }

        .settings-panel.open {
            right: 0;
        }

        .settings-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.3rem;
            font-weight: 400;
            z-index: 1001;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            -webkit-font-smoothing: antialiased;
            text-rendering: optimizeLegibility;
        }

        .settings-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(251, 191, 36, 0.4);
        }

        .settings-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 32px;
            color: #1f2937;
            border-bottom: 1px solid #f1f5f9;
            padding-bottom: 16px;
        }

        .setting-group {
            margin-bottom: 32px;
        }

        .setting-label {
            display: block;
            font-weight: 600;
            margin-bottom: 12px;
            color: #1f2937;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .setting-options {
            display: grid;
            gap: 10px;
        }

        .setting-option {
            background: #f9fafb;
            border: 1px solid #f1f5f9;
            border-radius: 12px;
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #1f2937;
            text-align: left;
            font-weight: 500;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .setting-option:hover {
            border-color: #fbbf24;
            background: #fffbeb;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.15);
        }

        .setting-option.active {
            border-color: #fbbf24;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .volume-slider {
            flex: 1;
            height: 6px;
            background: #f1f5f9;
            border-radius: 3px;
            outline: none;
            appearance: none;
        }

        .volume-slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(251, 191, 36, 0.3);
        }

        .volume-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            border-radius: 50%;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(251, 191, 36, 0.3);
        }

        /* Sound Effects Toggle */
        .sound-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            background: #f9fafb;
            border: 1px solid #f1f5f9;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .sound-toggle:hover {
            border-color: #fbbf24;
            background: #fffbeb;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.15);
        }

        .sound-toggle.active {
            border-color: #10b981;
            background: #d1fae5;
            color: #047857;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 25px;
            background: var(--border-color);
            border-radius: 25px;
            transition: background 0.3s ease;
        }

        .toggle-switch.active {
            background: var(--success-color);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 21px;
            height: 21px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .toggle-switch.active::after {
            transform: translateX(25px);
        }

        /* Daily Challenge Card - Compact */
        .daily-challenge {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 4px 16px rgba(59, 130, 246, 0.3);
            transition: all 0.2s ease;
        }

        .daily-challenge::before {
            display: none;
        }

        .daily-challenge:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(59, 130, 246, 0.4);
        }

        .challenge-title {
            font-size: 1rem;
            font-weight: 600;
            color: white;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .challenge-description {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .challenge-progress {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .challenge-bar {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            margin-right: 12px;
            overflow: hidden;
        }

        .challenge-fill {
            height: 100%;
            background: white;
            border-radius: 4px;
            transition: width 0.3s ease;
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.5);
        }

        /* Streak Counter - Compact */
        .streak-counter {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.2s ease;
        }

        .streak-counter:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.4);
        }

        .streak-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            margin: 0;
        }

        .streak-label {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.9);
        }

        .streak-fire {
            font-size: 1.5rem;
            animation: flicker 1.5s infinite alternate;
            position: static;
        }

        @keyframes flicker {
            0% { transform: scale(1) rotate(-2deg); }
            100% { transform: scale(1.1) rotate(2deg); }
        }

        /* Welcome Screen */
        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
            color: #1f2937;
            padding: 40px 20px;
            background: transparent;
        }

        .welcome-logo {
            width: 150px;
            height: 150px;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            margin-bottom: 40px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 10px 40px rgba(245, 158, 11, 0.4);
            overflow: hidden;
        }

        .logo-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .welcome-logo::before {
            display: none;
        }

        .welcome-logo:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(245, 158, 11, 0.4);
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(5deg); }
        }

        @keyframes logoSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }



        .welcome-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 16px;
            color: #1f2937;
            letter-spacing: -0.025em;
        }

        .welcome-subtitle {
            font-size: 1.1rem;
            margin-bottom: 48px;
            color: #6b7280;
            max-width: 500px;
            line-height: 1.5;
        }

        .name-input-container {
            background: white;
            border-radius: 24px;
            padding: 32px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            border: 1px solid #f1f5f9;
            max-width: 400px;
            width: 100%;
        }

        .name-input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            font-size: 1rem;
            font-weight: 500;
            text-align: center;
            background: #f8fafc;
            margin-bottom: 20px;
            transition: all 0.2s ease;
            color: #1f2937;
        }

        .name-input:focus {
            outline: none;
            border-color: #fbbf24;
            background: white;
            box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.1);
        }

        .start-btn {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 16px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
            width: 100%;
        }

        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(251, 191, 36, 0.4);
        }

        /* Dashboard */
        .dashboard {
            display: none;
            padding: 20px 0;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            background: white;
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            border: 1px solid #f1f5f9;
            gap: 16px;
            flex-wrap: wrap;
        }

        .user-info {
            display: flex;
            align-items: center;
            color: #1f2937;
            flex: 1;
            min-width: 0;
        }



        .user-details {
            flex: 1;
            min-width: 0;
        }

        .user-details h2 {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 8px;
            line-height: 1.2;
        }

        .user-stats {
            font-size: 1rem;
            opacity: 0.9;
        }

        .level-badge {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            padding: 8px 16px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.85rem;
            box-shadow: 0 2px 8px rgba(251, 191, 36, 0.2);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            flex-shrink: 0;
            white-space: nowrap;
        }

        .level-badge:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
        }
        
        /* Responsive adjustments for long names */
        @media (max-width: 480px) {
            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 20px;
            }
            
            .user-info {
                max-width: 100%;
                width: 100%;
            }
            
            .level-badge {
                align-self: flex-end;
            }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: white;
            border-radius: 16px;
            padding: 20px 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            border: 1px solid #f1f5f9;
            transition: all 0.2s ease;
            position: relative;
            text-align: center;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .stat-card::before {
            display: none;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
        }

        /* Animated Counter Numbers */
        .stat-value {
            font-size: 2.25rem;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
            line-height: 1;
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stat-value.counting {
            animation: numberPulse 0.4s ease;
        }

        @keyframes numberPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); color: #fbbf24; }
            100% { transform: scale(1); }
        }

        .stat-card h3 {
            color: #6b7280;
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 8px;
            flex-shrink: 0;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .stat-label {
            color: #6b7280;
            font-size: 0.75rem;
            opacity: 0.8;
            flex-shrink: 0;
            margin-top: 4px;
        }

        .progress-ring-background {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            z-index: 0;
            pointer-events: none;
        }

        .progress-ring-bg,
        .progress-ring-fill {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }

        .progress-ring-bg {
            background: #e5e7eb;
            border-radius: 50%;
            border: none;
        }

        .progress-ring-fill {
            background: conic-gradient(#d97706 0deg, #d97706 0deg, transparent 0deg);
            border-radius: 50%;
            transition: all 0.3s ease;
            border: none;
        }



        /* Topic Selection */
        .topics-section {
            background: white;
            border-radius: 24px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            border: 1px solid #f1f5f9;
        }

        .section-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 32px;
            text-align: center;
            letter-spacing: -0.025em;
            line-height: 1.2;
        }

        .subject-section {
            margin-bottom: 40px;
        }

        .subject-title {
            font-size: 1.25rem;
            color: #374151;
            margin-bottom: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .subject-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1rem;
        }

        .topic-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        @media (max-width: 600px) {
            .topic-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
        }

        .topic-card {
            background: white;
            border: 1px solid #f1f5f9;
            border-radius: 16px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            color: #1f2937;
            font-weight: 500;
            font-size: 1rem;
            text-align: left;
            min-height: 140px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        /* Vibrant Topic Colors */
        .topic-card[data-topic="arithmetic"] {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            border: none;
        }

        .topic-card[data-topic="number-place-value"] {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
        }

        .topic-card[data-topic="fractions-decimals"] {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
        }

        .topic-card[data-topic="geometry"] {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            border: none;
        }

        .topic-card[data-topic="measurement"] {
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            color: white;
            border: none;
        }

        .topic-card[data-topic="grammar-punctuation"] {
            background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
            color: white;
            border: none;
        }

        .topic-card[data-topic="spelling"] {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            color: white;
            border: none;
        }

        .topic-card[data-topic="reading-comprehension"] {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
        }

        /* Dark Mode Topic Card Overrides */
        [data-theme="dark"] .topic-card[data-topic="arithmetic"] {
            background: linear-gradient(135deg, #d97706 0%, #b45309 100%) !important;
        }

        [data-theme="dark"] .topic-card[data-topic="number-place-value"] {
            background: linear-gradient(135deg, #059669 0%, #047857 100%) !important;
        }

        [data-theme="dark"] .topic-card[data-topic="fractions-decimals"] {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%) !important;
        }

        [data-theme="dark"] .topic-card[data-topic="geometry"] {
            background: linear-gradient(135deg, #16a34a 0%, #15803d 100%) !important;
        }

        [data-theme="dark"] .topic-card[data-topic="measurement"] {
            background: linear-gradient(135deg, #4f46e5 0%, #4338ca 100%) !important;
        }

        [data-theme="dark"] .topic-card[data-topic="grammar-punctuation"] {
            background: linear-gradient(135deg, #9333ea 0%, #7c3aed 100%) !important;
        }

        [data-theme="dark"] .topic-card[data-topic="spelling"] {
            background: linear-gradient(135deg, #475569 0%, #374151 100%) !important;
        }

        [data-theme="dark"] .topic-card[data-topic="reading-comprehension"] {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%) !important;
        }

        /* Dark Mode Card Overrides */
        [data-theme="dark"] .daily-challenge {
            background: linear-gradient(135deg, #1e40af, #1d4ed8) !important;
        }

        [data-theme="dark"] .streak-counter {
            background: linear-gradient(135deg, #059669, #047857) !important;
        }

        /* High Contrast Topic Card Overrides */
        [data-theme="high-contrast"] .topic-card {
            background: #ffffff !important;
            color: #000000 !important;
            border: 3px solid #000000 !important;
        }

        [data-theme="high-contrast"] .daily-challenge {
            background: #ffffff !important;
            color: #000000 !important;
            border: 3px solid #000000 !important;
        }

        [data-theme="high-contrast"] .streak-counter {
            background: #ffffff !important;
            color: #000000 !important;
            border: 3px solid #000000 !important;
        }

        /* Modern Hover Effects */
        .topic-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(0,0,0,0.15);
        }

        .topic-card:active {
            transform: translateY(0);
        }

        /* Completion Badge */
        .completion-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 4px 8px;
            font-size: 0.625rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #6b7280;
        }

        .completion-badge.completed {
            background: #d1fae5;
            border-color: #10b981;
            color: #047857;
        }

        /* Topic Icons */
        .topic-icon {
            font-size: 2.5rem;
            margin-bottom: 16px;
        }

        /* Topic icons - white on colored backgrounds */
        .topic-card .topic-icon { 
            color: rgba(255, 255, 255, 0.9); 
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }

        .topic-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: #1f2937;
            line-height: 1.3;
            text-shadow: none;
        }

        .topic-description {
            font-size: 0.95rem;
            color: #6b7280;
            line-height: 1.4;
            margin-bottom: 12px;
        }

        .topic-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.9);
            margin-top: 8px;
        }

        .topic-best-score {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.75rem;
            color: white;
            backdrop-filter: blur(10px);
        }

        /* Quiz Type Selection */
        .quiz-type-container {
            display: none;
            padding: 40px 20px;
        }

        .quiz-type-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .quiz-type-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 10px;
        }

        .quiz-type-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            max-width: 800px;
            margin: 0 auto;
        }

        @media (max-width: 700px) {
            .quiz-type-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        .quiz-type-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 2px solid #f1f5f9;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .quiz-type-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
        }

        .quiz-type-card.quick-quiz {
            border-top: 4px solid #3b82f6;
        }

        .quiz-type-card.full-practice {
            border-top: 4px solid #10b981;
        }

        .quiz-type-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            animation: bounce 2s infinite;
        }

        .quiz-type-card .quiz-type-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 8px;
        }

        .quiz-type-subtitle {
            font-size: 1rem;
            color: #6b7280;
            margin-bottom: 20px;
        }

        .quiz-type-details {
            margin: 20px 0 30px 0;
        }

        .detail-item {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
            font-size: 0.95rem;
            color: #374151;
        }

        .detail-icon {
            font-size: 1.1rem;
        }

        .quiz-type-btn {
            width: 100%;
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .quiz-type-btn.primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .quiz-type-btn.primary:hover {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }

        .quiz-type-btn.secondary {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .quiz-type-btn.secondary:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }

        @media (max-width: 768px) {
            .quiz-type-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .quiz-type-card {
                padding: 25px 20px;
            }
            
            .quiz-type-title {
                font-size: 1.75rem;
            }
        }

        /* Quiz Interface */
        .quiz-container {
            display: none;
        }

        .quiz-header {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid #f1f5f9;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            color: #1f2937;
        }

        .quiz-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .back-btn {
            background: #f9fafb;
            border: 1px solid #f1f5f9;
            color: #1f2937;
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .back-btn:hover {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            border-color: #fbbf24;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
        }

        .quiz-title {
            font-size: 1.8rem;
            font-weight: 600;
            text-align: center;
            flex: 1;
        }

        .hint-btn {
            background: linear-gradient(135deg, #f59e0b, #f97316);
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .hint-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
        }

        .quiz-progress {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .progress-bar {
            flex: 1;
            height: 6px;
            background: #f1f5f9;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #fbbf24, #f59e0b);
            transition: width 0.3s ease;
            border-radius: 3px;
        }

        .progress-text {
            font-weight: 600;
            min-width: 120px;
            text-align: right;
        }

        .question-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .spelling-feedback {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 12px 16px;
            border-radius: 12px;
            margin-top: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            animation: slideInUp 0.3s ease;
        }

        .feedback-icon {
            font-size: 1.2rem;
        }

        .feedback-text strong {
            color: #fbbf24;
            font-weight: 700;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .question-number {
            color: #1e40af;
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .passage-text {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            font-size: 1.1rem;
            line-height: 1.7;
            color: #374151;
            font-style: italic;
        }

        .question-text {
            font-size: 1.4rem;
            font-weight: 500;
            margin-bottom: 30px;
            line-height: 1.6;
            color: #1f2937;
        }

        .hint-box {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-left: 4px solid #f59e0b;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            display: none;
        }

        .hint-box.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .hint-icon {
            color: #f59e0b;
            font-size: 1.2rem;
            margin-right: 10px;
        }

        .hint-text {
            color: #92400e;
            font-weight: 500;
        }

        .options-container {
            margin-bottom: 30px;
        }

        .option {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 500;
        }

        .option:hover {
            border-color: #1e40af;
            background: #eff6ff;
            transform: translateX(5px);
        }

        .option.selected {
            border-color: #1e40af;
            background: linear-gradient(135deg, #1e40af, #059669);
            color: white;
            transform: translateX(5px);
        }

        .option-letter {
            width: 30px;
            height: 30px;
            background: #e2e8f0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .option.selected .option-letter {
            background: rgba(255, 255, 255, 0.3);
            color: white;
        }

        .text-input {
            width: 100%;
            padding: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: 500;
            transition: all 0.3s ease;
            background: #f8fafc;
        }

        .text-input:focus {
            outline: none;
            border-color: #1e40af;
            background: white;
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .quiz-navigation {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-top: 40px;
            padding: 0 20px;
        }

        .prev-btn, .next-btn, .finish-btn {
            flex: 1;
            max-width: 140px;
            height: 50px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .prev-btn {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .prev-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .prev-btn:disabled {
            background: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .next-btn {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
        }

        .next-btn:hover {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4);
        }

        .finish-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            min-width: 140px;
        }

        .finish-btn:hover {
            background: linear-gradient(135deg, #047857, #065f46);
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
        }



        .nav-btn {
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Submit Section */
        .submit-section {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #f1f5f9;
        }

        .submit-btn {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .submit-btn:hover {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }

        .submit-btn:disabled {
            background: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Feedback Interface */
        .feedback-container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 25px;
            padding: 40px;
            margin: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            border: 2px solid #f1f5f9;
            text-align: center;
            animation: slideInUp 0.4s ease;
        }

        .feedback-result {
            margin-bottom: 30px;
        }

        .feedback-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            animation: bounceIn 0.6s ease;
        }

        .feedback-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: #1f2937;
        }

        .feedback-title.correct {
            color: #10b981;
        }

        .feedback-title.incorrect {
            color: #4b5563;
        }

        .feedback-message {
            font-size: 1.2rem;
            color: #6b7280;
            margin-bottom: 20px;
        }

        .feedback-explanation {
            background: #f8fafc;
            border-radius: 15px;
            padding: 20px;
            margin: 25px 0;
            text-align: left;
            border-left: 4px solid #3b82f6;
        }

        .explanation-title {
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 10px;
        }

        .explanation-text {
            color: #4b5563;
            line-height: 1.6;
        }

        .feedback-score {
            background: #f8fafc;
            color: #1f2937;
            border-radius: 15px;
            padding: 15px 20px;
            margin: 25px 0;
            border: 2px solid #e5e7eb;
            text-align: center;
        }

        .score-text {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .streak-text {
            font-size: 1rem;
            opacity: 0.9;
        }

        .feedback-navigation {
            margin-top: 30px;
        }

        .feedback-btn {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            border: none;
            padding: 22px 55px;
            border-radius: 18px;
            font-size: 1.4rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.4);
            width: 100%;
            max-width: 300px;
        }

        .feedback-btn:hover {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(251, 191, 36, 0.4);
        }

        /* Animations */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.1);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }





        /* Results Screen */
        .results-container {
            display: none;
        }

        .results-header {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 25px 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
        }

        .results-score {
            font-size: 4rem;
            font-weight: 700;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #10b981, #059669);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .results-message {
            font-size: 1.4rem;
            margin-bottom: 20px;
            opacity: 0.9;
        }

        .results-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .result-stat {
            text-align: center;
        }

        .result-stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .result-stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .results-summary {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px 20px;
            margin-bottom: 20px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }

        .summary-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 20px;
            text-align: center;
        }

        .result-item {
            background: #f8fafc;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            border-left: 4px solid #e2e8f0;
        }

        .result-item.correct {
            border-left-color: #10b981;
            background: linear-gradient(135deg, #ecfdf5, #f0fdf4);
        }

        .result-item.incorrect {
            border-left-color: #ef4444;
            background: linear-gradient(135deg, #fef2f2, #fef7f7);
        }

        .result-question {
            font-weight: 600;
            margin-bottom: 10px;
            color: #1f2937;
        }

        .result-answers {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .result-answer {
            font-weight: 500;
        }

        .correct-answer {
            color: #059669;
        }

        .incorrect-answer {
            color: #dc2626;
        }

        .results-actions {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .action-btn {
            background: linear-gradient(135deg, #1e40af, #059669);
            color: white;
            border: none;
            padding: 18px 35px;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(30, 64, 175, 0.3);
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(30, 64, 175, 0.4);
        }

        .action-btn.secondary {
            background: linear-gradient(135deg, #64748b, #475569);
        }

        /* Achievements */
        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .achievement-popup.show {
            display: block;
            animation: achievementPop 0.5s ease;
        }

        @keyframes achievementPop {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .achievement-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .achievement-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .achievement-description {
            opacity: 0.9;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .welcome-title {
                font-size: 2.5rem;
            }

            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
            }

            .topic-grid {
                grid-template-columns: 1fr;
            }

            .quiz-nav {
                flex-direction: column;
                gap: 15px;
            }

            .quiz-title {
                order: -1;
            }

            .quiz-navigation {
                flex-direction: row;
                gap: 10px;
                justify-content: center;
            }

            .nav-btn {
                flex: 1;
                max-width: 140px;
            }

            .results-actions {
                flex-direction: column;
            }

            .action-btn {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .welcome-title {
                font-size: 2rem;
            }

            .section-title {
                font-size: 1.6rem;
            }

            .question-text {
                font-size: 1.2rem;
            }

            .results-score {
                font-size: 3rem;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Hide scrollbar but keep functionality */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.5);
        }

        /* Pack Selection Styles */
        .pack-selection-container {
            padding-top: 40px;
        }

        .pack-selection-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .pack-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1f2937;
            text-shadow: none;
            margin: 20px 0;
        }

        .pack-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            max-width: 900px;
            margin: 0 auto;
        }

        @media (max-width: 650px) {
            .pack-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        .pack-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .pack-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.15);
        }

        .pack-card.locked {
            opacity: 0.6;
            background: rgba(255,255,255,0.5);
        }

        .pack-card.locked:hover {
            transform: none;
        }

        .pack-badge {
            display: inline-block;
            font-size: 2rem;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 50%;
            background: var(--card-bg);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .pack-badge.bronze {
            background: linear-gradient(135deg, #cd7f32, #b8860b);
            color: white;
        }

        .pack-badge.silver {
            background: linear-gradient(135deg, #c0c0c0, #a8a8a8);
            color: white;
        }

        .pack-badge.gold {
            background: linear-gradient(135deg, #ffd700, #ffb347);
            color: white;
        }

        .pack-icon {
            font-size: 3rem;
            margin-bottom: 20px;
        }

        .pack-card .pack-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-color);
            background: none;
            background-clip: unset;
            -webkit-background-clip: unset;
            -webkit-text-fill-color: unset;
        }

        .pack-description {
            color: var(--text-light);
            margin-bottom: 20px;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .pack-requirement {
            background: rgba(var(--warning-color), 0.1);
            color: var(--warning-color);
            padding: 8px 16px;
            border-radius: 12px;
            font-size: 0.85rem;
            margin-bottom: 20px;
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .pack-progress {
            margin-bottom: 25px;
        }

        .pack-progress-bar {
            background: rgba(0,0,0,0.1);
            border-radius: 10px;
            height: 8px;
            margin-bottom: 8px;
            overflow: hidden;
        }

        .pack-progress-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--success-color), #34d399);
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s ease;
        }

        .pack-progress-text {
            font-size: 0.85rem;
            color: var(--text-light);
            font-weight: 500;
        }

        .pack-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .pack-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .pack-btn:disabled,
        .pack-btn.locked {
            background: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        @media (max-width: 768px) {
            .pack-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .pack-title {
                font-size: 2rem;
                color: #1f2937;
                text-shadow: none;
            }
            
            .pack-card {
                padding: 20px;
            }
        }

        /* ===== MAGICAL SCHOLAR'S ADVENTURE GAMIFICATION SYSTEM ===== */

        /* Scholar Rank Display */
        .scholar-rank {
            display: flex;
            align-items: center;
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            padding: 12px 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        .scholar-rank:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }

        .rank-icon {
            font-size: 1.8rem;
            margin-right: 12px;
        }

        .rank-details {
            display: flex;
            flex-direction: column;
        }

        .rank-level {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 2px;
        }

        .rank-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        /* XP Progress Section */
        .xp-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 2px solid #f1f5f9;
        }

        .xp-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .xp-label {
            font-weight: 600;
            color: #1f2937;
            font-size: 1.1rem;
        }

        .xp-numbers {
            font-weight: 500;
            color: #6b7280;
        }

        .xp-progress-bar {
            position: relative;
            background: #e5e7eb;
            border-radius: 25px;
            height: 12px;
            overflow: hidden;
        }

        .xp-fill {
            background: linear-gradient(90deg, #10b981, #34d399);
            height: 100%;
            border-radius: 25px;
            transition: width 0.5s ease;
            position: relative;
        }

        .xp-sparkle {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8rem;
            animation: sparkle 2s infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0.6; transform: translateY(-50%) scale(1); }
            50% { opacity: 1; transform: translateY(-50%) scale(1.2); }
        }



        /* Main Navigation Grid */
        .main-navigation-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 25px 0;
        }

        .main-nav-btn {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border: none;
            border-radius: 20px;
            padding: 25px;
            text-align: left;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.2);
            display: flex;
            align-items: center;
            gap: 15px;
            min-height: 100px;
            width: 100%;
        }

        .main-nav-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(59, 130, 246, 0.3);
        }

        .main-nav-btn.practice-btn {
            background: linear-gradient(135deg, #10b981, #047857);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.2);
        }

        .main-nav-btn.practice-btn:hover {
            box-shadow: 0 15px 35px rgba(16, 185, 129, 0.3);
        }

        .nav-icon {
            font-size: 2.5rem;
            filter: drop-shadow(0 2px 4px rgba(255,255,255,0.3));
        }

        .nav-content {
            flex: 1;
            color: white;
        }

        .nav-content h3 {
            font-size: 1.3rem;
            font-weight: 700;
            margin: 0 0 5px 0;
            color: white;
        }

        .nav-content p {
            font-size: 0.9rem;
            margin: 0;
            opacity: 0.9;
            color: rgba(255,255,255,0.8);
        }

        .nav-arrow {
            font-size: 1.8rem;
            font-weight: bold;
            color: rgba(255,255,255,0.8);
            margin-left: auto;
        }

        @media (max-width: 768px) {
            .main-navigation-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .main-nav-btn {
                padding: 20px;
            }
            
            .nav-content h3 {
                font-size: 1.1rem;
            }
        }

        /* Adventure Hub Stats Grid */
        .adventure-hub-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        /* Quest Map Container */
        .quest-map-container {
            padding: 20px;
        }

        .quest-map-header {
            margin-bottom: 30px;
        }

        .quest-map-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 40px;
        }

        .quest-path {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            width: 100%;
            max-width: 400px;
        }

        .quest-level {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            width: 100%;
            position: relative;
        }

        .quest-level.active {
            border-color: #fbbf24;
            box-shadow: 0 0 20px rgba(251, 191, 36, 0.3);
        }

        .quest-level.locked {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            cursor: not-allowed;
            opacity: 0.7;
        }

        .quest-level:not(.locked):hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(59, 130, 246, 0.3);
        }

        .level-number {
            font-size: 2rem;
            font-weight: 900;
            color: white;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .level-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: white;
            margin-bottom: 8px;
        }

        .level-description {
            font-size: 0.9rem;
            color: rgba(255,255,255,0.9);
            line-height: 1.4;
        }

        .quest-connector {
            width: 4px;
            height: 30px;
            background: linear-gradient(180deg, #3b82f6, #6b7280);
            border-radius: 2px;
        }

        .quest-info {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            width: 100%;
            max-width: 500px;
            border: 2px solid #e2e8f0;
        }

        .quest-info h3 {
            color: #1f2937;
            margin-bottom: 15px;
            font-size: 1.4rem;
        }

        .quest-info p {
            color: #6b7280;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .quest-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
        }

        .quest-stat {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: #374151;
        }

        .stat-icon {
            font-size: 1.2rem;
        }

        /* Year Level Container */
        .year-level-container {
            padding: 20px;
        }

        .year-level-header {
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .quest-map-content {
                gap: 30px;
            }
            
            .quest-level {
                padding: 20px;
            }
            
            .level-number {
                font-size: 1.8rem;
            }
            
            .level-title {
                font-size: 1.1rem;
            }
            
            .quest-stats {
                flex-direction: column;
                gap: 15px;
            }
        }

        .adventure-stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid #f1f5f9;
            position: relative;
        }

        .adventure-stat-card.clickable {
            cursor: pointer;
            border-color: #10b981;
        }

        .adventure-stat-card.clickable:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.2);
        }

        .stat-icon {
            font-size: 2rem;
            margin-bottom: 8px;
            display: block;
        }

        .stat-content h3 {
            font-size: 0.9rem;
            font-weight: 600;
            color: #6b7280;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #9ca3af;
        }

        .stat-arrow {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #10b981;
            font-weight: bold;
        }

        /* Rank Progression Screen */
        .rank-progression-container,
        .rewards-shop-container {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .screen-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .screen-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
        }

        .shop-balance {
            display: flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #10b981, #34d399);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-weight: 600;
        }

        .balance-icon {
            font-size: 1.2rem;
        }

        /* Ranks Grid */
        .ranks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .rank-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            position: relative;
        }

        .rank-card.unlocked {
            border-color: #10b981;
            background: linear-gradient(135deg, #ecfdf5, #f0fdf4);
        }

        .rank-card.current {
            border-color: #fbbf24;
            background: linear-gradient(135deg, #fefbf1, #fef3c7);
            animation: glow 2s infinite;
        }

        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px rgba(251, 191, 36, 0.3); }
            50% { box-shadow: 0 0 30px rgba(251, 191, 36, 0.5); }
        }

        .rank-card-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }

        .rank-card-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 8px;
        }

        .rank-card-level {
            font-size: 1rem;
            font-weight: 600;
            color: #6b7280;
            margin-bottom: 10px;
        }

        .rank-card-description {
            font-size: 0.9rem;
            color: #9ca3af;
            line-height: 1.4;
        }

        /* Shop Grid */
        .shop-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .shop-item {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid #f1f5f9;
            position: relative;
        }

        .shop-item.owned {
            border-color: #10b981;
            background: linear-gradient(135deg, #ecfdf5, #f0fdf4);
        }

        .shop-item.owned::after {
            content: " OWNED";
            position: absolute;
            top: 15px;
            right: 15px;
            background: #10b981;
            color: white;
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .item-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }

        .item-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 8px;
        }

        .item-description {
            font-size: 0.9rem;
            color: #6b7280;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .item-cost {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            margin-bottom: 15px;
            font-weight: 600;
            color: #1f2937;
        }

        .cost-icon {
            font-size: 1.1rem;
        }

        .buy-btn {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .buy-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.3);
        }

        .buy-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Level Up Notification */
        .level-up-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            animation: levelUpAnimation 3s ease;
        }

        .level-up-content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .level-up-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            animation: bounce 1s infinite;
        }

        .level-up-text h3 {
            font-size: 2rem;
            margin: 0 0 10px 0;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .level-up-text p {
            font-size: 1.2rem;
            margin: 0;
            opacity: 0.9;
        }

        @keyframes levelUpAnimation {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
            30% { transform: translate(-50%, -50%) scale(1); }
            90% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .adventure-hub-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .scholar-rank {
                padding: 10px 15px;
            }

            .rank-icon {
                font-size: 1.5rem;
                margin-right: 10px;
            }

            .quest-icon {
                font-size: 2rem;
                margin-right: 15px;
            }

            .daily-quest-card {
                padding: 15px;
            }

            .ranks-grid,
            .shop-grid {
                grid-template-columns: 1fr;
            }

            .level-up-notification {
                padding: 20px;
                max-width: 90vw;
            }

            .level-up-icon {
                font-size: 3rem;
            }

            .level-up-text h3 {
                font-size: 1.5rem;
            }

            .level-up-text p {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Premium 3D Floating Elements -->
    <div class="background-particles">
                    <div class="floating-element book"></div>
            <div class="floating-element calculator"></div>
            <div class="floating-element globe"></div>
            <div class="floating-element pencil"></div>
        <div class="floating-element star"></div>
        <div class="floating-element trophy"></div>
            <div class="floating-element lightbulb"></div>
            <div class="floating-element medal"></div>
        <div class="sparkle"></div>
        <div class="sparkle"></div>
        <div class="sparkle"></div>
        <div class="sparkle"></div>
        <div class="sparkle"></div>
    </div>

    <!-- Rank Progression Screen -->
    <div id="rankProgressionContainer" class="container rank-progression-container" style="display: none;">
        <div class="screen-header glass-card">
            <button class="back-btn" onclick="backToDashboard()"> Back</button>
            <h1 class="screen-title">Scholar Ranks</h1>
        </div>
        
        <div class="ranks-grid">
            <div class="rank-card" data-level="1">
                <div class="rank-card-icon"></div>
                <div class="rank-card-title">Novice Scholar</div>
                <div class="rank-card-level">Level 1-9</div>
                <div class="rank-card-description">Beginning your magical learning journey</div>
            </div>
            
            <div class="rank-card" data-level="10">
                <div class="rank-card-icon"></div>
                <div class="rank-card-title">Apprentice Scholar</div>
                <div class="rank-card-level">Level 10-19</div>
                <div class="rank-card-description">Mastering the fundamentals of knowledge</div>
            </div>
            
            <div class="rank-card" data-level="20">
                <div class="rank-card-icon"></div>
                <div class="rank-card-title">Expert Scholar</div>
                <div class="rank-card-level">Level 20-29</div>
                <div class="rank-card-description">Demonstrating advanced understanding</div>
            </div>
            
            <div class="rank-card" data-level="30">
                <div class="rank-card-icon"></div>
                <div class="rank-card-title">Master Scholar</div>
                <div class="rank-card-level">Level 30-39</div>
                <div class="rank-card-description">Achieving scholarly excellence</div>
            </div>
            
            <div class="rank-card" data-level="40">
                <div class="rank-card-icon"></div>
                <div class="rank-card-title">Grand Scholar</div>
                <div class="rank-card-level">Level 40-49</div>
                <div class="rank-card-description">Leading others in the pursuit of wisdom</div>
            </div>
            
            <div class="rank-card" data-level="50">
                <div class="rank-card-icon"></div>
                <div class="rank-card-title">Legendary Scholar</div>
                <div class="rank-card-level">Level 50+</div>
                <div class="rank-card-description">A true master of all knowledge</div>
            </div>
        </div>
    </div>

    <!-- Rewards Shop Screen -->
    <div id="rewardsShopContainer" class="container rewards-shop-container" style="display: none;">
        <div class="screen-header glass-card">
            <button class="back-btn" onclick="backToDashboard()"> Back</button>
            <h1 class="screen-title">Rewards Shop</h1>
            <div class="shop-balance">
                <span class="balance-icon"></span>
                <span class="balance-amount" id="shopBalance">0</span>
            </div>
        </div>
        
        <div class="shop-grid">
            <div class="shop-item" data-item="galaxy-theme" data-cost="500">
                <div class="item-icon"></div>
                <div class="item-name">Galaxy Theme</div>
                <div class="item-description">Transform your app with cosmic colors</div>
                <div class="item-cost">
                    <span class="cost-icon"></span>
                    <span class="cost-amount">500</span>
                </div>
                <button class="buy-btn" onclick="buyItem('galaxy-theme', 500)">Purchase</button>
            </div>
            
            <div class="shop-item" data-item="wizard-hat" data-cost="250">
                <div class="item-icon"></div>
                <div class="item-name">Wizard Hat</div>
                <div class="item-description">A magical accessory for your avatar</div>
                <div class="item-cost">
                    <span class="cost-icon"></span>
                    <span class="cost-amount">250</span>
                </div>
                <button class="buy-btn" onclick="buyItem('wizard-hat', 250)">Purchase</button>
            </div>
            
            <div class="shop-item" data-item="golden-spellbook" data-cost="1000">
                <div class="item-icon"></div>
                <div class="item-name">Golden Spellbook</div>
                <div class="item-description">An ornate icon upgrade for your rank</div>
                <div class="item-cost">
                    <span class="cost-icon"></span>
                    <span class="cost-amount">1000</span>
                </div>
                <button class="buy-btn" onclick="buyItem('golden-spellbook', 1000)">Purchase</button>
            </div>
            
            <div class="shop-item" data-item="crystal-wand" data-cost="750">
                <div class="item-icon"></div>
                <div class="item-name">Crystal Wand</div>
                <div class="item-description">A shimmering tool of learning magic</div>
                <div class="item-cost">
                    <span class="cost-icon"></span>
                    <span class="cost-amount">750</span>
                </div>
                <button class="buy-btn" onclick="buyItem('crystal-wand', 750)">Purchase</button>
            </div>
            
            <div class="shop-item" data-item="enchanted-library" data-cost="1500">
                <div class="item-icon"></div>
                <div class="item-name">Enchanted Library</div>
                <div class="item-description">Unlock a magical study environment</div>
                <div class="item-cost">
                    <span class="cost-icon"></span>
                    <span class="cost-amount">1500</span>
                </div>
                <button class="buy-btn" onclick="buyItem('enchanted-library', 1500)">Purchase</button>
            </div>
            
            <div class="shop-item" data-item="phoenix-feather" data-cost="2000">
                <div class="item-icon"></div>
                <div class="item-name">Phoenix Feather</div>
                <div class="item-description">A legendary writing instrument</div>
                <div class="item-cost">
                    <span class="cost-icon"></span>
                    <span class="cost-amount">2000</span>
                </div>
                <button class="buy-btn" onclick="buyItem('phoenix-feather', 2000)">Purchase</button>
            </div>
        </div>
    </div>

    <!-- Skip Links for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Settings Toggle Button -->
    <button class="settings-toggle" onclick="toggleSettings()" aria-label="Open settings menu" title="Settings">
        
    </button>

    <!-- Settings Panel -->
    <div class="settings-panel" id="settingsPanel" role="dialog" aria-labelledby="settings-title" aria-hidden="true">
        <h2 id="settings-title" class="settings-title">Settings</h2>
        
        <div class="setting-group">
            <label class="setting-label">Font Family</label>
            <div class="setting-options">
                <button class="setting-option active" onclick="changeFontFamily('inter')" data-font="inter">
                    Inter (Default)
                </button>
                <button class="setting-option" onclick="changeFontFamily('dyslexic')" data-font="dyslexic">
                    OpenDyslexic
                </button>
                <button class="setting-option" onclick="changeFontFamily('comic')" data-font="comic">
                    Comic Neue
                </button>
                <button class="setting-option" onclick="changeFontFamily('system')" data-font="system">
                    System Font
                </button>
            </div>
        </div>

        <div class="setting-group">
            <label class="setting-label">Font Size</label>
            <div class="setting-options">
                <button class="setting-option" onclick="changeFontSize('small')" data-size="small">
                    Small (14px)
                </button>
                <button class="setting-option active" onclick="changeFontSize('normal')" data-size="normal">
                    Normal (16px)
                </button>
                <button class="setting-option" onclick="changeFontSize('large')" data-size="large">
                    Large (18px)
                </button>
                <button class="setting-option" onclick="changeFontSize('xl')" data-size="xl">
                    Extra Large (20px)
                </button>
                <button class="setting-option" onclick="changeFontSize('xxl')" data-size="xxl">
                    XXL (24px)
                </button>
            </div>
        </div>

        <div class="setting-group">
            <label class="setting-label">Line Spacing</label>
            <div class="setting-options">
                <button class="setting-option" onclick="changeLineHeight('normal')" data-height="normal">
                    Normal (1.5)
                </button>
                <button class="setting-option active" onclick="changeLineHeight('relaxed')" data-height="relaxed">
                    Relaxed (1.625)
                </button>
                <button class="setting-option" onclick="changeLineHeight('loose')" data-height="loose">
                    Loose (2.0)
                </button>
            </div>
        </div>

        <div class="setting-group">
            <label class="setting-label">Theme</label>
            <div class="setting-options">
                <button class="setting-option active" onclick="changeTheme('default')" data-theme="default">
                    Default
                </button>
                <button class="setting-option" onclick="changeTheme('dark')" data-theme="dark">
                    Dark Mode
                </button>
                <button class="setting-option" onclick="changeTheme('high-contrast')" data-theme="high-contrast">
                    High Contrast
                </button>
            </div>
        </div>

        <div class="setting-group">
            <label class="setting-label">Sound Effects</label>
            <div class="sound-toggle" onclick="toggleSounds()" role="button" tabindex="0" aria-pressed="true">
                <span>Enable Sound Effects</span>
                <div class="toggle-switch active" id="soundToggle"></div>
            </div>
        </div>

        <div class="setting-group">
            <label class="setting-label">Volume</label>
            <div class="volume-control">
                <span></span>
                <input type="range" class="volume-slider" min="0" max="100" value="50" id="volumeSlider" 
                       oninput="changeVolume(this.value)" aria-label="Volume control">
                <span id="volumeValue">50%</span>
            </div>
        </div>

        <div class="setting-group">
            <label class="setting-label">Reset Progress</label>
            <button class="setting-option" onclick="resetApp()" style="background: linear-gradient(135deg, #ef4444, #dc2626); color: white; border-color: #ef4444;">
                 Restart & Change Name
            </button>
            <p style="font-size: 0.85rem; color: var(--text-light); margin-top: 8px;">
                This will clear all progress and let you enter a new name
            </p>
        </div>
    </div>

    <!-- Main Content -->
    <main id="main-content">
    <!-- Welcome Screen -->
    <div id="welcomeScreen" class="welcome-screen">
                        <div class="welcome-logo" id="welcomeLogo"></div>
        <h1 class="welcome-title">SATs Quest</h1>
        <p class="welcome-subtitle">Your exciting adventure to master Year 6 SATs with helpful hints and fun challenges!</p>
        
        <div class="name-input-container glass-card">
            <input type="text" id="userName" class="name-input" placeholder="Enter your name here">
            <br>
            <button id="startJourney" class="start-btn" onclick="startJourney()">
                Begin Your Journey
            </button>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="container dashboard">
        <div class="dashboard-header glass-card">
            <div class="user-info">
                <div class="user-details">
                    <h2 id="userName-display">Hi there!</h2>
                    <div class="user-stats">
                        <span id="totalQuizzes">Ready to start your quest! </span>
                    </div>
                </div>
            </div>
            <div class="scholar-rank" id="scholarRank" onclick="showRankProgression()" title="Click to see all ranks">
                <div class="rank-icon" id="rankIcon"></div>
                <div class="rank-details">
                    <div class="rank-level" id="rankLevel">Level 1</div>
                    <div class="rank-title" id="rankTitle">Novice Scholar</div>
                </div>
            </div>
        </div>

        <!-- XP Progress Section -->
        <div class="xp-section glass-card">
            <div class="xp-header">
                <span class="xp-label">Experience Points</span>
                <span class="xp-numbers" id="xpNumbers">0 / 100 XP</span>
            </div>
            <div class="xp-progress-bar">
                <div class="xp-fill" id="xpFill" style="width: 0%"></div>
                <div class="xp-sparkle"></div>
            </div>
        </div>



        <!-- Main Navigation Buttons -->
        <div class="main-navigation-grid">
            <button class="main-nav-btn quest-btn" onclick="showQuestMap()" title="Start your main learning journey">
                <div class="nav-icon"></div>
                <div class="nav-content">
                    <h3 id="questButtonText">Start Main Quest</h3>
                    <p>Begin your learning adventure</p>
                </div>
                <div class="nav-arrow"></div>
            </button>
            
            <button class="main-nav-btn practice-btn" onclick="showYearSelection()" title="Practice specific skills">
                <div class="nav-icon"></div>
                <div class="nav-content">
                    <h3>Practice Zone</h3>
                    <p>Sharpen your skills</p>
                </div>
                <div class="nav-arrow"></div>
            </button>
        </div>

        <!-- Adventure Hub Stats -->
        <div class="adventure-hub-grid">
            <div class="adventure-stat-card clickable" id="adventurePointsCard" onclick="showRewardsShop()" title="Click to visit the Rewards Shop">
                <div class="stat-icon"></div>
                <div class="stat-content">
                    <h3>Adventure Points</h3>
                    <div class="stat-value" id="totalAdventurePoints">0</div>
                    <div class="stat-label">gems earned</div>
                </div>
                <div class="stat-arrow"></div>
            </div>
            
            <div class="adventure-stat-card">
                <div class="stat-icon"></div>
                <div class="stat-content">
                    <h3>Quests Completed</h3>
                    <div class="stat-value" id="questsCompleted">0</div>
                    <div class="stat-label">adventures</div>
                </div>
            </div>
            
            <div class="adventure-stat-card">
                <div class="stat-icon"></div>
                <div class="stat-content">
                    <h3>Current Level</h3>
                    <div class="stat-value" id="currentLevelStat">1</div>
                    <div class="stat-label">scholar rank</div>
                </div>
            </div>
        </div>


    </div>

    <!-- Quest Map Container -->
    <div id="questMapContainer" class="container quest-map-container" style="display: none;">
        <div class="quest-map-header">
            <button class="back-btn" onclick="backToDashboard()"> Back</button>
            <h2 class="section-title">Your Quest Journey</h2>
        </div>
        
        <div class="quest-map-content">
            <div class="quest-path">
                <!-- Levels 1-10: Foundation Quests -->
                <div class="quest-level active" onclick="startQuestLevel(1)">
                    <div class="level-number">1</div>
                    <div class="level-title">Scholar's Beginning</div>
                    <div class="level-description">Mixed challenges to start your adventure</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(2)">
                    <div class="level-number">2</div>
                    <div class="level-title">Knowledge Explorer</div>
                    <div class="level-description">Discover new skills across subjects</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(3)">
                    <div class="level-number">3</div>
                    <div class="level-title">Skill Builder</div>
                    <div class="level-description">Strengthen your foundation</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(4)">
                    <div class="level-number">4</div>
                    <div class="level-title">Logic Learner</div>
                    <div class="level-description">Develop problem-solving skills</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(5)">
                    <div class="level-number">5</div>
                    <div class="level-title">Word Wizard</div>
                    <div class="level-description">Master language and spelling</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(6)">
                    <div class="level-number">6</div>
                    <div class="level-title">Number Navigator</div>
                    <div class="level-description">Excel in mathematical thinking</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(7)">
                    <div class="level-number">7</div>
                    <div class="level-title">Reading Ranger</div>
                    <div class="level-description">Unlock comprehension secrets</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(8)">
                    <div class="level-number">8</div>
                    <div class="level-title">Grammar Guardian</div>
                    <div class="level-description">Protect the rules of language</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(9)">
                    <div class="level-number">9</div>
                    <div class="level-title">Math Master</div>
                    <div class="level-description">Conquer numerical challenges</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(10)">
                    <div class="level-number">10</div>
                    <div class="level-title">Foundation Champion</div>
                    <div class="level-description">Complete your foundation quest</div>
                </div>
                <div class="quest-connector"></div>
                
                <!-- Levels 11-20: Advanced Quests -->
                <div class="quest-level" onclick="startQuestLevel(11)">
                    <div class="level-number">11</div>
                    <div class="level-title">Advanced Scholar</div>
                    <div class="level-description">Enter the advanced realm</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(12)">
                    <div class="level-number">12</div>
                    <div class="level-title">Critical Thinker</div>
                    <div class="level-description">Analyze and evaluate information</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(13)">
                    <div class="level-number">13</div>
                    <div class="level-title">Language Lord</div>
                    <div class="level-description">Rule over words and meanings</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(14)">
                    <div class="level-number">14</div>
                    <div class="level-title">Calculation Crusader</div>
                    <div class="level-description">Fight through complex problems</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(15)">
                    <div class="level-number">15</div>
                    <div class="level-title">Comprehension Commander</div>
                    <div class="level-description">Lead with understanding</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(16)">
                    <div class="level-number">16</div>
                    <div class="level-title">Syntax Sage</div>
                    <div class="level-description">Wisdom in sentence structure</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(17)">
                    <div class="level-number">17</div>
                    <div class="level-title">Problem Pioneer</div>
                    <div class="level-description">Blaze new solution trails</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(18)">
                    <div class="level-number">18</div>
                    <div class="level-title">Inference Inspector</div>
                    <div class="level-description">Detect hidden meanings</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(19)">
                    <div class="level-number">19</div>
                    <div class="level-title">Reasoning Ruler</div>
                    <div class="level-description">Govern logical thinking</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(20)">
                    <div class="level-number">20</div>
                    <div class="level-title">Advanced Champion</div>
                    <div class="level-description">Master of advanced skills</div>
                </div>
                <div class="quest-connector"></div>
                
                <!-- Levels 21-30: Expert Quests -->
                <div class="quest-level" onclick="startQuestLevel(21)">
                    <div class="level-number">21</div>
                    <div class="level-title">Expert Explorer</div>
                    <div class="level-description">Journey to expert territory</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(22)">
                    <div class="level-number">22</div>
                    <div class="level-title">Knowledge Knight</div>
                    <div class="level-description">Defend academic excellence</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(23)">
                    <div class="level-number">23</div>
                    <div class="level-title">Wisdom Warrior</div>
                    <div class="level-description">Battle with intelligence</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(24)">
                    <div class="level-number">24</div>
                    <div class="level-title">Learning Legend</div>
                    <div class="level-description">Become legendary in learning</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(25)">
                    <div class="level-number">25</div>
                    <div class="level-title">Academic Ace</div>
                    <div class="level-description">Achieve academic excellence</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(26)">
                    <div class="level-number">26</div>
                    <div class="level-title">SATs Specialist</div>
                    <div class="level-description">Specialize in test success</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(27)">
                    <div class="level-number">27</div>
                    <div class="level-title">Ultimate Scholar</div>
                    <div class="level-description">Reach ultimate understanding</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(28)">
                    <div class="level-number">28</div>
                    <div class="level-title">Grand Master</div>
                    <div class="level-description">Master all knowledge domains</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(29)">
                    <div class="level-number">29</div>
                    <div class="level-title">Supreme Sage</div>
                    <div class="level-description">Achieve supreme wisdom</div>
                </div>
                <div class="quest-connector"></div>
                
                <div class="quest-level" onclick="startQuestLevel(30)">
                    <div class="level-number">30</div>
                    <div class="level-title">Legendary Scholar</div>
                    <div class="level-description">Complete the ultimate quest!</div>
                </div>
            </div>
            
            <div class="quest-info">
                <h3> Your Adventure Awaits!</h3>
                <p>Complete mixed challenges from Reading, Grammar, and Maths. Each level unlocks as you progress through your learning journey.</p>
                <div class="quest-stats">
                    <div class="quest-stat">
                        <span class="stat-icon"></span>
                        <span>Current Level: 1</span>
                    </div>
                    <div class="quest-stat">
                        <span class="stat-icon"></span>
                        <span>Completed: 0/30</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Year Level Selection Container -->
    <div id="yearLevelContainer" class="container year-level-container" style="display: none;">
        <div class="year-level-header">
            <button class="back-btn" onclick="backToDashboard()"> Back</button>
            <h2 class="section-title">Choose Your Year Level</h2>
        </div>
        
        <div class="topic-grid">
            <button class="topic-card" data-topic="year5" onclick="showPackSelection('year5')">
                <div class="completion-badge" id="year5-badge">NEW</div>
                <div class="topic-icon"></div>
                <div class="topic-title">Year 5 Foundation</div>
                <div class="topic-description">Build confidence with familiar concepts</div>
                <div class="topic-stats">
                    <span>100 questions (Reading + Grammar + Maths)</span>
                    <span class="topic-best-score" id="year5-score">Start Building</span>
                </div>
            </button>
            
            <button class="topic-card" data-topic="year6" onclick="showPackSelection('year6')">
                <div class="completion-badge" id="year6-badge">NEW</div>
                <div class="topic-icon"></div>
                <div class="topic-title">Year 6 SATs Ready</div>
                <div class="topic-description">Prepare for your SATs with confidence</div>
                <div class="topic-stats">
                    <span>100 questions (Reading + Grammar + Maths)</span>
                    <span class="topic-best-score" id="year6-score">Get SATs Ready</span>
                </div>
            </button>
        </div>
    </div>

    <!-- Pack Selection Interface -->
    <div id="packSelectionContainer" class="container pack-selection-container" style="display: none;">
        <div class="pack-selection-header">
            <button class="back-btn" onclick="backToDashboard()"> Back</button>
            <h2 class="pack-title" id="packSelectionTitle">Choose Your Subject</h2>
        </div>
        
        <div class="pack-grid">
            <div class="pack-card" id="readingCard">
                <div class="pack-badge" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);"></div>
                <div class="pack-title">Reading</div>
                <div class="pack-description">Comprehension & Inference</div>
                <div class="pack-stats">
                    <span>25 questions</span>
                </div>
                <button class="pack-btn" onclick="startQuizPack(currentPackTopic, 'reading')" id="readingBtn">Start Reading</button>
            </div>
            
            <div class="pack-card" id="grammarCard">
                <div class="pack-badge" style="background: linear-gradient(135deg, #10b981, #059669);"></div>
                <div class="pack-title">Grammar & Spelling</div>
                <div class="pack-description">Punctuation, spelling, and grammar</div>
                <div class="pack-stats">
                    <span>25 questions</span>
                </div>
                <button class="pack-btn" onclick="startQuizPack(currentPackTopic, 'grammar')" id="grammarBtn">Start Grammar</button>
            </div>
            
            <div class="pack-card" id="arithmeticCard">
                <div class="pack-badge" style="background: linear-gradient(135deg, #f59e0b, #d97706);"></div>
                <div class="pack-title">Arithmetic</div>
                <div class="pack-description">Quick calculations & number skills</div>
                <div class="pack-stats">
                    <span>25 questions</span>
                </div>
                <button class="pack-btn" onclick="startQuizPack(currentPackTopic, 'arithmetic')" id="arithmeticBtn">Start Arithmetic</button>
            </div>
            
            <div class="pack-card" id="reasoningCard">
                <div class="pack-badge" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);"></div>
                <div class="pack-title">Mathematical Reasoning</div>
                <div class="pack-description">Problem solving & logic</div>
                <div class="pack-stats">
                    <span>25 questions</span>
                </div>
                <button class="pack-btn" onclick="startQuizPack(currentPackTopic, 'reasoning')" id="reasoningBtn">Start Reasoning</button>
            </div>
        </div>
    </div>

    <!-- Quiz Type Selection Screen -->
    <div id="quizTypeContainer" class="container quiz-type-container" style="display: none;">
        <div class="quiz-type-header">
            <button class="back-btn" onclick="backToPackSelection()"> Back</button>
            <h2 class="quiz-type-title" id="quizTypeTitle">Choose Your Practice Type</h2>
        </div>
        
        <div class="quiz-type-grid">
            <div class="quiz-type-card quick-quiz">
                <div class="quiz-type-icon"></div>
                <div class="quiz-type-title">Quick Quiz</div>
                <div class="quiz-type-subtitle">Perfect for short sessions</div>
                <div class="quiz-type-details">
                    <div class="detail-item">
                        <span class="detail-icon"></span>
                        <span class="detail-text">10 questions</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-icon"></span>
                        <span class="detail-text">~5-8 minutes</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-icon"></span>
                        <span class="detail-text">Quick wins</span>
                    </div>
                </div>
                <button class="quiz-type-btn primary" onclick="startQuiz('quick')" id="quickQuizBtn">Start Quick Quiz</button>
            </div>
            
            <div class="quiz-type-card full-practice">
                <div class="quiz-type-icon"></div>
                <div class="quiz-type-title">Full Workout</div>
                <div class="quiz-type-subtitle">Complete topic mastery</div>
                <div class="quiz-type-details">
                    <div class="detail-item">
                        <span class="detail-icon"></span>
                        <span class="detail-text">25 questions</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-icon"></span>
                        <span class="detail-text">~15-20 minutes</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-icon"></span>
                        <span class="detail-text">Maximum points</span>
                    </div>
                </div>
                <button class="quiz-type-btn secondary" onclick="startQuiz('full')" id="fullPracticeBtn">Start Full Practice</button>
            </div>
        </div>
    </div>

    <!-- Quiz Interface -->
    <div id="quizContainer" class="container quiz-container">
        <div class="quiz-header">
            <div class="quiz-nav">
                <button class="back-btn" onclick="backFromQuiz()"> Back</button>
                <h2 class="quiz-title" id="quizTitle"></h2>
            </div>
            
            <div class="quiz-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="quizProgressFill"></div>
                </div>
                <div class="progress-text" id="quizProgressText">Question 1 of 10</div>
            </div>
        </div>

        <div class="question-container">
            <div class="question-header">
                <div class="question-number" id="questionNumber">Question 1</div>
                <button class="hint-btn" onclick="showHint()" id="hintBtn"> Hint (3)</button>
            </div>
            <div class="passage-text" id="passageText" style="display: none;"></div>
            <div class="question-text" id="questionText"></div>
            
            <div class="hint-box" id="hintBox">
                <span class="hint-icon"></span>
                <span class="hint-text" id="hintText"></span>
            </div>
            
            <div class="options-container" id="optionsContainer"></div>
            
            <div class="submit-section" id="submitSection">
                <button class="submit-btn" onclick="submitAnswer()" id="submitBtn">Submit Answer</button>
            </div>
        </div>

        <!-- Question Feedback Screen -->
        <div class="feedback-container" id="feedbackContainer" style="display: none;">
            <div class="feedback-result" id="feedbackResult">
                <div class="feedback-icon" id="feedbackIcon"></div>
                <div class="feedback-title" id="feedbackTitle">Correct!</div>
                <div class="feedback-message" id="feedbackMessage">Great job! You got it right.</div>
            </div>
            
            <div class="feedback-explanation" id="feedbackExplanation">
                <div class="explanation-title">Explanation:</div>
                <div class="explanation-text" id="explanationText"></div>
            </div>
            
            <div class="feedback-score" id="feedbackScore">
                <div class="score-text">Score so far: <span id="runningScore">7/10</span></div>
                <div class="streak-text" id="streakText"> 3 in a row!</div>
            </div>
            
            <div class="feedback-navigation">
                <button class="feedback-btn next-question-btn" onclick="continueToNextQuestion()" id="continueBtn">
                    <span id="continueBtnText">Next Question </span>
                </button>
            </div>
        </div>

        <div class="quiz-navigation" style="display: none;">
            <button class="nav-btn prev-btn" id="prevBtn" onclick="previousQuestion()" disabled> Previous</button>
            <button class="nav-btn next-btn" id="nextBtn" onclick="nextQuestion()">Next </button>
            <button class="nav-btn finish-btn" id="finishBtn" onclick="finishQuiz()" style="display: none;">Finish Quiz</button>
        </div>
    </div>

    <!-- Results Screen -->
    <div id="resultsContainer" class="container results-container">
        <div class="results-header">
            <div class="results-score" id="finalScore">8/10</div>
            <div class="results-message" id="resultsMessage">Excellent work!</div>
            <div class="results-stats">
                <div class="result-stat">
                    <div class="result-stat-value" id="pointsEarned">80</div>
                    <div class="result-stat-label">Points Earned</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-value" id="timeSpent">5:30</div>
                    <div class="result-stat-label">Time Spent</div>
                </div>
                <div class="result-stat">
                    <div class="result-stat-value" id="accuracy">80%</div>
                    <div class="result-stat-label">Accuracy</div>
                </div>
            </div>
        </div>

        <div class="results-summary">
            <h3 class="summary-title">Question Review</h3>
            <div id="questionReview"></div>
        </div>

        <div class="results-actions">
            <button class="action-btn" onclick="retryQuiz()">Try Again</button>
            <button class="action-btn secondary" onclick="backToDashboard()">Back to Dashboard</button>
        </div>
    </div>

    <!-- Achievement Popup -->
    <div id="achievementPopup" class="achievement-popup">
        <div class="achievement-icon" id="achievementIcon"></div>
        <div class="achievement-title" id="achievementTitle">Achievement Unlocked!</div>
        <div class="achievement-description" id="achievementDescription">You've earned a new badge!</div>
    </div>
    </main>

    <script>
        // Enhanced JavaScript with Accessibility, Settings, and Updated SATs Questions (2024-2025)
        
        // Sound settings
        let soundsEnabled = true;
        let volume = 0.5;

        // Settings Management
        let settings = {
            fontFamily: 'inter',
            fontSize: 'normal', 
            lineHeight: 'relaxed',
            theme: 'default',
            soundsEnabled: true,
            volume: 50
        };

        // ===== MAGICAL SCHOLAR'S ADVENTURE GAMIFICATION SYSTEM =====
        
        // Scholar Rank Data
        const scholarRanks = [
            { level: 1, title: "Novice Scholar", icon: "", xpRequired: 0 },
            { level: 10, title: "Apprentice Scholar", icon: "", xpRequired: 900 },
            { level: 20, title: "Expert Scholar", icon: "", xpRequired: 2400 },
            { level: 30, title: "Master Scholar", icon: "", xpRequired: 4500 },
            { level: 40, title: "Grand Scholar", icon: "", xpRequired: 7200 },
            { level: 50, title: "Legendary Scholar", icon: "", xpRequired: 10500 }
        ];

        // XP required per level (exponential growth)
        function getXPRequiredForLevel(level) {
            return Math.floor(50 + (level * level * 2.5));
        }

        // Get current rank based on level
        function getCurrentRank(level) {
            for (let i = scholarRanks.length - 1; i >= 0; i--) {
                if (level >= scholarRanks[i].level) {
                    return scholarRanks[i];
                }
            }
            return scholarRanks[0];
        }

        // Add XP and handle level ups
        function addXP(points) {
            console.log(` Adding ${points} XP`);
            
            // Add XP to userData
            if (!userData.totalXP) userData.totalXP = 0;
            if (!userData.level) userData.level = 1;
            
            userData.totalXP += points;
            const oldLevel = userData.level;
            
            // Check for level up
            while (userData.totalXP >= getXPRequiredForLevel(userData.level + 1)) {
                userData.level++;
                console.log(` LEVEL UP! Now level ${userData.level}`);
                
                // Show level up animation (you can enhance this)
                showLevelUpNotification(userData.level);
                
                // Award adventure points for leveling up
                const bonusPoints = userData.level * 25;
                addAdventurePoints(bonusPoints);
                
                playSound('achievement');
            }
            
            // Update UI
            updateXPDisplay();
            updateRankDisplay();
            saveUserData();
            
            return userData.level > oldLevel; // Return true if leveled up
        }

        // Update XP progress bar and numbers
        function updateXPDisplay() {
            const currentXP = userData.totalXP || 0;
            const currentLevel = userData.level || 1;
            
            // Use rank data for XP thresholds (more accurate)
            const currentRank = getCurrentRank(currentLevel);
            const nextRankIndex = scholarRanks.findIndex(rank => rank.level > currentLevel);
            const nextRank = nextRankIndex !== -1 ? scholarRanks[nextRankIndex] : { level: currentLevel + 1, xpRequired: getXPRequiredForLevel(currentLevel + 1) };
            
            const xpForCurrentLevel = currentRank.xpRequired;
            const xpForNextLevel = nextRank.xpRequired;
            const xpInCurrentLevel = Math.max(0, currentXP - xpForCurrentLevel); // Ensure never negative
            const xpNeededForNext = xpForNextLevel - xpForCurrentLevel;
            const progressPercent = Math.min(100, (xpInCurrentLevel / xpNeededForNext) * 100);
            
            // Update XP numbers
            document.getElementById('xpNumbers').textContent = `${xpInCurrentLevel} / ${xpNeededForNext} XP`;
            
            // Update progress bar
            document.getElementById('xpFill').style.width = `${progressPercent}%`;
            
            console.log(` XP Display: ${xpInCurrentLevel}/${xpNeededForNext} (${progressPercent.toFixed(1)}%)`);
        }

        // Update rank display with current rank info
        function updateRankDisplay() {
            const currentLevel = userData.level || 1;
            const rank = getCurrentRank(currentLevel);
            
            document.getElementById('rankLevel').textContent = `Level ${currentLevel}`;
            document.getElementById('rankTitle').textContent = rank.title;
            document.getElementById('rankIcon').textContent = rank.icon;
        }

        // Show level up notification
        function showLevelUpNotification(newLevel) {
            const rank = getCurrentRank(newLevel);
            
            // Create a temporary notification (you can make this fancier)
            const notification = document.createElement('div');
            notification.className = 'level-up-notification';
            notification.innerHTML = `
                <div class="level-up-content">
                    <div class="level-up-icon">${rank.icon}</div>
                    <div class="level-up-text">
                        <h3>LEVEL UP!</h3>
                        <p>Welcome to Level ${newLevel}: ${rank.title}</p>
                    </div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        }

        // Add Adventure Points
        function addAdventurePoints(points) {
            console.log(` Adding ${points} Adventure Points`);
            
            if (!userData.adventurePoints) userData.adventurePoints = 0;
            userData.adventurePoints += points;
            
            // Update UI
            updateAdventurePointsDisplay();
            saveUserData();
        }

        // Update adventure points display
        function updateAdventurePointsDisplay() {
            const points = userData.adventurePoints || 0;
            document.getElementById('totalAdventurePoints').textContent = points;
            
            // Also update shop balance if shop is open
            const shopBalance = document.getElementById('shopBalance');
            if (shopBalance) {
                shopBalance.textContent = points;
            }
        }

        // Show Rank Progression Screen
        function showRankProgression() {
            console.log(' Showing rank progression screen');
            
            // Hide dashboard and show rank progression
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('rankProgressionContainer').style.display = 'block';
            
            // Update rank cards to show current progress
            updateRankCards();
            
            playSound('click');
        }

        // Update rank cards with current/unlocked status
        function updateRankCards() {
            const currentLevel = userData.level || 1;
            const rankCards = document.querySelectorAll('.rank-card');
            
            rankCards.forEach(card => {
                const requiredLevel = parseInt(card.getAttribute('data-level'));
                card.classList.remove('current', 'unlocked');
                
                if (currentLevel >= requiredLevel) {
                    if (getCurrentRank(currentLevel).level === requiredLevel) {
                        card.classList.add('current');
                    } else {
                        card.classList.add('unlocked');
                    }
                }
            });
        }

        // Show Rewards Shop Screen
        function showRewardsShop() {
            console.log(' Showing rewards shop screen');
            
            // Hide dashboard and show shop
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('rewardsShopContainer').style.display = 'block';
            
            // Update shop display
            updateShopDisplay();
            updateAdventurePointsDisplay();
            
            playSound('click');
        }

        // Update shop items based on owned items
        function updateShopDisplay() {
            if (!userData.ownedItems) userData.ownedItems = [];
            
            const shopItems = document.querySelectorAll('.shop-item');
            
            shopItems.forEach(item => {
                const itemId = item.getAttribute('data-item');
                const cost = parseInt(item.getAttribute('data-cost'));
                const buyBtn = item.querySelector('.buy-btn');
                
                if (userData.ownedItems.includes(itemId)) {
                    item.classList.add('owned');
                    buyBtn.textContent = 'OWNED';
                    buyBtn.disabled = true;
                } else {
                    item.classList.remove('owned');
                    const canAfford = (userData.adventurePoints || 0) >= cost;
                    buyBtn.disabled = !canAfford;
                    buyBtn.textContent = canAfford ? 'Purchase' : 'Not Enough Gems';
                }
            });
        }

        // Buy an item from the shop
        function buyItem(itemId, cost) {
            console.log(` Attempting to buy ${itemId} for ${cost} points`);
            
            if (!userData.adventurePoints) userData.adventurePoints = 0;
            if (!userData.ownedItems) userData.ownedItems = [];
            
            // Check if already owned
            if (userData.ownedItems.includes(itemId)) {
                alert('You already own this item!');
                return;
            }
            
            // Check if can afford
            if (userData.adventurePoints < cost) {
                alert(`Not enough Adventure Points! You need ${cost - userData.adventurePoints} more gems.`);
                return;
            }
            
            // Purchase the item
            userData.adventurePoints -= cost;
            userData.ownedItems.push(itemId);
            
            // Apply item effects (you can expand this)
            applyItemEffect(itemId);
            
            // Update displays
            updateAdventurePointsDisplay();
            updateShopDisplay();
            saveUserData();
            
            // Show success message
            alert(` Successfully purchased ${getItemName(itemId)}! `);
            playSound('achievement');
        }

        // Apply effects of purchased items
        function applyItemEffect(itemId) {
            switch(itemId) {
                case 'galaxy-theme':
                    // Apply galaxy theme (you can implement theme switching)
                    console.log(' Galaxy theme applied!');
                    break;
                case 'wizard-hat':
                    // Add wizard hat to avatar (you can implement avatar system)
                    console.log(' Wizard hat equipped!');
                    break;
                case 'golden-spellbook':
                    // Upgrade rank icon to golden version
                    console.log(' Golden spellbook activated!');
                    break;
                case 'crystal-wand':
                    // Add special effects (you can implement visual enhancements)
                    console.log(' Crystal wand equipped!');
                    break;
                case 'enchanted-library':
                    // Unlock special study mode (you can implement new features)
                    console.log(' Enchanted library unlocked!');
                    break;
                case 'phoenix-feather':
                    // Premium writing tool effects
                    console.log(' Phoenix feather acquired!');
                    break;
            }
        }

        // Get item name for display
        function getItemName(itemId) {
            const itemNames = {
                'galaxy-theme': 'Galaxy Theme',
                'wizard-hat': 'Wizard Hat',
                'golden-spellbook': 'Golden Spellbook',
                'crystal-wand': 'Crystal Wand',
                'enchanted-library': 'Enchanted Library',
                'phoenix-feather': 'Phoenix Feather'
            };
            return itemNames[itemId] || itemId;
        }



        // Daily Quests (Updated for Year 5/6 Structure)

        // MASTER QUESTION BANK: All 200 Questions
        // FULL VERSION: 500-Question Library Implementation
        // Quest Bank: 300 unique questions for Main Quest (30 levels  10 questions each)
        // Practice Bank: 200 unique questions for Practice Zone (4 subjects  50 questions each)
        
        // QUEST BANK: 300 Unique Questions for Main Quest (30 levels  10 questions)
        const questBank = [
            // Mixed questions from all subjects and year levels
            {
                question: "1,000 - 10 = ?",
                type: "input",
                answer: "990",
                subject: "arithmetic",
                yearLevel: "year5",
                hint: "Subtract 10 from 1,000."
            },
            {
                question: "Circle the adjective: The tall man walked away.",
                type: "highlight",
                sentence: "The tall man walked away.",
                correctWords: ["tall"],
                subject: "grammar",
                yearLevel: "year5",
                hint: "An adjective describes a noun. Which word describes the man?"
            },
            {
                question: "What is the perimeter of an 8cm square?",
                type: "input",
                answer: "32cm",
                subject: "reasoning",
                yearLevel: "year5",
                hint: "A square has 4 equal sides. Perimeter = 4  8cm."
            },
            {
                question: "Rewrite in the passive voice: The dog ate the food.",
                type: "input",
                answer: "The food was eaten by the dog.",
                subject: "grammar",
                yearLevel: "year6",
                hint: "In passive voice, the object becomes the subject."
            },
            {
                question: "1,210  11 = ?",
                type: "input",
                answer: "110",
                subject: "arithmetic",
                yearLevel: "year6",
                hint: "Think about what number times 11 equals 1,210."
            },
            {
                passage: "The ancient lighthouse stood on the rocky cliff, its beacon cutting through the foggy night. Ships relied on its steady light to navigate safely to harbor.",
                question: "Find and copy a word that means 'jumped'.",
                type: "input",
                answer: "pounced",
                subject: "reading",
                yearLevel: "year5",
                hint: "Look for an action word that shows sudden movement."
            },
            {
                question: "Simplify the ratio 8:12.",
                type: "input",
                answer: "2:3",
                subject: "reasoning",
                yearLevel: "year6",
                hint: "Find the highest common factor of 8 and 12."
            },
            {
                question: "Add a comma: When I get home, I will have dinner.",
                type: "punctuate",
                sentence: "When I get home I will have dinner.",
                instruction: "Tap the word that the comma should go AFTER:",
                correctWordIndex: 3,
                subject: "grammar",
                yearLevel: "year5",
                hint: "Put a comma after the fronted adverbial."
            },
            {
                question: "2.5 + 2.5 = ?",
                type: "input",
                answer: "5",
                subject: "arithmetic",
                yearLevel: "year5",
                hint: "Add the decimal numbers together."
            },
            {
                question: "Add a semi-colon: He was very tired; he had been awake all night.",
                type: "punctuate",
                sentence: "He was very tired he had been awake all night.",
                instruction: "Tap the word that the semi-colon should go AFTER:",
                correctWordIndex: 3,
                subject: "grammar",
                yearLevel: "year6",
                hint: "Use a semi-colon to link two related sentences."
            },
            {
                question: "What is 20% as a fraction in its simplest form?",
                type: "input",
                answer: "1/5",
                subject: "reasoning",
                yearLevel: "year5",
                hint: "20% = 20/100. Simplify by dividing both by 20."
            },
            {
                question: "25  12 = ?",
                type: "input",
                answer: "300",
                subject: "arithmetic",
                yearLevel: "year6",
                hint: "Break it down: 25  10 = 250, then add 25  2."
            },
            {
                question: "What is the mean of 2, 4, and 9?",
                type: "input",
                answer: "5",
                subject: "reasoning",
                yearLevel: "year6",
                hint: "Add them up: 2 + 4 + 9 = 15. Then divide by 3."
            },
            {
                question: "Circle the two pronouns: I gave the pen to him.",
                type: "highlight",
                sentence: "I gave the pen to him.",
                correctWords: ["I", "him"],
                subject: "grammar",
                yearLevel: "year5",
                hint: "Pronouns replace nouns. Which words replace people's names?"
            },
            {
                question: "10  2.34 = ?",
                type: "input",
                answer: "23.4",
                subject: "arithmetic",
                yearLevel: "year5",
                hint: "When multiplying by 10, move the decimal point one place right."
            },
            {
                question: "Correct the spelling: Please stand in a seperate line.",
                type: "input",
                answer: "separate",
                subject: "grammar",
                yearLevel: "year6",
                hint: "Remember: sep-a-rate (with an 'a')."
            },
            {
                question: "How many minutes are in 2.5 hours?",
                type: "input",
                answer: "150",
                subject: "reasoning",
                yearLevel: "year5",
                hint: "2.5 hours = 2 hours 30 minutes = 120 + 30 minutes."
            },
            {
                question: "If b = 10, what is 5b - 15?",
                type: "input",
                answer: "35",
                subject: "reasoning",
                yearLevel: "year6",
                hint: "Replace b with 10: 5  10 - 15 = 50 - 15."
            },
            {
                question: "Add an apostrophe for the contraction: It is hot today.",
                type: "input",
                answer: "It's",
                subject: "grammar",
                yearLevel: "year5",
                hint: "Contractions combine two words with an apostrophe."
            },
            {
                question: "1 - 0.11 = ?",
                type: "input",
                answer: "0.89",
                subject: "arithmetic",
                yearLevel: "year6",
                hint: "Think of 1 as 1.00, then subtract 0.11."
            }
        ];

        // PRACTICE BANK: 200 Unique Questions for Practice Zone (4 subjects  50 questions)
        const practiceBank = {
            'reading': [
                {
                    passage: "The butterfly emerged from its chrysalis after two weeks of transformation. Its wings, still wet and fragile, slowly dried in the morning sunshine. Within hours, it would take its first flight, joining the migration that had been calling to its species for thousands of years.",
                    question: "How long did the butterfly stay in its chrysalis?",
                    type: "multiple",
                    options: ["One week", "Two weeks", "One month", "Two months"],
                    answer: 1,
                    hint: "Look for the time period mentioned at the beginning."
                }
            ],
            'grammar': [
                {
                    question: "Underline the modal verb: You should try your best.",
                    type: "highlight",
                    sentence: "You should try your best.",
                    correctWords: ["should"],
                    hint: "Modal verbs express possibility, necessity, or ability."
                }
            ],
            'arithmetic': [
                {
                    question: "3,456 + 1,234 = ?",
                    type: "input",
                    answer: "4690",
                    hint: "Add the numbers column by column, carrying over when needed."
                }
            ],
            'reasoning': [
                {
                    question: "A bus journey starts at 08:45 and lasts 40 minutes. What time does it arrive?",
                    type: "input",
                    answer: "09:25",
                    hint: "Add 40 minutes to 08:45."
                }
            ]
        };

        // Legacy questionBank for backward compatibility
        const questionBank = {
            'year5': {
                'reading': [
                    // Year 5 Reading Questions (25 total) - Fox passage
                    {
                        passage: "A flash of orange fur darted across the lawn. The fox, a silent hunter, paused beneath the old oak tree. Its amber eyes scanned the darkness, searching for any sign of movement. A distant car rumbled past, but the creature remained focused, a statue in the moonlight.",
                        question: "Find and copy one word that means the fox 'moved quickly'.",
                        type: "input",
                        answer: "darted",
                        hint: "Look at the first sentence. Which word describes how the fox moved across the lawn?"
                    },
                    {
                        passage: "A flash of orange fur darted across the lawn. The fox, a silent hunter, paused beneath the old oak tree. Its amber eyes scanned the darkness, searching for any sign of movement. A distant car rumbled past, but the creature remained focused, a statue in the moonlight.",
                        question: "What had the fox been described as?",
                        type: "input",
                        answer: "A silent hunter",
                        hint: "Look for the phrase that tells us what type of animal the fox is."
                    },
                    {
                        passage: "A flash of orange fur darted across the lawn. The fox, a silent hunter, paused beneath the old oak tree. Its amber eyes scanned the darkness, searching for any sign of movement. A distant car rumbled past, but the creature remained focused, a statue in the moonlight.",
                        question: "What colour were the fox's eyes?",
                        type: "input",
                        answer: "amber",
                        hint: "Look for the word that describes the fox's eyes in the passage."
                    },
                    {
                        passage: "A flash of orange fur darted across the lawn. The fox, a silent hunter, paused beneath the old oak tree. Its amber eyes scanned the darkness, searching for any sign of movement. A distant car rumbled past, but the creature remained focused, a statue in the moonlight.",
                        question: "What does the word focused mean in this passage?",
                        type: "multiple",
                        options: ["scared", "sleepy", "concentrating"],
                        answer: "concentrating",
                        hint: "Think about what the fox is doing - it's paying close attention to something."
                    },
                    {
                        passage: "A flash of orange fur darted across the lawn. The fox, a silent hunter, paused beneath the old oak tree. Its amber eyes scanned the darkness, searching for any sign of movement. A distant car rumbled past, but the creature remained focused, a statue in the moonlight.",
                        question: "What did the fox do beneath the oak tree?",
                        type: "input",
                        answer: {
                            keywords: ['pause', 'stop', 'wait', 'rest', 'halt', 'still'],
                            modelAnswer: "The fox paused."
                        },
                        hint: "Look at what happened when the fox reached the tree."
                    },
                    {
                        passage: "A flash of orange fur darted across the lawn. The fox, a silent hunter, paused beneath the old oak tree. Its amber eyes scanned the darkness, searching for any sign of movement. A distant car rumbled past, but the creature remained focused, a statue in the moonlight.",
                        question: "The text suggests the fox was hunting. What is the main clue for this?",
                        type: "input",
                        answer: {
                            keywords: ['search', 'silent hunter', 'movement', 'focused', 'scan'],
                            modelAnswer: "It was described as a 'silent hunter' and was scanning for movement."
                        },
                        hint: "Look for what the fox was doing with its eyes."
                    },
                    {
                        passage: "A flash of orange fur darted across the lawn. The fox, a silent hunter, paused beneath the old oak tree. Its amber eyes scanned the darkness, searching for any sign of movement. A distant car rumbled past, but the creature remained focused, a statue in the moonlight.",
                        question: "\"...a statue in the moonlight.\" What does this tell you about how the fox was standing?",
                        type: "multiple",
                        options: ["It was shivering.", "It was very still.", "It was made of stone."],
                        answer: "It was very still.",
                        hint: "Think about how a statue looks - does it move?"
                    },
                    {
                        passage: "A flash of orange fur darted across the lawn. The fox, a silent hunter, paused beneath the old oak tree. Its amber eyes scanned the darkness, searching for any sign of movement. A distant car rumbled past, but the creature remained focused, a statue in the moonlight.",
                        question: "Which of the following best describes the atmosphere?",
                        type: "multiple",
                        options: ["noisy and busy", "quiet and tense", "happy and relaxed"],
                        answer: "quiet and tense",
                        hint: "Think about the mood - is it peaceful and calm or is there tension in the air?"
                    },
                    {
                        passage: "A flash of orange fur darted across the lawn. The fox, a silent hunter, paused beneath the old oak tree. Its amber eyes scanned the darkness, searching for any sign of movement. A distant car rumbled past, but the creature remained focused, a statue in the moonlight.",
                        question: "Find and copy the group of words that tells you what the fox was looking for.",
                        type: "input",
                        answer: "any sign of movement",
                        hint: "What was the fox searching for? Look for the exact phrase."
                    },
                    {
                        passage: "A flash of orange fur darted across the lawn. The fox, a silent hunter, paused beneath the old oak tree. Its amber eyes scanned the darkness, searching for any sign of movement. A distant car rumbled past, but the creature remained focused, a statue in the moonlight.",
                        question: "The word distant tells us the car was...",
                        type: "input",
                        answer: "far away",
                        hint: "What does 'distant' mean? Think about how close or far the car was."
                    },
                    {
                        passage: "A flash of orange fur darted across the lawn. The fox, a silent hunter, paused beneath the old oak tree. Its amber eyes scanned the darkness, searching for any sign of movement. A distant car rumbled past, but the creature remained focused, a statue in the moonlight.",
                        question: "What was the only sound mentioned in the passage?",
                        type: "input",
                        answer: "A distant car",
                        hint: "Listen carefully - what sound is described in the passage?"
                    },
                    {
                        passage: "A flash of orange fur darted across the lawn. The fox, a silent hunter, paused beneath the old oak tree. Its amber eyes scanned the darkness, searching for any sign of movement. A distant car rumbled past, but the creature remained focused, a statue in the moonlight.",
                        question: "Why do you think the author described the fox as 'silent'?",
                        type: "input",
                        answer: "Because it needed to be quiet to avoid scaring away its prey",
                        hint: "Think about why hunters need to be quiet."
                    },
                    {
                        passage: "A flash of orange fur darted across the lawn. The fox, a silent hunter, paused beneath the old oak tree. Its amber eyes scanned the darkness, searching for any sign of movement. A distant car rumbled past, but the creature remained focused, a statue in the moonlight.",
                        question: "True or False: The fox was scared of the car.",
                        type: "multiple",
                        options: ["True", "False"],
                        answer: "False",
                        hint: "Did the fox run away when the car went past? What does this tell you?"
                    },
                    {
                        passage: "A flash of orange fur darted across the lawn. The fox, a silent hunter, paused beneath the old oak tree. Its amber eyes scanned the darkness, searching for any sign of movement. A distant car rumbled past, but the creature remained focused, a statue in the moonlight.",
                        question: "What time of day is it in the passage?",
                        type: "input",
                        answer: "Night",
                        hint: "Look for clues about light in the passage."
                    },
                    {
                        passage: "A flash of orange fur darted across the lawn. The fox, a silent hunter, paused beneath the old oak tree. Its amber eyes scanned the darkness, searching for any sign of movement. A distant car rumbled past, but the creature remained focused, a statue in the moonlight.",
                        question: "Look at the first sentence. Which word is closest in meaning to 'darted'?",
                        type: "multiple",
                        options: ["crawled", "jumped", "zipped"],
                        answer: "zipped",
                        hint: "All these words mean 'moved quickly' but which one is most similar to 'darted'?"
                    },
                    {
                        passage: "A flash of orange fur darted across the lawn. The fox, a silent hunter, paused beneath the old oak tree. Its amber eyes scanned the darkness, searching for any sign of movement. A distant car rumbled past, but the creature remained focused, a statue in the moonlight.",
                        question: "What type of tree did the fox pause beneath?",
                        type: "input",
                        answer: "An oak tree",
                        hint: "Look for the type of tree mentioned in the passage."
                    },
                    {
                        passage: "A flash of orange fur darted across the lawn. The fox, a silent hunter, paused beneath the old oak tree. Its amber eyes scanned the darkness, searching for any sign of movement. A distant car rumbled past, but the creature remained focused, a statue in the moonlight.",
                        question: "What sense was the fox using the most?",
                        type: "multiple",
                        options: ["hearing", "sight", "smell"],
                        answer: "sight",
                        hint: "What was the fox doing with its eyes? This tells you which sense it was using."
                    },
                    {
                        passage: "A flash of orange fur darted across the lawn. The fox, a silent hunter, paused beneath the old oak tree. Its amber eyes scanned the darkness, searching for any sign of movement. A distant car rumbled past, but the creature remained focused, a statue in the moonlight.",
                        question: "Find and copy one word that is a colour.",
                        type: "input",
                        answer: "orange",
                        hint: "Look through the passage for any words that describe colours."
                    },
                    {
                        passage: "A flash of orange fur darted across the lawn. The fox, a silent hunter, paused beneath the old oak tree. Its amber eyes scanned the darkness, searching for any sign of movement. A distant car rumbled past, but the creature remained focused, a statue in the moonlight.",
                        question: "\"A distant car rumbled past...\" What does this suggest about the sound of the car?",
                        type: "input",
                        answer: "It was a low, deep sound",
                        hint: "What does 'rumbled' tell you about the type of sound the car made?"
                    },
                    {
                        passage: "A flash of orange fur darted across the lawn. The fox, a silent hunter, paused beneath the old oak tree. Its amber eyes scanned the darkness, searching for any sign of movement. A distant car rumbled past, but the creature remained focused, a statue in the moonlight.",
                        question: "The author is trying to make the fox seem...",
                        type: "multiple",
                        options: ["clumsy and loud", "graceful and focused", "playful and friendly"],
                        answer: "graceful and focused",
                        hint: "Think about how the fox is described - what impression does the author want to give?"
                    },
                    {
                        passage: "A flash of orange fur darted across the lawn. The fox, a silent hunter, paused beneath the old oak tree. Its amber eyes scanned the darkness, searching for any sign of movement. A distant car rumbled past, but the creature remained focused, a statue in the moonlight.",
                        question: "What was the source of light in the passage?",
                        type: "input",
                        answer: "The moonlight",
                        hint: "What type of light is mentioned at the end of the passage?"
                    },
                    {
                        passage: "A flash of orange fur darted across the lawn. The fox, a silent hunter, paused beneath the old oak tree. Its amber eyes scanned the darkness, searching for any sign of movement. A distant car rumbled past, but the creature remained focused, a statue in the moonlight.",
                        question: "How do you know the fox was not a pet?",
                        type: "input",
                        answer: "It is described as a \"hunter\" in a garden, suggesting it is wild",
                        hint: "Think about where the fox is and what it's doing. Would a pet fox behave this way?"
                    },
                    {
                        passage: "A flash of orange fur darted across the lawn. The fox, a silent hunter, paused beneath the old oak tree. Its amber eyes scanned the darkness, searching for any sign of movement. A distant car rumbled past, but the creature remained focused, a statue in the moonlight.",
                        question: "The fox is described as a 'creature'. Find and copy another word used to describe the fox.",
                        type: "input",
                        answer: "hunter",
                        hint: "Look for other words in the passage that tell us what the fox is."
                    },
                    {
                        passage: "A flash of orange fur darted across the lawn. The fox, a silent hunter, paused beneath the old oak tree. Its amber eyes scanned the darkness, searching for any sign of movement. A distant car rumbled past, but the creature remained focused, a statue in the moonlight.",
                        question: "What might the fox have been hunting for? Give one example.",
                        type: "input",
                        answer: "A mouse",
                        hint: "Think about what small animals foxes like to hunt for food."
                    },
                    {
                        passage: "A flash of orange fur darted across the lawn. The fox, a silent hunter, paused beneath the old oak tree. Its amber eyes scanned the darkness, searching for any sign of movement. A distant car rumbled past, but the creature remained focused, a statue in the moonlight.",
                        question: "The overall mood of the passage is...",
                        type: "multiple",
                        options: ["peaceful", "chaotic", "joyful"],
                        answer: "peaceful",
                        hint: "Despite the tension of hunting, what is the general feeling of the scene?"
                    }],
                'grammar': [
                    // Year 5 Grammar Questions (25 total)
                    {
                        question: "Which sentence is a command?",
                        type: "multiple",
                        options: ["Please can you shut the door?", "I am shutting the door.", "Shut the door quietly."],
                        answer: "Shut the door quietly.",
                        hint: "A command tells someone to do something. It usually starts with a verb and doesn't ask - it tells."
                    },
                    {
                        question: "Where should the comma go?",
                        type: "punctuate",
                        sentence: "After the rain stopped the sun came out.",
                        instruction: "Tap the word that the comma should go AFTER:",
                        punctuation: ",",
                        correctWordIndex: 3, // "stopped" is at index 3 (0-based)
                        answer: "After the rain stopped, the sun came out.",
                        hint: "Put a comma after the first part of the sentence, before 'the sun came out'."
                    },
                    {
                        question: "Tap to highlight the two adjectives:",
                        type: "highlight",
                        sentence: "The little cat had very sharp claws.",
                        correctWords: ["little", "sharp"],
                        answer: "little and sharp",
                        hint: "Adjectives describe nouns. Which words describe the cat and its claws?"
                    },
                    {
                        question: "Tap to highlight the main clause:",
                        type: "highlight",
                        sentence: "When the rain stopped, we went outside to play.",
                        correctWords: ["we", "went", "outside", "to", "play"],
                        answer: "we went outside to play",
                        hint: "The main clause is the part that makes sense on its own, without the 'when' part."
                    },
                    {
                        question: "Rewrite the underlined verb in the simple past tense: I think it is a good idea.",
                        type: "input",
                        answer: "I thought it was a good idea.",
                        hint: "Change 'think' to past tense and 'is' to past tense too."
                    },
                    {
                        question: "Add the correct apostrophe to show that the bikes belong to the boys: The boys bikes were leaning against the wall.",
                        type: "input",
                        answer: "The boys' bikes were leaning against the wall.",
                        hint: "The bikes belong to more than one boy, so the apostrophe goes after the 's'."
                    },
                    {
                        question: "Which of these words should have a capital letter?",
                        type: "multiple",
                        options: ["river", "street", "monday"],
                        answer: "monday",
                        hint: "Days of the week always start with a capital letter."
                    },
                    {
                        question: "Underline the modal verb in the sentence: We will go to the beach tomorrow.",
                        type: "multiple",
                        options: ["We", "will", "go", "beach"],
                        answer: "will",
                        hint: "Modal verbs show possibility, necessity, or ability. They come before main verbs."
                    },
                    {
                        question: "Correct the spelling of the underlined word: We had a party to celebrayt my birthday.",
                        type: "input",
                        answer: "celebrate",
                        hint: "This word ends in '-ate', not '-ayt'."
                    },
                    {
                        question: "Which sentence uses 'their' correctly?",
                        type: "multiple",
                        options: ["They're going to the park.", "Their dog is very friendly.", "The shops are over there."],
                        answer: "Their dog is very friendly.",
                        hint: "'Their' shows ownership. 'They're' means 'they are'. 'There' shows a place."
                    },
                    {
                        question: "Circle the conjunction in the sentence: He was tired, so he went to bed.",
                        type: "multiple",
                        options: ["He", "was", "so", "bed"],
                        answer: "so",
                        hint: "A conjunction joins two parts of a sentence together."
                    },
                    {
                        question: "Which sentence is correctly punctuated?",
                        type: "multiple",
                        options: [
                            "The school trip was fun",
                            "The school trip was fun.",
                            "The school trip was fun?",
                            "The school trip was fun!"
                        ],
                        answer: "The school trip was fun.",
                        hint: "Statement sentences end with a full stop."
                    },
                    {
                        question: "The plural of leaf is ______.",
                        type: "input",
                        answer: "leaves",
                        hint: "When a word ends in 'f', we usually change it to 'ves' for the plural."
                    },
                    {
                        question: "Underline the preposition in the sentence: The cat slept under the bed.",
                        type: "multiple",
                        options: ["cat", "slept", "under", "bed"],
                        answer: "under",
                        hint: "A preposition shows the position of something - where it is."
                    },
                    {
                        question: "Circle the verb in the sentence: The horses galloped across the field.",
                        type: "multiple",
                        options: ["horses", "galloped", "across", "field"],
                        answer: "galloped",
                        hint: "A verb is a doing word - what action are the horses doing?"
                    },
                    {
                        question: "Which sentence is punctuated correctly?",
                        type: "multiple",
                        options: ["\"What's for dinner? asked Ben.\"", "\"What's for dinner?\" asked Ben.", "\"Whats for dinner?\" asked Ben."],
                        answer: "\"What's for dinner?\" asked Ben.",
                        hint: "Speech marks go around the spoken words, and there should be an apostrophe in 'What's'."
                    },
                    {
                        question: "Add a suffix to make the verb 'enjoy' a noun.",
                        type: "input",
                        answer: "enjoyment",
                        hint: "Add '-ment' to the end of 'enjoy' to make it a noun."
                    },
                    {
                        question: "Tick the correct pronoun to complete the sentence: Tom and ___ went to the cinema.",
                        type: "multiple",
                        options: ["me", "I"],
                        answer: "I",
                        hint: "Say the sentence without 'Tom and' - which sounds right: 'I went' or 'me went'?"
                    },
                    {
                        question: "Insert the correct determiner (a/an): He is ___ honest man.",
                        type: "input",
                        answer: "an",
                        hint: "Use 'an' before words that start with a vowel sound, even if they start with 'h'."
                    },
                    {
                        question: "Tap to highlight the relative clause:",
                        type: "highlight",
                        sentence: "The park, which is near my house, is lovely.",
                        correctWords: ["which", "is", "near", "my", "house"],
                        answer: "which is near my house",
                        hint: "A relative clause gives extra information and usually starts with 'which', 'who', or 'that'."
                    },
                    {
                        question: "Which sentence is in the present tense? 'She walked to the shop.'",
                        type: "multiple",
                        options: [
                            "She walked to the shop.",
                            "She walks to the shop.",
                            "She will walk to the shop.",
                            "She had walked to the shop."
                        ],
                        answer: "She walks to the shop.",
                        hint: "Present tense tells us what is happening now."
                    },
                    {
                        question: "Circle the two nouns: The teacher put the books on the table.",
                        type: "multiple",
                        options: ["teacher and books", "teacher and put", "books and table"],
                        answer: "teacher and books",
                        hint: "Nouns are naming words - they name people, places, or things."
                    },
                    {
                        question: "Which word is an adverb?",
                        type: "multiple",
                        options: ["quick", "quickly", "quicken"],
                        answer: "quickly",
                        hint: "Adverbs often end in '-ly' and describe how something is done."
                    },
                    {
                        question: "Which sentence has the correct commas?",
                        type: "multiple",
                        options: [
                            "I need bread eggs and milk.",
                            "I need bread, eggs and milk.",
                            "I need bread, eggs, and milk.",
                            "I need, bread eggs and milk."
                        ],
                        answer: "I need bread, eggs, and milk.",
                        hint: "Put commas between each item in a list, including before 'and'."
                    },
                    {
                        question: "What is the contraction for 'do not'?",
                        type: "input",
                        answer: "don't",
                        hint: "Join the two words and replace the 'o' with an apostrophe."
                    },
                    {
                        question: "Correct the spelling of the underlined word: I have a new pare of shoes.",
                        type: "input",
                        answer: "pair",
                        hint: "This word sounds like 'pear' (the fruit) but has a different spelling."
                    }],
                'arithmetic': [
                    // Year 5 Arithmetic (25 questions)
                    {
                        question: "5,432 + 384 = ?",
                        type: "input",
                        answer: "5816",
                        hint: "Line up the numbers by place value. Add from right to left, carrying when needed."
                    },
                    {
                        question: "2,035 - 500 = ?",
                        type: "input",
                        answer: "1535",
                        hint: "When subtracting hundreds, take away 5 from the hundreds column."
                    },
                    {
                        question: "60  8 = ?",
                        type: "input",
                        answer: "480",
                        hint: "Think 6  8 = 48, then add the zero to make 480."
                    },
                    {
                        question: "450  9 = ?",
                        type: "input",
                        answer: "50",
                        hint: "Think: 9 times what number equals 450? Try your 9 times table."
                    },
                    {
                        question: "6.2 + 3.9 = ?",
                        type: "input",
                        answer: "10.1",
                        hint: "Line up the decimal points and add. 6.2 + 3.9 = 10.1"
                    },
                    {
                        question: "100  0.54 = ?",
                        type: "input",
                        answer: "54",
                        hint: "When multiplying by 100, move the decimal point 2 places to the right."
                    },
                    {
                        question: "5/8 + 1/8 = ?",
                        type: "input",
                        answer: "6/8",
                        hint: "When the bottom numbers are the same, just add the top numbers."
                    },
                    {
                        question: "50% of 120 = ?",
                        type: "input",
                        answer: "60",
                        hint: "50% means half. What's 120  2?"
                    },
                    {
                        question: "7 = ?",
                        type: "input",
                        answer: "49",
                        hint: "7 means 7  7. What's 7 times 7?"
                    },
                    {
                        question: "1,200  10 = ?",
                        type: "input",
                        answer: "120",
                        hint: "When dividing by 10, move all digits one place to the right."
                    },
                    {
                        question: "4  250 = ?",
                        type: "input",
                        answer: "1000",
                        hint: "Think 4  25 = 100, then add the zero to make 1000."
                    },
                    {
                        question: "2 - 0.5 = ?",
                        type: "input",
                        answer: "1.5",
                        hint: "Think of 2 as 2.0, then subtract 0.5."
                    },
                    {
                        question: "2,848  8 = ?",
                        type: "input",
                        answer: "356",
                        hint: "Use long division. How many 8s go into 28? Then 4? Then 8?"
                    },
                    {
                        question: "1/3 of 36 = ?",
                        type: "input",
                        answer: "12",
                        hint: "To find 1/3, divide by 3. What's 36  3?"
                    },
                    {
                        question: "10 - 4.2 = ?",
                        type: "input",
                        answer: "5.8",
                        hint: "Think of 10 as 10.0, then subtract 4.2."
                    },
                    {
                        question: "1,234 + 5,678 = ?",
                        type: "input",
                        answer: "6912",
                        hint: "Line up the numbers and add each column, carrying when needed."
                    },
                    {
                        question: "3,000 - 1 = ?",
                        type: "input",
                        answer: "2999",
                        hint: "When subtracting 1 from a round number, the last digit becomes 9."
                    },
                    {
                        question: "125  3 = ?",
                        type: "input",
                        answer: "375",
                        hint: "Break it down: 125  3 = (100  3) + (25  3) = 300 + 75."
                    },
                    {
                        question: "360  6 = ?",
                        type: "input",
                        answer: "60",
                        hint: "Think: 6 times what number equals 360? Try your 6 times table."
                    },
                    {
                        question: "7.1 - 0.4 = ?",
                        type: "input",
                        answer: "6.7",
                        hint: "Line up the decimal points and subtract carefully."
                    },
                    {
                        question: "10  45.6 = ?",
                        type: "input",
                        answer: "456",
                        hint: "When multiplying by 10, move the decimal point 1 place to the right."
                    },
                    {
                        question: "1/4 + 1/2 = ?",
                        type: "input",
                        answer: "3/4",
                        hint: "Change 1/2 to 2/4, then add: 1/4 + 2/4 = 3/4."
                    },
                    {
                        question: "10% of 250 = ?",
                        type: "input",
                        answer: "25",
                        hint: "10% means divide by 10. What's 250  10?"
                    },
                    {
                        question: "5  6  7 = ?",
                        type: "input",
                        answer: "210",
                        hint: "Multiply two numbers first: 5  6 = 30, then 30  7 = 210."
                    },
                    {
                        question: "8,400  100 = ?",
                        type: "input",
                        answer: "84",
                        hint: "When dividing by 100, move the decimal point 2 places to the left."
                    }],
                'reasoning': [
                    // Year 5 Reasoning (25 questions)
                    {
                        question: "Round 1,485 to the nearest hundred.",
                        type: "input",
                        answer: "1500",
                        hint: "Look at the tens digit. If it's 5 or more, round up to 1500."
                    },
                    {
                        question: "Here are four angles. Which one is obtuse?",
                        type: "multiple",
                        options: ["45", "90", "110", "180"],
                        answer: "110",
                        hint: "An obtuse angle is more than 90 but less than 180."
                    },
                    {
                        question: "A film starts at 1:45 PM and lasts for 90 minutes. What time does it finish?",
                        type: "input",
                        answer: "3:15 PM",
                        hint: "90 minutes = 1 hour 30 minutes. Add this to 1:45 PM."
                    },
                    {
                        question: "What is the area of a rectangle with sides 7cm and 5cm?",
                        type: "input",
                        answer: "35cm",
                        hint: "Area = length  width. So 7  5 = 35cm."
                    },
                    {
                        question: "Write down all the factors of 12.",
                        type: "input",
                        answer: "1, 2, 3, 4, 6, 12",
                        hint: "Factors are numbers that divide exactly into 12."
                    },
                    {
                        question: "How many millilitres are in 2.5 litres?",
                        type: "input",
                        answer: "2500ml",
                        hint: "1 litre = 1000ml, so 2.5 litres = 2.5  1000."
                    },
                    {
                        question: "What is the next number in the sequence? 3, 7, 11, 15, ___",
                        type: "input",
                        answer: "19",
                        hint: "Look at the pattern: each number goes up by 4."
                    },
                    {
                        question: "A book costs 4.50. How much do 3 books cost?",
                        type: "input",
                        answer: "13.50",
                        hint: "Multiply the cost of one book by 3: 4.50  3."
                    },
                    {
                        question: "What is 1/4 as a percentage?",
                        type: "input",
                        answer: "25%",
                        hint: "1/4 = 25/100 = 25%."
                    },
                    {
                        question: "How many vertices does a cube have?",
                        type: "input",
                        answer: "8",
                        hint: "A cube has 8 corners. Each corner is called a vertex."
                    },
                    {
                        question: "A bus has 40 seats. 15 are empty. What fraction of the seats are full?",
                        type: "input",
                        answer: "25/40",
                        hint: "Full seats = 40 - 15 = 25. So the fraction is 25/40."
                    },
                    {
                        question: "Which of these is a prime number?",
                        type: "multiple",
                        options: ["9", "10", "11", "12"],
                        answer: "11",
                        hint: "A prime number only divides by 1 and itself. Check which number fits this."
                    },
                    {
                        question: "A bag of sweets contains 10 red sweets and 5 blue sweets. What percentage of the sweets are blue?",
                        type: "input",
                        answer: "33.3%",
                        hint: "Total sweets = 15. Blue sweets = 5. So 5/15 = 1/3 = 33.3%."
                    },
                    {
                        question: "A train leaves Whitley Bay at 09:30 and arrives in Newcastle at 10:05. How long is the journey?",
                        type: "input",
                        answer: "35 minutes",
                        hint: "Count from 09:30 to 10:05. That's 35 minutes."
                    },
                    {
                        question: "Write the number 52,084 in words.",
                        type: "input",
                        answer: "Fifty-two thousand and eighty-four",
                        hint: "Break it down: 52,000 = fifty-two thousand, 84 = eighty-four."
                    },
                    {
                        question: "What number is halfway between 10 and 40?",
                        type: "input",
                        answer: "25",
                        hint: "Add 10 and 40, then divide by 2: (10 + 40)  2 = 25."
                    },
                    {
                        question: "A square has a perimeter of 44cm. What is the length of one side?",
                        type: "input",
                        answer: "11cm",
                        hint: "A square has 4 equal sides. So one side = 44  4 = 11cm."
                    },
                    {
                        question: "How many seconds are there in 5 minutes?",
                        type: "input",
                        answer: "300 seconds",
                        hint: "1 minute = 60 seconds. So 5 minutes = 5  60 = 300 seconds."
                    },
                    {
                        question: "Which is larger? 0.5 or 0.45?",
                        type: "input",
                        answer: "0.5",
                        hint: "Compare the tenths: 0.5 has 5 tenths, 0.45 has 4 tenths."
                    },
                    {
                        question: "A bar chart shows 50 children were asked their favourite colour. 25 chose blue. What percentage is this?",
                        type: "input",
                        answer: "50%",
                        hint: "25 out of 50 = 25/50 = 1/2 = 50%."
                    },
                    {
                        question: "What are the coordinates of the point (2,3) translated 3 squares right and 1 square up?",
                        type: "input",
                        answer: "(5,4)",
                        hint: "Right means add to x-coordinate: 2+3=5. Up means add to y-coordinate: 3+1=4."
                    },
                    {
                        question: "A box contains 30 chocolates. 1/5 are eaten. How many are left?",
                        type: "input",
                        answer: "24",
                        hint: "1/5 of 30 = 6 eaten. So 30 - 6 = 24 left."
                    },
                    {
                        question: "Write down two numbers that are multiples of 8.",
                        type: "input",
                        answer: "16, 24",
                        hint: "Multiples of 8: 8, 16, 24, 32, 40... Pick any two."
                    },
                    {
                        question: "What is the name of a triangle with two equal sides?",
                        type: "input",
                        answer: "Isosceles",
                        hint: "An isosceles triangle has two sides the same length."
                    },
                    {
                        question: "A bag of flour weighs 1kg. If 250g is used, how many grams are left?",
                        type: "input",
                        answer: "750g",
                        hint: "1kg = 1000g. So 1000g - 250g = 750g."
                    }]
            },
            'year6': {
                'reading': [
                    // Year 6 Reading Questions (25 total) - Honeybee passage
                    {
                        passage: "The honeybee's role as a pollinator is vital for global ecosystems. While foraging, a bee collects pollen on its legs, transferring it between flowers and enabling fertilisation. This single act is responsible for a huge proportion of the food we eat. However, bee populations face numerous threats, from pesticides to habitat loss, making their conservation a matter of urgent global importance.",
                        question: "What is the bee's 'vital' role?",
                        type: "input",
                        answer: "As a pollinator",
                        hint: "Look at the beginning of the passage. What important job do bees do?"
                    },
                    {
                        passage: "The honeybee's role as a pollinator is vital for global ecosystems. While foraging, a bee collects pollen on its legs, transferring it between flowers and enabling fertilisation. This single act is responsible for a huge proportion of the food we eat. However, bee populations face numerous threats, from pesticides to habitat loss, making their conservation a matter of urgent global importance.",
                        question: "According to the text, what are two threats that bees face?",
                        type: "input",
                        answer: "Pesticides and habitat loss",
                        hint: "Look for the list of dangers mentioned near the end of the passage."
                    },
                    {
                        passage: "The honeybee's role as a pollinator is vital for global ecosystems. While foraging, a bee collects pollen on its legs, transferring it between flowers and enabling fertilisation. This single act is responsible for a huge proportion of the food we eat. However, bee populations face numerous threats, from pesticides to habitat loss, making their conservation a matter of urgent global importance.",
                        question: "\"...a matter of urgent global importance.\" What does urgent mean here?",
                        type: "multiple",
                        options: ["unimportant", "needs immediate attention", "interesting"],
                        answer: "needs immediate attention",
                        hint: "Urgent means something needs to be done quickly. Which option matches this?"
                    },
                    {
                        passage: "The honeybee's role as a pollinator is vital for global ecosystems. While foraging, a bee collects pollen on its legs, transferring it between flowers and enabling fertilisation. This single act is responsible for a huge proportion of the food we eat. However, bee populations face numerous threats, from pesticides to habitat loss, making their conservation a matter of urgent global importance.",
                        question: "Why is the bee's act of pollination so important for humans?",
                        type: "input",
                        answer: "Because it is responsible for a huge proportion of the food we eat",
                        hint: "What does the text say about the connection between bee pollination and our food?"
                    },
                    {
                        passage: "The honeybee's role as a pollinator is vital for global ecosystems. While foraging, a bee collects pollen on its legs, transferring it between flowers and enabling fertilisation. This single act is responsible for a huge proportion of the food we eat. However, bee populations face numerous threats, from pesticides to habitat loss, making their conservation a matter of urgent global importance.",
                        question: "What does the word foraging mean?",
                        type: "multiple",
                        options: ["sleeping", "searching for food", "building a hive"],
                        answer: "searching for food",
                        hint: "Think about what bees do when they visit flowers. What are they looking for?"
                    },
                    {
                        passage: "The honeybee's role as a pollinator is vital for global ecosystems. While foraging, a bee collects pollen on its legs, transferring it between flowers and enabling fertilisation. This single act is responsible for a huge proportion of the food we eat. However, bee populations face numerous threats, from pesticides to habitat loss, making their conservation a matter of urgent global importance.",
                        question: "Find and copy a word that means the same as 'essential' or 'very important'.",
                        type: "input",
                        answer: "vital",
                        hint: "Look for a word early in the passage that describes how important the bee's role is."
                    },
                    {
                        passage: "The honeybee's role as a pollinator is vital for global ecosystems. While foraging, a bee collects pollen on its legs, transferring it between flowers and enabling fertilisation. This single act is responsible for a huge proportion of the food we eat. However, bee populations face numerous threats, from pesticides to habitat loss, making their conservation a matter of urgent global importance.",
                        question: "The main purpose of this text is to...",
                        type: "input",
                        answer: "Inform the reader about the importance of bees and the threats they face",
                        hint: "What is the writer trying to tell us? What do they want us to understand about bees?"
                    },
                    {
                        passage: "The honeybee's role as a pollinator is vital for global ecosystems. While foraging, a bee collects pollen on its legs, transferring it between flowers and enabling fertilisation. This single act is responsible for a huge proportion of the food we eat. However, bee populations face numerous threats, from pesticides to habitat loss, making their conservation a matter of urgent global importance.",
                        question: "Which word tells you that the threats to bees are a worldwide issue?",
                        type: "input",
                        answer: "global",
                        hint: "Which word in the passage suggests this problem affects the whole world?"
                    },
                    {
                        passage: "The honeybee's role as a pollinator is vital for global ecosystems. While foraging, a bee collects pollen on its legs, transferring it between flowers and enabling fertilisation. This single act is responsible for a huge proportion of the food we eat. However, bee populations face numerous threats, from pesticides to habitat loss, making their conservation a matter of urgent global importance.",
                        question: "What is being transferred between flowers?",
                        type: "input",
                        answer: "Pollen",
                        hint: "What do the bees carry from flower to flower? Look carefully at the process described."
                    },
                    {
                        passage: "The honeybee's role as a pollinator is vital for global ecosystems. While foraging, a bee collects pollen on its legs, transferring it between flowers and enabling fertilisation. This single act is responsible for a huge proportion of the food we eat. However, bee populations face numerous threats, from pesticides to habitat loss, making their conservation a matter of urgent global importance.",
                        question: "The tone of the final sentence can best be described as...",
                        type: "multiple",
                        options: ["humorous", "concerned", "confusing"],
                        answer: "concerned",
                        hint: "How does the writer feel about the threats to bees? What emotion comes through in their words?"
                    },
                    {
                        passage: "The honeybee's role as a pollinator is vital for global ecosystems. While foraging, a bee collects pollen on its legs, transferring it between flowers and enabling fertilisation. This single act is responsible for a huge proportion of the food we eat. However, bee populations face numerous threats, from pesticides to habitat loss, making their conservation a matter of urgent global importance.",
                        question: "What does the word conservation mean in this context?",
                        type: "input",
                        answer: "Protection",
                        hint: "If bees are under threat, what would conservation mean? What do we need to do for them?"
                    },
                    {
                        passage: "The honeybee's role as a pollinator is vital for global ecosystems. While foraging, a bee collects pollen on its legs, transferring it between flowers and enabling fertilisation. This single act is responsible for a huge proportion of the food we eat. However, bee populations face numerous threats, from pesticides to habitat loss, making their conservation a matter of urgent global importance.",
                        question: "What does the text say enables fertilisation in flowers?",
                        type: "input",
                        answer: "The transfer of pollen between them",
                        hint: "What process allows flowers to be fertilised? What do the bees do that makes this happen?"
                    },
                    {
                        passage: "The honeybee's role as a pollinator is vital for global ecosystems. While foraging, a bee collects pollen on its legs, transferring it between flowers and enabling fertilisation. This single act is responsible for a huge proportion of the food we eat. However, bee populations face numerous threats, from pesticides to habitat loss, making their conservation a matter of urgent global importance.",
                        question: "Which of these is a fact from the text?",
                        type: "multiple",
                        options: ["Bees are the most interesting insects.", "Everyone should keep bees.", "Bees face numerous threats."],
                        answer: "Bees face numerous threats.",
                        hint: "Which statement is directly supported by information in the text?"
                    },
                    {
                        passage: "The honeybee's role as a pollinator is vital for global ecosystems. While foraging, a bee collects pollen on its legs, transferring it between flowers and enabling fertilisation. This single act is responsible for a huge proportion of the food we eat. However, bee populations face numerous threats, from pesticides to habitat loss, making their conservation a matter of urgent global importance.",
                        question: "Find and copy the word that means 'many'.",
                        type: "input",
                        answer: "numerous",
                        hint: "Look for a word that means the same as 'many' or 'lots of'."
                    },
                    {
                        passage: "The honeybee's role as a pollinator is vital for global ecosystems. While foraging, a bee collects pollen on its legs, transferring it between flowers and enabling fertilisation. This single act is responsible for a huge proportion of the food we eat. However, bee populations face numerous threats, from pesticides to habitat loss, making their conservation a matter of urgent global importance.",
                        question: "The text suggests that if bee populations decline further...",
                        type: "input",
                        answer: "Our food supply could be at risk",
                        hint: "If bees are responsible for much of our food, what might happen if there are fewer bees?"
                    },
                    {
                        passage: "The honeybee's role as a pollinator is vital for global ecosystems. While foraging, a bee collects pollen on its legs, transferring it between flowers and enabling fertilisation. This single act is responsible for a huge proportion of the food we eat. However, bee populations face numerous threats, from pesticides to habitat loss, making their conservation a matter of urgent global importance.",
                        question: "What does 'habitat loss' mean for the bees?",
                        type: "input",
                        answer: "They are losing the places where they live",
                        hint: "A habitat is where an animal lives. What would habitat loss mean?"
                    },
                    {
                        passage: "The honeybee's role as a pollinator is vital for global ecosystems. While foraging, a bee collects pollen on its legs, transferring it between flowers and enabling fertilisation. This single act is responsible for a huge proportion of the food we eat. However, bee populations face numerous threats, from pesticides to habitat loss, making their conservation a matter of urgent global importance.",
                        question: "The word proportion means...",
                        type: "multiple",
                        options: ["a small number.", "a part or share of a whole.", "a problem."],
                        answer: "a part or share of a whole.",
                        hint: "Think about what 'a huge proportion' means. Is it talking about a part of something?"
                    },
                    {
                        passage: "The honeybee's role as a pollinator is vital for global ecosystems. While foraging, a bee collects pollen on its legs, transferring it between flowers and enabling fertilisation. This single act is responsible for a huge proportion of the food we eat. However, bee populations face numerous threats, from pesticides to habitat loss, making their conservation a matter of urgent global importance.",
                        question: "This text is an example of...",
                        type: "input",
                        answer: "Non-fiction",
                        hint: "Is this text telling a made-up story or giving real information about something?"
                    },
                    {
                        passage: "The honeybee's role as a pollinator is vital for global ecosystems. While foraging, a bee collects pollen on its legs, transferring it between flowers and enabling fertilisation. This single act is responsible for a huge proportion of the food we eat. However, bee populations face numerous threats, from pesticides to habitat loss, making their conservation a matter of urgent global importance.",
                        question: "Why has the author used the word \"single act\"?",
                        type: "input",
                        answer: "To emphasise how important one simple action by a bee is",
                        hint: "Why might the writer want to stress that this is just 'one' action? What point are they making?"
                    },
                    {
                        passage: "The honeybee's role as a pollinator is vital for global ecosystems. While foraging, a bee collects pollen on its legs, transferring it between flowers and enabling fertilisation. This single act is responsible for a huge proportion of the food we eat. However, bee populations face numerous threats, from pesticides to habitat loss, making their conservation a matter of urgent global importance.",
                        question: "What is a pesticide?",
                        type: "input",
                        answer: "A chemical used to kill pests",
                        hint: "Break down the word: 'pest' + 'cide'. What do you think this means?"
                    },
                    {
                        passage: "The honeybee's role as a pollinator is vital for global ecosystems. While foraging, a bee collects pollen on its legs, transferring it between flowers and enabling fertilisation. This single act is responsible for a huge proportion of the food we eat. However, bee populations face numerous threats, from pesticides to habitat loss, making their conservation a matter of urgent global importance.",
                        question: "Find and copy a word that describes the bee population.",
                        type: "input",
                        answer: "populations",
                        hint: "What word is used to describe groups of bees?"
                    },
                    {
                        passage: "The honeybee's role as a pollinator is vital for global ecosystems. While foraging, a bee collects pollen on its legs, transferring it between flowers and enabling fertilisation. This single act is responsible for a huge proportion of the food we eat. However, bee populations face numerous threats, from pesticides to habitat loss, making their conservation a matter of urgent global importance.",
                        question: "Who is the intended audience for this text?",
                        type: "multiple",
                        options: [
                            "The general public",
                            "Professional beekeepers only",
                            "Young children under 8",
                            "University science professors"
                        ],
                        answer: "The general public",
                        hint: "Who do you think the writer wants to read this? Is it written for experts or everyday people?"
                    },
                    {
                        passage: "The honeybee's role as a pollinator is vital for global ecosystems. While foraging, a bee collects pollen on its legs, transferring it between flowers and enabling fertilisation. This single act is responsible for a huge proportion of the food we eat. However, bee populations face numerous threats, from pesticides to habitat loss, making their conservation a matter of urgent global importance.",
                        question: "The text is organised to first explain the importance of bees, then...",
                        type: "multiple",
                        options: [
                            "to explain the dangers they face",
                            "to describe how they collect pollen",
                            "to give examples of different bee types",
                            "to explain how ecosystems work"
                        ],
                        answer: "to explain the dangers they face",
                        hint: "Look at the structure: first the text talks about what bees do, then it talks about what?"
                    },
                    {
                        passage: "The honeybee's role as a pollinator is vital for global ecosystems. While foraging, a bee collects pollen on its legs, transferring it between flowers and enabling fertilisation. This single act is responsible for a huge proportion of the food we eat. However, bee populations face numerous threats, from pesticides to habitat loss, making their conservation a matter of urgent global importance.",
                        question: "What is the function of the word 'However'?",
                        type: "multiple",
                        options: [
                            "It introduces a contrasting idea",
                            "It shows something happens next",
                            "It emphasizes the main point",
                            "It introduces an example"
                        ],
                        answer: "It introduces a contrasting idea",
                        hint: "The text talks about good things bees do, then says 'However...' What type of information comes next?"
                    },
                    {
                        passage: "The honeybee's role as a pollinator is vital for global ecosystems. While foraging, a bee collects pollen on its legs, transferring it between flowers and enabling fertilisation. This single act is responsible for a huge proportion of the food we eat. However, bee populations face numerous threats, from pesticides to habitat loss, making their conservation a matter of urgent global importance.",
                        question: "What is the main point of the text?",
                        type: "multiple",
                        options: [
                            "Bees are vital for our food supply but are under threat and need protecting",
                            "Bees collect pollen on their legs when they forage for food",
                            "Pesticides and habitat loss are the main problems in nature",
                            "Global ecosystems depend only on honeybees for survival"
                        ],
                        answer: "Bees are vital for our food supply but are under threat and need protecting",
                        hint: "Try to capture both the importance of bees and the problems they face."
                    }],
                'grammar': [
                    // Year 6 Grammar Questions (25 total)
                    {
                        question: "Which sentence is in the passive voice? 'Alexander Fleming discovered penicillin.'",
                        type: "multiple",
                        options: [
                            "Alexander Fleming discovered penicillin.",
                            "Penicillin was discovered by Alexander Fleming.",
                            "Alexander Fleming has discovered penicillin.",
                            "Alexander Fleming will discover penicillin."
                        ],
                        answer: "Penicillin was discovered by Alexander Fleming.",
                        hint: "In passive voice, the action is done 'by' someone or something."
                    },
                    {
                        question: "Which sentence uses a semi-colon correctly?",
                        type: "multiple",
                        options: ["He was late; for the bus.", "He was late; the bus had already gone.", "He was late; and missed the bus."],
                        answer: "He was late; the bus had already gone.",
                        hint: "A semi-colon joins two complete sentences that could stand alone."
                    },
                    {
                        question: "Where should the colon go?",
                        type: "punctuate",
                        sentence: "She had one main goal to win the race.",
                        instruction: "Tap the word that the colon should go AFTER:",
                        punctuation: ":",
                        correctWordIndex: 4, // "goal" is at index 4 (0-based)
                        answer: "She had one main goal: to win the race.",
                        hint: "A colon introduces an explanation or list. Put it after 'goal'."
                    },
                    {
                        question: "Tick the sentence written in the subjunctive mood.",
                        type: "multiple",
                        options: ["If I was the captain, I would be happy.", "If I were the captain, I would be happy."],
                        answer: "If I were the captain, I would be happy.",
                        hint: "In subjunctive mood, we use 'were' instead of 'was' in 'if' clauses."
                    },
                    {
                        question: "Which sentence has the correct hyphens?",
                        type: "multiple",
                        options: [
                            "The ten year old girl bought a well written book.",
                            "The ten-year old girl bought a well written book.",
                            "The ten-year-old girl bought a well-written book.",
                            "The ten year-old girl bought a well written-book."
                        ],
                        answer: "The ten-year-old girl bought a well-written book.",
                        hint: "Use hyphens to join words that work together to describe something."
                    },
                    {
                        question: "Which sentence is active?",
                        type: "multiple",
                        options: ["The window was broken by the ball.", "The ball broke the window."],
                        answer: "The ball broke the window.",
                        hint: "In active voice, the subject does the action. Who/what did the breaking?"
                    },
                    {
                        question: "Correct the spelling of the underlined word: The school trip was an amazing oppertunity.",
                        type: "input",
                        answer: "opportunity",
                        hint: "This word has two 'p's and one 'r'. Think: opp-or-tun-ity."
                    },
                    {
                        question: "Where should the opening bracket go?",
                        type: "punctuate",
                        sentence: "The new teacher who was from Whitley Bay was very friendly.",
                        instruction: "Tap the word that the opening bracket should go AFTER:",
                        punctuation: "(",
                        correctWordIndex: 2, // "teacher" is at index 2 (0-based)
                        answer: "The new teacher (who was from Whitley Bay) was very friendly.",
                        hint: "Brackets go around extra information that could be removed from the sentence."
                    },
                    {
                        question: "Which is the correct plural of analysis?",
                        type: "input",
                        answer: "analyses",
                        hint: "Words ending in '-sis' change to '-ses' in the plural."
                    },
                    {
                        question: "Is the language in a legal document usually formal or informal?",
                        type: "input",
                        answer: "Formal",
                        hint: "Think about how lawyers and judges speak and write."
                    },
                    {
                        question: "Where should the first dash go?",
                        type: "punctuate",
                        sentence: "My favourite food pizza was on the menu.",
                        instruction: "Tap the word that the first dash should go AFTER:",
                        punctuation: "",
                        correctWordIndex: 2, // "food" is at index 2 (0-based)
                        answer: "My favourite food  pizza  was on the menu.",
                        hint: "Dashes can be used like brackets to add extra information."
                    },
                    {
                        question: "Correct the spelling of the underlined word: He was very consciencious about his work.",
                        type: "input",
                        answer: "conscientious",
                        hint: "This word has 'science' in the middle: con-science-tious."
                    },
                    {
                        question: "Which sentence is passive?",
                        type: "multiple",
                        options: ["The dog chased the cat.", "The cat was chased by the dog."],
                        answer: "The cat was chased by the dog.",
                        hint: "In passive voice, the action is done 'by' someone or something."
                    },
                    {
                        question: "Where should the colon go? 'He gave a simple instruction Wait here.'",
                        type: "multiple",
                        options: [
                            "He: gave a simple instruction Wait here.",
                            "He gave a simple: instruction Wait here.",
                            "He gave a simple instruction: Wait here.",
                            "He gave a simple instruction Wait: here."
                        ],
                        answer: "He gave a simple instruction: Wait here.",
                        hint: "A colon introduces direct speech or instructions."
                    },
                    {
                        question: "Where should the semi-colon go in this sentence? 'Some like hot weather others prefer the cold.'",
                        type: "multiple",
                        options: [
                            "Some; like hot weather others prefer the cold.",
                            "Some like hot weather; others prefer the cold.",
                            "Some like hot; weather others prefer the cold.",
                            "Some like hot weather others; prefer the cold."
                        ],
                        answer: "Some like hot weather; others prefer the cold.",
                        hint: "A semi-colon joins two complete sentences that are closely related."
                    },
                    {
                        question: "Which sentence is in the active voice? 'The prize was won by our team.'",
                        type: "multiple",
                        options: [
                            "The prize was won by our team.",
                            "Our team won the prize.",
                            "The prize has been won by our team.",
                            "By our team, the prize was won."
                        ],
                        answer: "Our team won the prize.",
                        hint: "In active voice, the subject doing the action comes first."
                    },
                    {
                        question: "Tick the sentence that uses a colon correctly to introduce a clause.",
                        type: "multiple",
                        options: ["She knew what to do: run.", "The answer was simple: he had forgotten."],
                        answer: "The answer was simple: he had forgotten.",
                        hint: "A colon can introduce a complete explanation or clause."
                    },
                    {
                        question: "Correct the spelling: It is a real priviledge.",
                        type: "input",
                        answer: "privilege",
                        hint: "Remember: priv-i-lege (not -ledge)."
                    },
                    {
                        question: "What is the verb in this passive sentence? The message was sent yesterday.",
                        type: "input",
                        answer: "was sent",
                        hint: "In passive sentences, the verb includes a form of 'be' plus the past participle."
                    },
                    {
                        question: "Use a hyphen to avoid ambiguity: I saw a man eating shark.",
                        type: "input",
                        answer: "I saw a man-eating shark.",
                        hint: "Without the hyphen, it sounds like a man is eating a shark!"
                    },
                    {
                        question: "Which word is a synonym for 'vital'?",
                        type: "multiple",
                        options: ["unnecessary", "essential", "boring"],
                        answer: "essential",
                        hint: "A synonym means the same thing. Which word means the same as 'vital'?"
                    },
                    {
                        question: "Change this to the subjunctive mood: It is important that he is on time.",
                        type: "input",
                        answer: "It is important that he be on time.",
                        hint: "In subjunctive mood after 'that', use the base form of the verb."
                    },
                    {
                        question: "The words 'practice' (noun) and 'practise' (verb) are examples of...",
                        type: "input",
                        answer: "Homophones",
                        hint: "These words sound the same but have different spellings and meanings."
                    },
                    {
                        question: "Which is more formal?",
                        type: "multiple",
                        options: ["I think...", "It is considered that..."],
                        answer: "It is considered that...",
                        hint: "Formal language avoids personal pronouns like 'I'."
                    },
                    {
                        question: "Add dashes for parenthesis: The old house which had been empty for years was finally sold.",
                        type: "input",
                        answer: "The old house  which had been empty for years  was finally sold.",
                        hint: "Dashes can replace commas or brackets around extra information."
                    }],
                'arithmetic': [
                    // Year 6 Arithmetic (25 questions)
                    {
                        question: "1,582  24 = ?",
                        type: "input",
                        answer: "37968",
                        hint: "Use long multiplication. Multiply by 4 first, then by 20, then add the results."
                    },
                    {
                        question: "1,872  12 = ?",
                        type: "input",
                        answer: "156",
                        hint: "Use long division. How many 12s go into 18? Then 7? Then 2?"
                    },
                    {
                        question: "20% of 1,500 = ?",
                        type: "input",
                        answer: "300",
                        hint: "20% = 1/5. Divide 1,500 by 5."
                    },
                    {
                        question: "2/5 + 1/4 = ?",
                        type: "input",
                        answer: "13/20",
                        hint: "Find a common denominator. 2/5 = 8/20 and 1/4 = 5/20."
                    },
                    {
                        question: "3/4  2 = ?",
                        type: "input",
                        answer: "3/8",
                        hint: "Dividing by 2 is the same as multiplying by 1/2."
                    },
                    {
                        question: "10 - (4  1.5) = ?",
                        type: "input",
                        answer: "4",
                        hint: "Do the brackets first: 4  1.5 = 6, then 10 - 6 = 4."
                    },
                    {
                        question: "1 1/2  20 = ?",
                        type: "input",
                        answer: "30",
                        hint: "1 1/2 = 1.5, so 1.5  20 = 30."
                    },
                    {
                        question: "99% of 300 = ?",
                        type: "input",
                        answer: "297",
                        hint: "99% is nearly 100%. 100% of 300 = 300, so 99% = 300 - 3 = 297."
                    },
                    {
                        question: "1,596  28 = ?",
                        type: "input",
                        answer: "57",
                        hint: "Use long division or think: 28  50 = 1,400, so 28  57 = ?"
                    },
                    {
                        question: "25  1.4 = ?",
                        type: "input",
                        answer: "35",
                        hint: "25  1.4 = 25  1 + 25  0.4 = 25 + 10 = 35."
                    },
                    {
                        question: "30  (2.5 + 0.5) = ?",
                        type: "input",
                        answer: "90",
                        hint: "Do the brackets first: 2.5 + 0.5 = 3, then 30  3 = 90."
                    },
                    {
                        question: "2/3  1/4 = ?",
                        type: "input",
                        answer: "1/6",
                        hint: "Multiply the top numbers together and the bottom numbers together."
                    },
                    {
                        question: "1,234  31 = ?",
                        type: "input",
                        answer: "38254",
                        hint: "Use long multiplication: 1,234  30 + 1,234  1."
                    },
                    {
                        question: "30 - 5  4 + 2 = ?",
                        type: "input",
                        answer: "12",
                        hint: "Follow BODMAS: 5  4 = 20, then 30 - 20 + 2 = 12."
                    },
                    {
                        question: "2.5  100 = ?",
                        type: "input",
                        answer: "0.025",
                        hint: "Dividing by 100 moves the decimal point 2 places left."
                    },
                    {
                        question: "3,472  16 = ?",
                        type: "input",
                        answer: "217",
                        hint: "Use long division or work out 16  200 first."
                    },
                    {
                        question: "2.5  28 = ?",
                        type: "input",
                        answer: "70",
                        hint: "2.5  28 = 2.5  4  7 = 10  7 = 70."
                    },
                    {
                        question: "15% of 600 = ?",
                        type: "input",
                        answer: "90",
                        hint: "10% of 600 = 60, so 15% = 60 + 30 = 90."
                    },
                    {
                        question: "2 1/4 - 1 1/2 = ?",
                        type: "input",
                        answer: "3/4",
                        hint: "Convert to quarters: 2 1/4 - 1 2/4 = 3/4."
                    },
                    {
                        question: "1/5  4 = ?",
                        type: "input",
                        answer: "1/20",
                        hint: "Dividing by 4 is the same as multiplying by 1/4."
                    },
                    {
                        question: "25  36 = ?",
                        type: "input",
                        answer: "900",
                        hint: "25  36 = 25  4  9 = 100  9 = 900."
                    },
                    {
                        question: "1,000  0.06 = ?",
                        type: "input",
                        answer: "60",
                        hint: "Multiplying by 1,000 moves the decimal point 3 places right."
                    },
                    {
                        question: "40  29 = ?",
                        type: "input",
                        answer: "1160",
                        hint: "40  29 = 40  30 - 40  1 = 1,200 - 40 = 1,160."
                    },
                    {
                        question: "1 - 0.01 = ?",
                        type: "input",
                        answer: "0.99",
                        hint: "1 - 0.01 = 1.00 - 0.01 = 0.99."
                    },
                    {
                        question: "12  1 1/4 = ?",
                        type: "input",
                        answer: "15",
                        hint: "1 1/4 = 1.25, so 12  1.25 = 15."
                    }],
                'reasoning': [
                    // Year 6 Reasoning (25 questions)
                    {
                        question: "If a = 4, what is the value of 3a + 5?",
                        type: "input",
                        answer: "17",
                        hint: "Replace 'a' with 4: 3  4 + 5 = 12 + 5 = 17."
                    },
                    {
                        question: "The ratio of cats to dogs is 2:5. If there are 10 dogs, how many cats are there?",
                        type: "input",
                        answer: "4",
                        hint: "If 5 parts = 10 dogs, then 1 part = 2. So 2 parts = 4 cats."
                    },
                    {
                        question: "What is the mean of these three numbers: 8, 12, 13?",
                        type: "input",
                        answer: "11",
                        hint: "Add them up: 8 + 12 + 13 = 33. Then divide by 3: 33  3 = 11."
                    },
                    {
                        question: "A jacket costing 120 is in a 25% off sale. What is the sale price?",
                        type: "input",
                        answer: "90",
                        hint: "25% of 120 = 30. So sale price = 120 - 30 = 90."
                    },
                    {
                        question: "What is the volume of a cuboid with sides 2cm, 5cm and 10cm?",
                        type: "input",
                        answer: "100cm",
                        hint: "Volume = length  width  height = 2  5  10 = 100cm."
                    },
                    {
                        question: "Here are four statements about a parallelogram. Which is true?",
                        type: "multiple",
                        options: ["It has four right angles.", "It has two pairs of parallel sides.", "All four sides are always equal."],
                        answer: "It has two pairs of parallel sides.",
                        hint: "A parallelogram has opposite sides that are parallel and equal."
                    },
                    {
                        question: "A map scale is 1cm to 5km. A path on the map is 3.5cm long. How long is the real path?",
                        type: "input",
                        answer: "17.5km",
                        hint: "Multiply the map distance by the scale: 3.5  5 = 17.5km."
                    },
                    {
                        question: "A painter mixes blue and white paint in a 1:3 ratio. If she uses 2 litres of blue paint, how much white paint does she use?",
                        type: "input",
                        answer: "6 litres",
                        hint: "If 1 part blue = 2 litres, then 3 parts white = 3  2 = 6 litres."
                    },
                    {
                        question: "Simplify the ratio 16:24.",
                        type: "input",
                        answer: "2:3",
                        hint: "Find the highest common factor: both divide by 8. 168 : 248 = 2:3."
                    },
                    {
                        question: "A car travels 90 miles in 1 hour and 30 minutes. What is its average speed in mph?",
                        type: "input",
                        answer: "60 mph",
                        hint: "1.5 hours = 90 minutes. Speed = distance  time = 90  1.5 = 60 mph."
                    },
                    {
                        question: "A number sequence is described by the rule '2n + 1'. What is the 5th term in the sequence?",
                        type: "input",
                        answer: "11",
                        hint: "Replace n with 5: 2  5 + 1 = 10 + 1 = 11."
                    },
                    {
                        question: "The area of a triangle is 18cm. The base is 6cm. What is the height?",
                        type: "input",
                        answer: "6cm",
                        hint: "Area =   base  height. So 18 =   6  height. Height = 6cm."
                    },
                    {
                        question: "I think of a number, divide it by 2, and then add 7. My answer is 15. What was my number?",
                        type: "input",
                        answer: "16",
                        hint: "Work backwards: 15 - 7 = 8, then 8  2 = 16."
                    },
                    {
                        question: "Increase 80 by 15%.",
                        type: "input",
                        answer: "92",
                        hint: "15% of 80 = 12. So 80 + 12 = 92."
                    },
                    {
                        question: "A pie chart shows 240 children. The angle for 'Swimming' is 90. How many children chose swimming?",
                        type: "input",
                        answer: "60",
                        hint: "90 is  of 360. So  of 240 = 60 children."
                    },
                    {
                        question: "What is the value of x in 20 = 2x + 10?",
                        type: "input",
                        answer: "5",
                        hint: "Subtract 10 from both sides: 10 = 2x. Then divide by 2: x = 5."
                    },
                    {
                        question: "A circle has a diameter of 10cm. What is its circumference? (Use   3.14)",
                        type: "input",
                        answer: "31.4cm",
                        hint: "Circumference =   diameter = 3.14  10 = 31.4cm."
                    },
                    {
                        question: "A recipe for 8 people needs 300g of flour. How much flour is needed for 12 people?",
                        type: "input",
                        answer: "450g",
                        hint: "Scale factor = 12  8 = 1.5. So 300g  1.5 = 450g."
                    },
                    {
                        question: "Two numbers have a product of 48 and a sum of 14. What are the numbers?",
                        type: "input",
                        answer: "6 and 8",
                        hint: "Try factor pairs of 48: 6  8 = 48 and 6 + 8 = 14."
                    },
                    {
                        question: "A phone bill is 15 per month plus 10p per minute for calls. What is the bill if you use 50 minutes of calls?",
                        type: "input",
                        answer: "20",
                        hint: "50  10p = 500p = 5. Total = 15 + 5 = 20."
                    },
                    {
                        question: "Find the size of angle 'a'. (A point with angles 100, 90, and 'a')",
                        type: "input",
                        answer: "170",
                        hint: "Angles around a point = 360. So a = 360 - 100 - 90 = 170."
                    },
                    {
                        question: "Which is better value for money?",
                        type: "multiple",
                        options: ["3 apples for 90p", "5 apples for 1.40"],
                        answer: "5 apples for 1.40",
                        hint: "Work out the cost per apple: 90p  3 = 30p each vs 1.40  5 = 28p each."
                    },
                    {
                        question: "The mean age of 3 people is 20. Two of them are 18 and 22. How old is the third person?",
                        type: "input",
                        answer: "20",
                        hint: "Total age = 3  20 = 60. Third person = 60 - 18 - 22 = 20."
                    },
                    {
                        question: "A cube has a volume of 27cm. What is the length of one of its sides?",
                        type: "input",
                        answer: "3cm",
                        hint: "Volume = side. So side = 27 = 3cm."
                    },
                    {
                        question: "A bag has red and blue marbles. The probability of picking a red marble is 0.4. What is the probability of picking a blue one?",
                        type: "input",
                        answer: "0.6",
                        hint: "All probabilities add up to 1. So blue = 1 - 0.4 = 0.6."
                    }]
            }
        };

        // Enhanced User Data Management
        let userData = {
            name: '',
            totalPoints: 0,
            quizzesCompleted: 0,
            topicScores: {},
            achievements: [],
            level: 1,
            startTime: null,
            lastLoginDate: null,
            // New Gamification Fields
            totalXP: 0,
            adventurePoints: 0,
            ownedItems: []
        };

        // Quest Rank System
        function getQuestRank(level) {
            const ranks = {
                1: " Apprentice Scholar",
                2: " Brave Questor", 
                3: " Skilled Explorer",
                4: " Master Adventurer",
                5: " SATs Champion"
            };
            
            if (level <= 5) {
                return ranks[level];
            } else {
                return ` Legendary Scholar ${level - 5}`;
            }
        }
        
        function getNextQuestRank(level) {
            const nextLevel = level + 1;
            if (nextLevel <= 5) {
                return getQuestRank(nextLevel);
            } else {
                return ` Legendary Scholar ${nextLevel - 5}`;
            }
        }

        // Pack Progress System
        let packProgress = {};

        // Daily Challenge System
        const dailyChallenges = [
            { topic: 'reading', target: 3, description: 'Master 3 reading comprehension questions!' },
            { topic: 'grammar', target: 5, description: 'Perfect 5 grammar challenges today!' },
            { topic: 'mathematics', target: 10, description: 'Solve 10 mathematical puzzles!' }
        ];

        // Topic Names Mapping
        const topicNames = {
            'year5': 'Year 5 Foundation',
            'year6': 'Year 6 SATs Ready'
        };

        // Current variables
        let currentTopic = '';
        let currentPackTopic = '';
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let score = 0;
        let quizStartTime = null;
        let hintsUsed = 0;
        const MAX_HINTS = 3;

        // Show Pack Selection (Updated for Year 5/6 Structure)
        function showPackSelection(yearLevel) {
            currentPackTopic = yearLevel;
            
            // Hide dashboard and show pack selection
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('packSelectionContainer').style.display = 'block';
            
            // Update title based on year level
            const yearNames = {
                'year5': 'Year 5 Foundation',
                'year6': 'Year 6 SATs Ready'
            };
            document.getElementById('packSelectionTitle').textContent = `${yearNames[yearLevel]} - Choose Your Subject`;
            
            // Update subject button text to reflect year level
            updateSubjectButtons(yearLevel);
        }

        // Update Subject Buttons for Year Level
        function updateSubjectButtons(yearLevel) {
            const readingBtn = document.getElementById('readingBtn');
            const grammarBtn = document.getElementById('grammarBtn');
            const arithmeticBtn = document.getElementById('arithmeticBtn');
            const reasoningBtn = document.getElementById('reasoningBtn');
            
            // Update button text based on year level
            if (yearLevel === 'year5') {
                readingBtn.textContent = 'Start Year 5 Reading';
                grammarBtn.textContent = 'Start Year 5 Grammar';
                arithmeticBtn.textContent = 'Start Year 5 Arithmetic';
                reasoningBtn.textContent = 'Start Year 5 Reasoning';
            } else if (yearLevel === 'year6') {
                readingBtn.textContent = 'Start Year 6 Reading';
                grammarBtn.textContent = 'Start Year 6 Grammar';
                arithmeticBtn.textContent = 'Start Year 6 Arithmetic';
                reasoningBtn.textContent = 'Start Year 6 Reasoning';
            }
            
            // All subjects are always available (no lock/unlock system)
            readingBtn.disabled = false;
            grammarBtn.disabled = false;
            arithmeticBtn.disabled = false;
            reasoningBtn.disabled = false;
        }

        // Variables for quiz type selection
        let selectedYearLevel = '';
        let selectedSubject = '';
        let selectedQuestLevel = 1;

        // Show Quiz Type Selection (Updated for Quick Quiz vs Full Practice)
        function startQuizPack(yearLevel, subject) {
            selectedYearLevel = yearLevel;
            selectedSubject = subject;
            
            // Hide pack selection and show quiz type selection
            document.getElementById('packSelectionContainer').style.display = 'none';
            document.getElementById('quizTypeContainer').style.display = 'block';
            
            // Update title with subject info
            const subjectNames = {
                'reading': 'Reading',
                'grammar': 'Grammar & Spelling',
                'arithmetic': 'Arithmetic',
                'reasoning': 'Mathematical Reasoning'
            };
            document.getElementById('quizTypeTitle').textContent = `${subjectNames[subject]} Practice`;
        }

        // Start Quiz with Selected Type (Quick or Full)
        function startQuiz(quizType) {
            console.log(` Starting ${quizType} quiz for ${selectedYearLevel} ${selectedSubject}`);
            
            // Handle Quest Mode vs Practice Zone
            if (quizType === 'mixed-quest') {
                // Quest Mode: Already handled by generateMixedQuestQuestions()
                currentTopic = 'mixed-quest';
            } else {
                // Practice Zone: Use separate question bank
                currentTopic = selectedYearLevel;
                
                if (quizType === 'quick') {
                    generatePracticeZoneQuestions(selectedYearLevel, selectedSubject, 10);
                } else {
                    generatePracticeZoneQuestions(selectedYearLevel, selectedSubject, 13); // Full Workout uses all 13 practice questions
                }
            }
            
            currentQuestionIndex = 0;
            userAnswers = new Array(currentQuestions.length).fill('');
            score = 0;
            quizStartTime = Date.now();
            hintsUsed = 0;
            
            // Initialize feedback system variables
            currentStreak = 0;
            questionsAnswered = 0;
            
            // Hide appropriate containers and show quiz
            document.getElementById('quizTypeContainer').style.display = 'none';
            document.getElementById('questMapContainer').style.display = 'none';
            document.getElementById('quizContainer').style.display = 'block';
            
            // Update quiz title based on mode
            if (quizType === 'mixed-quest') {
                document.getElementById('quizTitle').textContent = `Quest Level ${selectedQuestLevel}: Scholar's Adventure`;
            } else if (quizType === 'quest-mixed' || currentTopic === 'quest-mixed') {
                // Quest mode with mixed questions
                document.getElementById('quizTitle').textContent = `Quest Level ${selectedQuestLevel}: Scholar's Adventure`;
            } else {
                // Practice Zone mode
                const yearNames = {
                    'year5': 'Year 5 Foundation',
                    'year6': 'Year 6 SATs Ready'
                };
                const subjectNames = {
                    'reading': 'Reading',
                    'grammar': 'Grammar & Spelling',
                    'arithmetic': 'Arithmetic',
                    'reasoning': 'Mathematical Reasoning'
                };
                const quizTypeText = quizType === 'quick' ? 'Quick Quiz' : 'Full Workout';
                
                // Ensure variables are defined before using them
                const yearName = yearNames[selectedYearLevel] || 'Unknown Year';
                const subjectName = subjectNames[selectedSubject] || 'Mixed Subjects';
                
                document.getElementById('quizTitle').textContent = `${yearName} - ${subjectName} (${quizTypeText})`;
            }
            
            displayQuestion();
        }

        // Back to Pack Selection from Quiz Type Selection
        function backToPackSelection() {
            document.getElementById('quizTypeContainer').style.display = 'none';
            document.getElementById('packSelectionContainer').style.display = 'block';
        }

        // Utility function to shuffle array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Connect to Smart Greeting System functions

        // Smart Greeting System
        function getSmartGreeting(userData) {
            const name = userData.name;
            const quizzes = userData.quizzesCompleted;
            // Calculate approximate average (assuming average of 17.5 questions per quiz)
            const avgQuestionsPerQuiz = 17.5; // Between 10 (quick) and 25 (full)
            const averageScore = userData.totalPoints > 0 ? Math.round((userData.totalPoints / (quizzes * avgQuestionsPerQuiz * 10)) * 100) : 0;
            const daysSinceLastLogin = userData.lastLoginDate ? 
                Math.floor((Date.now() - new Date(userData.lastLoginDate).getTime()) / (1000 * 60 * 60 * 24)) : 0;
            
            // First time user
            if (quizzes === 0) {
                return `Hi ${name}! `;
            }
            
            // Returning after break (more than 3 days)
            if (daysSinceLastLogin > 3) {
                return `Welcome back, ${name}! `;
            }
            
            // High achiever (90%+ average)
            if (averageScore >= 90) {
                return `Amazing work, ${name}! ${averageScore}% average `;
            }
            
            // Good progress (70%+ average)
            if (averageScore >= 70) {
                return `Great progress, ${name}! ${averageScore}% average `;
            }
            
            // Lots of activity (10+ quizzes)  
            if (quizzes >= 10) {
                return `${quizzes} quizzes completed  ${averageScore}% average `;
            }
            
            // Early progress - handle singular/plural correctly
            if (quizzes <= 5) {
                const quizText = quizzes === 1 ? 'quiz' : 'quizzes';
                return `${quizzes} ${quizText} completed  Keep going! `;
            }
            
            // Regular display - handle singular/plural correctly  
            const quizText = quizzes === 1 ? 'quiz' : 'quizzes';
            return `${quizzes} ${quizText} completed  ${averageScore}% average`;
        }

        // Initialize the app when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        // Initialize App
        function initializeApp() {
            // Load user data from localStorage
            const savedUserData = localStorage.getItem('userData');
            if (savedUserData) {
                Object.assign(userData, JSON.parse(savedUserData));
            }
            
            // Load settings from localStorage
            loadSettings();
            
            // Setup custom logo
            setupCustomLogo();
            
            // Update dashboard
            updateDashboard();
        }

        // Setup custom logo (owl image if available, star if not)
        function setupCustomLogo() {
            const logoElement = document.getElementById('welcomeLogo');
            if (!logoElement) return;

            // Try to load the custom owl image
            const img = new Image();
            img.onload = function() {
                // Image loaded successfully, use it
                logoElement.innerHTML = '<img src="owl-logo.png" alt="SATs Quest Owl" class="logo-image">';
                console.log(' Custom owl logo loaded successfully');
            };
            img.onerror = function() {
                // Image failed to load, keep the star
                logoElement.innerHTML = '';
                console.log(' Using default star logo (owl image not found)');
            };
            img.src = 'owl-logo.png';
        }
        
        // BLUEPRINT: Update Hub Display - Central navigation with gamification
        function updateHubDisplay() {
            console.log(' updateHubDisplay() called - BLUEPRINT VERSION');
            
            if (userData.name) {
                // Update personalised greeting
                const greetingElement = document.getElementById('userName-display');
                if (greetingElement) {
                    greetingElement.textContent = `Hi ${userData.name}!`;
                }
                
                // Update rank display with current level and rank name
                updateRankDisplay();
                
                // Update XP progress bar
                updateXPDisplay();
                
                // Update adventure points display
                updateAdventurePointsDisplay();
                
                // Update dynamic quest button text
                updateQuestButtonText();
                
                // Update stats for Hub Screen
                updateHubStats();
                
                console.log(' Hub Display updated with BLUEPRINT gamification system');
            }
        }

        // Update Quest Button Text (Start vs Continue)
        function updateQuestButtonText() {
            const questButtonElement = document.getElementById('questButtonText');
            if (questButtonElement) {
                // Check if user has completed any quest levels
                const completedLevels = userData.completedQuestLevels || [];
                
                // Check if user has any XP (indicating they've started the journey)
                const hasStarted = (userData.xp && userData.xp > 0) || completedLevels.length > 0;
                
                if (hasStarted) {
                    questButtonElement.textContent = 'Continue Main Quest';
                } else {
                    questButtonElement.textContent = 'Start Main Quest';
                }
                
                console.log(` Quest button text updated: ${questButtonElement.textContent}`);
            }
        }

        // Legacy function for backward compatibility
        function updateDashboard() {
            updateHubDisplay();
        }

        // Save User Data to localStorage
        function saveUserData() {
            localStorage.setItem('satsUserData', JSON.stringify(userData));
        }

        // BLUEPRINT: Core Gamification Functions
        
        // Update Hub Stats Display
        function updateHubStats() {
            // Update quests completed and current level
            const questsElement = document.getElementById('questsCompleted');
            const levelElement = document.getElementById('currentLevelStat');
            
            if (questsElement) questsElement.textContent = userData.quizzesCompleted || 0;
            if (levelElement) levelElement.textContent = userData.level || 1;
        }
        
        // Calculate XP required for a specific level
        function getXPRequiredForLevel(level) {
            return Math.floor(100 * Math.pow(1.2, level - 1));
        }
        
        // Add XP (only in Quest mode)
        function addXP(points) {
            if (!userData.level) userData.level = 1;
            if (!userData.xp) userData.xp = 0;
            
            userData.xp += points;
            console.log(` Added ${points} XP. Total: ${userData.xp}`);
            
            checkLevelUp();
            updateXPDisplay();
            saveUserData();
        }
        
        // Check for level up
        function checkLevelUp() {
            const currentLevel = userData.level || 1;
            const requiredXP = getXPRequiredForLevel(currentLevel + 1);
            
            if (userData.xp >= requiredXP) {
                userData.level = currentLevel + 1;
                console.log(` LEVEL UP! Now Level ${userData.level}`);
                
                // Show level up animation/notification
                setTimeout(() => {
                    alert(` Level Up! You are now Level ${userData.level}!`);
                }, 300);
                
                updateRankDisplay();
            }
        }
        
        // Add Adventure Points (only in Quest mode)
        function addAdventurePoints(points) {
            if (!userData.adventurePoints) userData.adventurePoints = 0;
            
            userData.adventurePoints += points;
            console.log(` Added ${points} Adventure Points. Total: ${userData.adventurePoints}`);
            
            updateAdventurePointsDisplay();
            saveUserData();
        }
        
        // Spend Adventure Points
        function spendAdventurePoints(cost) {
            if (!userData.adventurePoints) userData.adventurePoints = 0;
            
            if (userData.adventurePoints >= cost) {
                userData.adventurePoints -= cost;
                updateAdventurePointsDisplay();
                saveUserData();
                return true;
            }
            return false;
        }

        // BLUEPRINT: Navigation Functions for Two Distinct Paths
        
        // Path A: Continue Main Quest - Navigate to Quest Map
        function showQuestMap() {
            console.log(' showQuestMap() called - BLUEPRINT QUEST PATH');
            hideAllScreens();
            
            // Show quest map screen (if it exists) or create a simple quest level selector
            const questMapScreen = document.getElementById('questMapScreen');
            if (questMapScreen) {
                questMapScreen.style.display = 'block';
            } else {
                // Fallback: For now, start a quest-mode quiz directly
                startQuestMode();
            }
        }
        
        // Path B: Go to Practice Zone - Navigate to Year Selection
        function showPracticeZone() {
            console.log(' showPracticeZone() called - BLUEPRINT PRACTICE PATH');
            
            // This should lead to Year Level selection, then Subject, then Quiz Length
            showYearSelection();
        }
        
        // Show Year Selection Screen
        function showYearSelection() {
            console.log(' showYearSelection() called');
            hideAllScreens();
            
            // For now, show the existing pack selection but modify the flow
            document.getElementById('packSelectionContainer').style.display = 'block';
        }
        
        // Start Quest Mode (10 questions, mixed subjects, awards XP)
        function startQuestMode() {
            console.log(' Starting Quest Mode - BLUEPRINT IMPLEMENTATION');
            
            userData.mode = 'quest'; // Track that we're in quest mode
            
            // Set quest parameters
            currentTopic = 'quest-mixed';
            currentQuizLength = 10; // Fixed 10 questions for quest mode
            
            // Start a mixed-subject quiz
            startQuiz('quest-mixed', 10);
        }
        
        // Navigate back to Hub Screen
        function backToHub() {
            console.log(' backToHub() called - Return to Hub Screen');
            showHubScreen();
        }

        // Start User Journey - FIXED VERSION
        function startJourney() {
            console.log(' startJourney() called - FIXED VERSION');
            
            try {
                const nameInput = document.getElementById('userName');
                console.log(' nameInput element:', nameInput);
                
                if (!nameInput) {
                    console.error(' userName input not found!');
                    alert('Error: Name input not found!');
                    return;
                }
                
                const name = nameInput.value.trim();
                console.log(' User entered name:', name);
                
                if (!name) {
                    console.log(' No name entered, showing error');
                    alert('Please enter your name!');
                    nameInput.style.borderColor = '#ef4444';
                    setTimeout(() => nameInput.style.borderColor = '', 2000);
                    return;
                }
                
                // Simple, safe userData initialization
                if (typeof userData === 'undefined') {
                    window.userData = {};
                }
                
                userData.name = name;
                userData.startTime = new Date().toISOString();
                userData.level = userData.level || 1;
                userData.xp = userData.xp || 0;
                userData.adventurePoints = userData.adventurePoints || 0;
                userData.unlockedLevels = userData.unlockedLevels || 1;
                userData.ownedItems = userData.ownedItems || [];
                
                console.log(' Saving user data:', userData);
                
                // Try to save - but don't fail if it doesn't work
                try {
                    saveUserData();
                } catch (saveError) {
                    console.warn(' Save failed, but continuing:', saveError);
                }
                
                console.log(' Calling showHubScreen() - FIXED NAVIGATION');
                
                // Simple, direct navigation
                document.getElementById('welcomeScreen').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                
                // Try to update dashboard
                try {
                    updateHubDisplay();
                } catch (updateError) {
                    console.warn(' Hub update failed, but navigated:', updateError);
                }
                
                console.log(' Navigation completed successfully!');
                
            } catch (error) {
                console.error(' Critical error in startJourney:', error);
                alert('Something went wrong. Please refresh the page and try again.');
            }
        }

        // Show Welcome Screen
        function showWelcomeScreen() {
            document.getElementById('welcomeScreen').style.display = 'flex';
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('resultsContainer').style.display = 'none';
        }

        // Hide All Screens
        function hideAllScreens() {
            console.log(' hideAllScreens() called');
            
            // Hide all possible containers
            const containers = [
                'welcomeScreen',
                'quizContainer', 
                'resultsContainer',
                'packSelectionContainer',
                'quizTypeContainer', 
                'feedbackContainer',
                'questMapContainer',
                'yearLevelContainer',
                'rankProgressionContainer',
                'rewardsShopContainer'
            ];
            
            containers.forEach(containerId => {
                const element = document.getElementById(containerId);
                if (element) {
                    element.style.display = 'none';
                }
            });
        }

        // BLUEPRINT: Show Hub Screen - Central navigation point
        function showHubScreen() {
            console.log(' showHubScreen() called - BLUEPRINT VERSION');
            
            const welcomeScreen = document.getElementById('welcomeScreen');
            const dashboard = document.getElementById('dashboard');
            
            console.log(' welcomeScreen element:', welcomeScreen);
            console.log(' dashboard element:', dashboard);
            
            if (!welcomeScreen || !dashboard) {
                console.error(' Required elements not found!');
                return;
            }
            
            // Hide all screens and show Hub Screen (dashboard)
            hideAllScreens();
            document.getElementById('dashboard').style.display = 'block';
            
            console.log(' Calling updateHubDisplay()');
            updateHubDisplay();
            console.log(' showHubScreen() completed');
        }

        // Legacy function for backward compatibility
        function showDashboard() {
            showHubScreen();
        }

        // Display Question
        function displayQuestion() {
            console.log(' displayQuestion() called');
            console.log(' currentQuestionIndex:', currentQuestionIndex);
            console.log(' currentQuestions.length:', currentQuestions.length);
            console.log(' currentQuestions:', currentQuestions);
            
            const question = currentQuestions[currentQuestionIndex];
            console.log(' Current question:', question);
            
            if (!question) {
                console.error(' No question found at index', currentQuestionIndex);
                alert('Error: Question not found');
                return;
            }
            
            // Update progress
            const progress = ((currentQuestionIndex + 1) / currentQuestions.length) * 100;
            document.getElementById('quizProgressFill').style.width = `${progress}%`;
            document.getElementById('quizProgressText').textContent = `Question ${currentQuestionIndex + 1} of ${currentQuestions.length}`;
            
            // Question content
            document.getElementById('questionNumber').textContent = `Question ${currentQuestionIndex + 1}`;
            
            // Show passage if it exists (for reading comprehension questions)
            const passageElement = document.getElementById('passageText');
            if (question.passage) {
                console.log(' Displaying passage:', question.passage.substring(0, 50) + '...');
                passageElement.textContent = question.passage;
                passageElement.style.display = 'block';
            } else {
                passageElement.style.display = 'none';
            }
            
            console.log(' Displaying question:', question.question);
            document.getElementById('questionText').textContent = question.question;
            
            // Hide hint box
            document.getElementById('hintBox').classList.remove('show');
            
            // Create answer interface
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            if (question.type === 'multiple') {
                question.options.forEach((option, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'option';
                    if (userAnswers[currentQuestionIndex] === option) {
                        optionDiv.classList.add('selected');
                    }
                    
                    optionDiv.innerHTML = `
                        <div class="option-letter">${String.fromCharCode(65 + index)}</div>
                        <span>${option}</span>
                    `;
                    
                    optionDiv.addEventListener('click', function() {
                        document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
                        this.classList.add('selected');
                        userAnswers[currentQuestionIndex] = option;
                    });
                    
                    optionsContainer.appendChild(optionDiv);
                });
            } else if (question.type === 'highlight') {
                // Create "Tap to Highlight" interface for word/phrase identification
                const instructionDiv = document.createElement('div');
                instructionDiv.className = 'highlight-instruction';
                instructionDiv.style.cssText = `
                    font-size: 1.1rem;
                    margin-bottom: 20px;
                    padding: 15px;
                    background: #eff6ff;
                    border-radius: 10px;
                    border-left: 4px solid #3b82f6;
                    color: #1e40af;
                `;
                instructionDiv.textContent = "Tap the words to highlight them. Tap again to unhighlight.";
                
                const sentenceDiv = document.createElement('div');
                sentenceDiv.className = 'highlight-sentence';
                sentenceDiv.style.cssText = `
                    font-size: 1.3rem;
                    line-height: 1.8;
                    margin: 20px 0;
                    padding: 25px;
                    background: #f8fafc;
                    border-radius: 12px;
                    border: 2px solid #e2e8f0;
                    text-align: left;
                `;
                
                // Initialize user's selections if not exists
                if (!userAnswers[currentQuestionIndex]) {
                    userAnswers[currentQuestionIndex] = [];
                }
                
                // Clean and split sentence into words, preserving punctuation
                const sentence = question.sentence;
                const words = sentence.split(/(\s+|[,.!?;:])/); // Split on spaces and punctuation, keeping delimiters
                
                words.forEach((word, index) => {
                    if (word.trim() === '') {
                        // Just add whitespace as text
                        sentenceDiv.appendChild(document.createTextNode(word));
                        return;
                    }
                    
                    if (/^[,.!?;:]$/.test(word)) {
                        // Punctuation - not clickable
                        const punctSpan = document.createElement('span');
                        punctSpan.textContent = word;
                        punctSpan.style.cssText = `
                            color: #374151;
                            margin: 0;
                        `;
                        sentenceDiv.appendChild(punctSpan);
                        return;
                    }
                    
                    // Regular word - make it clickable
                    const cleanWord = word.replace(/[,.!?;:]/g, ''); // Remove punctuation for matching
                    const wordSpan = document.createElement('span');
                    wordSpan.className = 'highlight-word';
                    wordSpan.textContent = word;
                    wordSpan.setAttribute('data-word', cleanWord.toLowerCase());
                    
                    // Check if this word is currently selected
                    const isSelected = userAnswers[currentQuestionIndex].includes(cleanWord.toLowerCase());
                    
                    wordSpan.style.cssText = `
                        display: inline-block;
                        padding: 2px 4px;
                        margin: 1px;
                        border-radius: 4px;
                        cursor: pointer;
                        transition: all 0.2s ease;
                        background: ${isSelected ? '#3b82f6' : 'transparent'};
                        color: ${isSelected ? 'white' : '#374151'};
                        user-select: none;
                    `;
                    
                    wordSpan.addEventListener('click', function() {
                        const word = this.getAttribute('data-word');
                        const currentSelections = userAnswers[currentQuestionIndex] || [];
                        
                        if (currentSelections.includes(word)) {
                            // Remove selection
                            userAnswers[currentQuestionIndex] = currentSelections.filter(w => w !== word);
                            this.style.background = 'transparent';
                            this.style.color = '#374151';
                        } else {
                            // Add selection
                            userAnswers[currentQuestionIndex].push(word);
                            this.style.background = '#3b82f6';
                            this.style.color = 'white';
                        }
                        
                        playSound('click');
                    });
                    
                    wordSpan.addEventListener('mouseenter', function() {
                        if (!userAnswers[currentQuestionIndex].includes(cleanWord.toLowerCase())) {
                            this.style.background = '#e0e7ff';
                        }
                    });
                    
                    wordSpan.addEventListener('mouseleave', function() {
                        if (!userAnswers[currentQuestionIndex].includes(cleanWord.toLowerCase())) {
                            this.style.background = 'transparent';
                        }
                    });
                    
                    sentenceDiv.appendChild(wordSpan);
                });
                
                optionsContainer.appendChild(instructionDiv);
                optionsContainer.appendChild(sentenceDiv);
            } else if (question.type === 'punctuate') {
                // Create interactive sentence with tappable punctuation points
                const sentenceDiv = document.createElement('div');
                sentenceDiv.className = 'punctuate-sentence';
                sentenceDiv.style.cssText = `
                    font-size: 1.2rem;
                    line-height: 1.8;
                    margin: 20px 0;
                    padding: 20px;
                    background: #f8fafc;
                    border-radius: 12px;
                    border: 2px solid #e2e8f0;
                `;
                
                // Initialize user's punctuation state if not exists
                if (!userAnswers[currentQuestionIndex]) {
                    userAnswers[currentQuestionIndex] = [];
                }
                
                const words = question.sentence.split(' ');
                words.forEach((word, index) => {
                    const wordSpan = document.createElement('span');
                    
                    if (word === '') {
                        // This is a tappable punctuation point
                        wordSpan.className = 'punctuation-point';
                        const isSelected = userAnswers[currentQuestionIndex].includes(index);
                        
                        // Handle different punctuation types
                        let displayPunctuation = question.punctuation;
                        if (question.punctuation === '()') {
                            // For brackets, determine which bracket based on position
                            const selectedPositions = userAnswers[currentQuestionIndex] || [];
                            const correctPositions = question.positions || [];
                            const isFirstPosition = correctPositions.length > 0 && index === correctPositions[0];
                            displayPunctuation = isFirstPosition ? '(' : ')';
                        }
                        
                        wordSpan.textContent = isSelected ? displayPunctuation : '';
                        wordSpan.style.cssText = `
                            display: inline-block;
                            width: 30px;
                            height: 30px;
                            line-height: 30px;
                            text-align: center;
                            margin: 0 5px;
                            border-radius: 15px;
                            cursor: pointer;
                            font-weight: bold;
                            transition: all 0.3s ease;
                            ${isSelected ? 
                                'background: #10b981; color: white; border: 2px solid #10b981;' : 
                                'background: #fbbf24; color: white; border: 2px solid #fbbf24; transform: scale(1.1);'
                            }
                        `;
                        
                        wordSpan.addEventListener('click', function() {
                            const punctIndex = index;
                            if (userAnswers[currentQuestionIndex].includes(punctIndex)) {
                                // Remove punctuation
                                userAnswers[currentQuestionIndex] = userAnswers[currentQuestionIndex].filter(i => i !== punctIndex);
                                this.textContent = '';
                                this.style.background = '#fbbf24';
                                this.style.borderColor = '#fbbf24';
                                this.style.transform = 'scale(1.1)';
                            } else {
                                // Add punctuation
                                userAnswers[currentQuestionIndex].push(punctIndex);
                                
                                // Determine correct punctuation to show
                                let showPunctuation = question.punctuation;
                                if (question.punctuation === '()') {
                                    const correctPositions = question.positions || [];
                                    const isFirstPosition = correctPositions.length > 0 && punctIndex === correctPositions[0];
                                    showPunctuation = isFirstPosition ? '(' : ')';
                                }
                                
                                this.textContent = showPunctuation;
                                this.style.background = '#10b981';
                                this.style.borderColor = '#10b981';
                                this.style.transform = 'scale(1)';
                            }
                            
                            playSound('click');
                        });
                    } else {
                        // Regular word
                        wordSpan.textContent = word;
                        wordSpan.style.marginRight = '8px';
                    }
                    
                    sentenceDiv.appendChild(wordSpan);
                });
                
                optionsContainer.appendChild(sentenceDiv);
                
                // Add instruction
                const instructionDiv = document.createElement('div');
                instructionDiv.className = 'punctuate-instruction';
                instructionDiv.textContent = 'Tap the  symbols where you want to place the punctuation';
                instructionDiv.style.cssText = `
                    text-align: center;
                    color: #6b7280;
                    font-size: 0.9rem;
                    margin-top: 15px;
                    font-style: italic;
                `;
                optionsContainer.appendChild(instructionDiv);
                
            } else {
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'text-input';
                input.placeholder = 'Enter your answer here...';
                input.value = userAnswers[currentQuestionIndex];
                
                input.addEventListener('input', function() {
                    userAnswers[currentQuestionIndex] = this.value.trim();
                    
                    // Check for spelling feedback after a short delay
                    clearTimeout(window.spellingCheckTimeout);
                    window.spellingCheckTimeout = setTimeout(() => {
                        if (this.value.trim()) {
                            const correctAnswer = currentQuestions[currentQuestionIndex].answer;
                            
                            // Clear any existing feedback first
                            const existingFeedback = document.querySelector('.spelling-feedback');
                            if (existingFeedback) {
                                existingFeedback.remove();
                            }
                            
                            // Check if answer is correct and if there was a spelling suggestion
                            if (isAnswerCorrect(this.value.trim(), correctAnswer)) {
                                showSpellingFeedback();
                            }
                        }
                    }, 800); // Wait 800ms after user stops typing
                });
                
                optionsContainer.appendChild(input);
                setTimeout(() => input.focus(), 100);
            }
            
            updateQuizNavigation();
        }

        // Show AI Hint
        function showHint() {
            console.log(' showHint() called, hintsUsed:', hintsUsed, 'MAX_HINTS:', MAX_HINTS);
            
            // Check if hints limit reached
            if (hintsUsed >= MAX_HINTS) {
                console.log(' No hints left!');
                return; // Do nothing if no hints left
            }
            
            const question = currentQuestions[currentQuestionIndex];
            const hintBox = document.getElementById('hintBox');
            const hintText = document.getElementById('hintText');
            const hintBtn = document.getElementById('hintBtn');
            
            console.log(' Question hint:', question.hint);
            console.log(' hintBox element:', hintBox);
            console.log(' hintText element:', hintText);
            
            if (!question.hint) {
                console.log(' No hint available for this question');
                return;
            }
            
            hintText.textContent = question.hint;
            hintBox.style.display = 'block'; // Force display
            hintBox.classList.add('show');
            hintsUsed++;
            
            console.log(' Hint displayed:', question.hint);
            
            // Update hint button text with remaining hints
            const hintsLeft = MAX_HINTS - hintsUsed;
            if (hintsLeft > 0) {
                hintBtn.textContent = ` Hint (${hintsLeft})`;
                hintBtn.disabled = true; // Disable for current question
                hintBtn.style.opacity = '0.5';
            } else {
                hintBtn.textContent = ' No Hints Left';
                hintBtn.disabled = true;
                hintBtn.style.opacity = '0.3';
            }
            
            // Play sound feedback
            playSound('click');
        }

        // Update Quiz Navigation
        function updateQuizNavigation() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const finishBtn = document.getElementById('finishBtn');
            const hintBtn = document.getElementById('hintBtn');
            
            // Update Previous/Next buttons
            prevBtn.disabled = currentQuestionIndex === 0;
            
            // Update hint button based on remaining hints
            const hintsLeft = MAX_HINTS - hintsUsed;
            if (hintsLeft > 0) {
                hintBtn.disabled = false;
                hintBtn.style.opacity = '1';
                hintBtn.textContent = ` Hint (${hintsLeft})`;
            } else {
                hintBtn.disabled = true;
                hintBtn.style.opacity = '0.3';
                hintBtn.textContent = ' No Hints Left';
            }
            
            // Show/hide Next and Finish buttons
            if (currentQuestionIndex === currentQuestions.length - 1) {
                nextBtn.style.display = 'none';
                finishBtn.style.display = 'inline-block';
            } else {
                nextBtn.style.display = 'inline-block';
                finishBtn.style.display = 'none';
            }
        }

        // Previous Question
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        // Next Question
        function nextQuestion() {
            if (currentQuestionIndex < currentQuestions.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            }
        }

        // Back from Quiz (smart navigation)
        function backFromQuiz() {
            // Hide quiz container
            document.getElementById('quizContainer').style.display = 'none';
            
            // Show quiz type selection if we have selected year/subject, otherwise go to dashboard
            if (selectedYearLevel && selectedSubject) {
                document.getElementById('quizTypeContainer').style.display = 'block';
            } else {
                showDashboard();
            }
        }

        // Back to Dashboard
        function backToDashboard() {
            console.log(' Going back to dashboard');
            
            // Hide all containers
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('resultsContainer').style.display = 'none';
            document.getElementById('packSelectionContainer').style.display = 'none';
            document.getElementById('quizTypeContainer').style.display = 'none';
            document.getElementById('feedbackContainer').style.display = 'none';
            document.getElementById('questMapContainer').style.display = 'none';
            document.getElementById('yearLevelContainer').style.display = 'none';
            
            // Hide new gamification screens
            document.getElementById('rankProgressionContainer').style.display = 'none';
            document.getElementById('rewardsShopContainer').style.display = 'none';
            
            // Show dashboard
            showDashboard();
            
            playSound('click');
        }

        // Show Quest Map (Continue Main Quest)
        function showQuestMap() {
            console.log(' Showing Quest Map');
            
            // Hide dashboard and show quest map
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('questMapContainer').style.display = 'block';
            
            playSound('click');
        }

        // Show Year Level Selection (Practice Zone)
        function showYearSelection() {
            console.log(' Showing Year Level Selection');
            
            // Hide dashboard and show year level selection
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('yearLevelContainer').style.display = 'block';
            
            playSound('click');
        }

        // Start Quest Level (from Quest Map) - FULL VERSION: All 30 Levels Active
        function startQuestLevel(level) {
            console.log(` Starting Quest Level ${level} - FULL VERSION`);
            
            // FULL VERSION: All 30 levels are now active and playable
            if (level < 1 || level > 30) {
                alert('Invalid quest level!');
                return;
            }
            
            // Set quest mode variables  
            selectedQuestLevel = level;
            currentTopic = 'quest-level-' + level;
            userData.mode = 'quest'; // Ensure we're in quest mode for XP/Adventure Points
            
            // Select 10 questions from questBank for this level
            const startIndex = (level - 1) * 10; // Level 1: 0-9, Level 2: 10-19, etc.
            const endIndex = startIndex + 10;
            currentQuestions = questBank.slice(startIndex, endIndex);
            
            // Fallback if we don't have enough questions yet (during development)
            if (currentQuestions.length < 10) {
                // Use random questions from available questBank
                const shuffled = [...questBank].sort(() => 0.5 - Math.random());
                currentQuestions = shuffled.slice(0, 10);
            }
            
            console.log(` Level ${level}: Selected ${currentQuestions.length} questions`);
            
            // Initialize quiz variables
            currentQuestionIndex = 0;
            score = 0;
            userAnswers = [];
            questionsAnswered = 0;
            currentStreak = 0;
            
            // Hide quest map and start quiz
            document.getElementById('questMapContainer').style.display = 'none';
            startQuiz('quest-level-' + level);
            
            playSound('click');
        }

        // QUESTION BANK SEPARATION LOGIC
        // Quest Mode Bank: Gets first 12-13 questions from each subject (100 total)
        function getQuestModeQuestions(yearLevel, subject) {
            const questions = questionBank[yearLevel][subject];
            return questions.slice(0, 12); // First 12 questions for quest mode
        }

        // Practice Zone Bank: Gets last 13 questions from each subject (100 total) 
        function getPracticeZoneQuestions(yearLevel, subject) {
            const questions = questionBank[yearLevel][subject];
            return questions.slice(12, 25); // Last 13 questions for practice zone
        }

        // Generate Mixed Questions for Quest Mode
        function generateMixedQuestQuestions() {
            console.log(' Generating mixed quest questions for level', selectedQuestLevel);
            
            const allQuestions = [];
            
            // Progressive difficulty: Start with Year 5, gradually add Year 6
            if (selectedQuestLevel <= 2) {
                // Early levels: Mostly Year 5 Foundation
                const readingQuestions = getQuestModeQuestions('year5', 'reading').slice(0, 3);
                const grammarQuestions = getQuestModeQuestions('year5', 'grammar').slice(0, 4);
                const arithmeticQuestions = getQuestModeQuestions('year5', 'arithmetic').slice(0, 3);
                allQuestions.push(...readingQuestions, ...grammarQuestions, ...arithmeticQuestions);
            } else {
                // Later levels: Mix of Year 5 and Year 6
                const readingQuestions = getQuestModeQuestions('year6', 'reading').slice(0, 3);
                const grammarQuestions = getQuestModeQuestions('year6', 'grammar').slice(0, 4);
                const arithmeticQuestions = getQuestModeQuestions('year6', 'arithmetic').slice(0, 3);
                allQuestions.push(...readingQuestions, ...grammarQuestions, ...arithmeticQuestions);
            }
            
            // Shuffle the array
            for (let i = allQuestions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [allQuestions[i], allQuestions[j]] = [allQuestions[j], allQuestions[i]];
            }
            
            currentQuestions = allQuestions.slice(0, 10); // 10 mixed questions for quest
            console.log(` Generated ${currentQuestions.length} mixed quest questions for level ${selectedQuestLevel}`);
        }

        // Generate Questions for Practice Zone - FULL VERSION: Uses practiceBank
        function generatePracticeZoneQuestions(yearLevel, subject, questionCount) {
            console.log(` Generating ${questionCount} practice questions for ${subject} - FULL VERSION`);
            
            // FULL VERSION: Use the new practiceBank (200 questions total)
            // Map subject names to practiceBank keys
            const subjectMap = {
                'reading': 'reading',
                'grammar': 'grammar', 
                'arithmetic': 'arithmetic',
                'reasoning': 'reasoning'
            };
            
            const practiceSubject = subjectMap[subject];
            let questions = [];
            
            if (practiceSubject && practiceBank[practiceSubject]) {
                questions = practiceBank[practiceSubject];
            } else {
                console.warn(` No questions found for subject: ${subject}`);
                // Fallback to a random mix from practiceBank
                questions = Object.values(practiceBank).flat();
            }
            
            // Set Practice Mode (no XP/Adventure Points)
            userData.mode = 'practice';
            
            // Shuffle questions to provide variety
            const shuffled = [...questions];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            
            currentQuestions = shuffled.slice(0, questionCount);
            console.log(` Generated ${currentQuestions.length} practice zone questions (no XP/Adventure Points)`);
        }

        // Finish Quiz
        function finishQuiz() {
            // Score already calculated during immediate feedback
            showResults();
        }

        // Calculate Quiz Results
        function calculateResults() {
            score = 0;
            for (let i = 0; i < currentQuestions.length; i++) {
                const userAnswer = userAnswers[i];
                const correctAnswer = currentQuestions[i].answer;
                if (isAnswerCorrect(userAnswer, correctAnswer)) {
                    score++;
                }
            }
        }

        /**
         * Intelligently checks if a user's free-text answer contains key concepts
         * by matching against a list of keywords, rather than requiring exact matches.
         * 
         * @param {string} userAnswer - The free-text answer provided by the user
         * @param {array} keywords - Array of strings representing core concepts of correct answer
         * @returns {boolean} - True if any keyword is found, false if none match
         */
        function checkAnswer(userAnswer, keywords) {
            // Step 1: Input validation - ensure we have valid inputs
            if (!userAnswer || !keywords || !Array.isArray(keywords)) {
                return false;
            }
            
            // Step 2: Convert user answer to lowercase for case-insensitive matching
            let processedAnswer = userAnswer.toLowerCase();
            
            // Step 3: Remove basic punctuation that might interfere with keyword matching
            // This removes: . , ? ! ; : " ' ( ) - and extra spaces
            processedAnswer = processedAnswer.replace(/[.,?!;:"'()\-]/g, ' ');
            
            // Step 4: Clean up extra whitespace (replace multiple spaces with single space)
            processedAnswer = processedAnswer.replace(/\s+/g, ' ').trim();
            
            // Step 5: Iterate through each keyword in the array
            for (let i = 0; i < keywords.length; i++) {
                const keyword = keywords[i].toLowerCase(); // Ensure keyword is also lowercase
                
                // Step 6: Check if the processed answer contains this keyword
                if (processedAnswer.includes(keyword)) {
                    // Step 7: Return true immediately when first match is found
                    return true;
                }
            }
            
            // Step 8: If we've checked all keywords and found no matches, return false
            return false;
        }

        // Advanced answer validation with fuzzy matching, gentle corrections, and keyword matching
        function isAnswerCorrect(userAnswer, correctAnswer, question = null) {
            // Handle highlight questions - "Tap to Highlight" approach
            if (question && question.type === 'highlight') {
                const userSelections = Array.isArray(userAnswer) ? userAnswer.sort() : [];
                const correctWords = question.correctWords ? question.correctWords.map(w => w.toLowerCase()).sort() : [];
                
                console.log(' Highlight check - User selected:', userSelections, 'Correct words:', correctWords);
                
                // Check if arrays are identical
                if (userSelections.length !== correctWords.length) return false;
                return userSelections.every((word, index) => word === correctWords[index]);
            }
            
            // Handle punctuate questions - "Tap the Word" approach
            if (question && question.type === 'punctuate') {
                const userSelection = parseInt(userAnswer);
                const correctIndex = question.correctWordIndex;
                
                console.log(' Punctuation check - User selected word index:', userSelection, 'Correct index:', correctIndex);
                
                return userSelection === correctIndex;
            }
            
            // Convert both to lowercase and trim whitespace
            const user = userAnswer.toString().toLowerCase().trim();
            const correct = correctAnswer.toString().toLowerCase().trim();
            
            // Exact match - fastest check
            if (user === correct) return true;
            
            // NEW: Check if correctAnswer has keywords defined (enhanced keyword matching)
            if (typeof correctAnswer === 'object' && correctAnswer.keywords) {
                return checkAnswer(userAnswer, correctAnswer.keywords);
            }
            
            // Handle numeric answers with optional units
            const userNum = parseFloat(user);
            const correctNum = parseFloat(correct);
            
            if (!isNaN(userNum) && !isNaN(correctNum)) {
                // Check if numbers match regardless of units
                return Math.abs(userNum - correctNum) < 0.001;
            }
            
            // For text answers, try flexible matching (fallback for simple text)
            if (isNaN(userNum) && isNaN(correctNum)) {
                // Check if user answer contains the key words from correct answer
                const correctWords = correct.split(' ').filter(word => word.length > 2);
                const userWords = user.split(' ');
                
                // If any key word matches (or close match), accept it
                for (let correctWord of correctWords) {
                    for (let userWord of userWords) {
                        if (userWord === correctWord) return true;
                        
                        // Fuzzy matching for common misspellings
                        if (isFuzzyMatch(userWord, correctWord)) {
                            // Store spelling suggestion for feedback
                            window.lastSpellingSuggestion = {
                                typed: userWord,
                                correct: correctWord
                            };
                            return true;
                        }
                    }
                }
                
                // Check if user answer is a reasonable variation
                if (user.includes(correct) || correct.includes(user)) {
                    return true;
                }
            }
            
            return false;
        }

        // Fuzzy matching for common spelling mistakes
        function isFuzzyMatch(userWord, correctWord) {
            if (userWord.length < 3 || correctWord.length < 3) return false;
            
            // Calculate edit distance (Levenshtein distance simplified)
            const maxDistance = Math.floor(correctWord.length * 0.3); // Allow 30% error
            
            let distance = 0;
            let i = 0, j = 0;
            
            while (i < userWord.length && j < correctWord.length) {
                if (userWord[i] === correctWord[j]) {
                    i++;
                    j++;
                } else {
                    distance++;
                    if (distance > maxDistance) return false;
                    
                    // Try different error types
                    if (i + 1 < userWord.length && userWord[i + 1] === correctWord[j]) {
                        i += 2; j++; // deletion
                    } else if (j + 1 < correctWord.length && userWord[i] === correctWord[j + 1]) {
                        i++; j += 2; // insertion
                    } else {
                        i++; j++; // substitution
                    }
                }
            }
            
            distance += Math.abs(userWord.length - correctWord.length);
            return distance <= maxDistance;
        }

        // Show gentle spelling feedback when appropriate
        function showSpellingFeedback() {
            if (window.lastSpellingSuggestion) {
                const suggestion = window.lastSpellingSuggestion;
                const feedbackDiv = document.createElement('div');
                feedbackDiv.className = 'spelling-feedback';
                feedbackDiv.innerHTML = `
                    <span class="feedback-icon"></span>
                    <span class="feedback-text">Great answer! Just a quick tip on the spelling: it's '<strong>${suggestion.correct}</strong>'</span>
                `;
                
                // Show feedback briefly
                const questionContainer = document.querySelector('.question-container');
                questionContainer.appendChild(feedbackDiv);
                
                setTimeout(() => {
                    if (feedbackDiv.parentNode) {
                        feedbackDiv.remove();
                    }
                }, 3000);
                
                window.lastSpellingSuggestion = null;
            }
        }

        // Show Results (with Daily Quest Session Summary)
        function showResults() {
            // Hide quiz container
            document.getElementById('quizContainer').style.display = 'none';
            

            
            // Regular quiz results
            document.getElementById('resultsContainer').style.display = 'block';
            
            // Calculate quiz time
            const timeSpent = Math.round((Date.now() - quizStartTime) / 1000);
            const minutes = Math.floor(timeSpent / 60);
            const seconds = timeSpent % 60;
            const timeDisplay = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // Update results display
            const percentage = Math.round((score / currentQuestions.length) * 100);
            document.getElementById('finalScore').textContent = `${score}/${currentQuestions.length}`;
            document.getElementById('resultsMessage').textContent = percentage >= 80 ? 'Excellent work!' : percentage >= 60 ? 'Good job!' : 'Keep practicing!';
            document.getElementById('pointsEarned').textContent = score * 10;
            document.getElementById('timeSpent').textContent = timeDisplay;
            document.getElementById('accuracy').textContent = `${percentage}%`;
            
            // Update user data
            userData.totalPoints += score * 10;
            userData.quizzesCompleted++;
            
            // BLUEPRINT: Award XP and Adventure Points ONLY in Quest mode
            const isQuestMode = userData.mode === 'quest' || currentTopic === 'quest-mixed';
            
            if (isQuestMode) {
                console.log(' Quest Mode: Awarding XP and Adventure Points');
                
                // Award completion bonuses
                const completionXP = currentQuestions.length * 5; // 5 XP per question for completion
                const completionAdventurePoints = currentQuestions.length * 2; // 2 adventure points per question for completion
                addXP(completionXP);
                addAdventurePoints(completionAdventurePoints);
                
                // Bonus for high scores
                if (percentage >= 80) {
                    addXP(50); // Bonus XP for excellent performance
                    addAdventurePoints(25); // Bonus adventure points
                } else if (percentage >= 60) {
                    addXP(25); // Bonus XP for good performance
                    addAdventurePoints(10); // Bonus adventure points
                }
            } else {
                console.log(' Practice Mode: No XP or Adventure Points awarded (as per blueprint)');
            }
            
            saveUserData();
            
            // Update dashboard stats
            updateDashboard();
            
            // Show question review
            showQuestionReview();
        }



        // Show Question Review
        function showQuestionReview() {
            const reviewContainer = document.getElementById('questionReview');
            console.log(' Debug - reviewContainer:', reviewContainer);
            console.log(' Debug - currentQuestions length:', currentQuestions.length);
            console.log(' Debug - userAnswers length:', userAnswers.length);
            console.log(' Debug - userAnswers:', userAnswers);
            
            if (!reviewContainer) {
                console.error(' questionReview element not found!');
                return;
            }
            
            reviewContainer.innerHTML = '';
            
            currentQuestions.forEach((question, index) => {
                const userAnswer = userAnswers[index];
                const correctAnswer = question.answer;
                const isCorrect = isAnswerCorrect(userAnswer, correctAnswer);
                
                const reviewItem = document.createElement('div');
                reviewItem.className = `result-item ${isCorrect ? 'correct' : 'incorrect'}`;
                
                // Handle different answer formats (string vs object with keywords)
                let displayAnswer = correctAnswer;
                if (typeof correctAnswer === 'object' && correctAnswer.keywords) {
                    displayAnswer = correctAnswer.modelAnswer || correctAnswer.keywords.join(', ');
                }
                
                let answersHtml = '';
                if (isCorrect) {
                    answersHtml = `<div class="result-answer correct-answer"> Correct: ${userAnswer || 'No answer'}</div>`;
                } else {
                    answersHtml = `
                        <div class="result-answer incorrect-answer"> Your answer: ${userAnswer || 'No answer'}</div>
                        <div class="result-answer correct-answer"> Correct answer: ${displayAnswer}</div>
                    `;
                }
                
                reviewItem.innerHTML = `
                    <div class="result-question">Question ${index + 1}: ${question.question}</div>
                    <div class="result-answers">${answersHtml}</div>
                `;
                
                reviewContainer.appendChild(reviewItem);
                console.log(` Added review item ${index + 1}: ${question.question.substring(0, 50)}...`);
            });
            
            console.log(' Debug - Total review items created:', currentQuestions.length);
            console.log(' Debug - reviewContainer.children.length:', reviewContainer.children.length);
        }

        // Variables for immediate feedback system
        let currentStreak = 0;
        let questionsAnswered = 0;

        // Submit Answer for Immediate Feedback
        function submitAnswer() {
            const currentQuestion = currentQuestions[currentQuestionIndex];
            let userAnswer = '';
            
            // Get user answer based on question type
            if (currentQuestion.type === 'multiple') {
                const selectedOption = document.querySelector('input[name="answer"]:checked');
                if (!selectedOption) {
                    alert('Please select an answer before submitting.');
                    return;
                }
                userAnswer = selectedOption.value;
            } else if (currentQuestion.type === 'highlight') {
                // For highlight questions, the userAnswer is stored as an array of words
                const selectedWords = userAnswers[currentQuestionIndex] || [];
                if (selectedWords.length === 0) {
                    alert('Please highlight at least one word before submitting.');
                    return;
                }
                userAnswer = selectedWords; // Array of selected words
            } else if (currentQuestion.type === 'punctuate') {
                // For punctuate questions, the userAnswer is stored as an array of indices
                const selectedPositions = userAnswers[currentQuestionIndex] || [];
                if (selectedPositions.length === 0) {
                    alert('Please tap where the punctuation should go before submitting.');
                    return;
                }
                userAnswer = selectedPositions; // Array of selected positions
            } else {
                const inputElement = document.querySelector('.text-input');
                if (!inputElement || !inputElement.value.trim()) {
                    alert('Please enter an answer before submitting.');
                    return;
                }
                userAnswer = inputElement.value.trim();
            }
            
            // Store the answer
            userAnswers[currentQuestionIndex] = userAnswer;
            questionsAnswered++;
            

            
            // Check if answer is correct
            const isCorrect = isAnswerCorrect(userAnswer, currentQuestion.answer, currentQuestion);
            if (isCorrect) {
                score++;
                currentStreak++;
                
                // Award XP for correct answer
                addXP(10); // 10 XP per correct answer
                
                // Award adventure points for correct answer
                addAdventurePoints(5); // 5 adventure points per correct answer
            } else {
                currentStreak = 0;
                
                // Still award small XP for attempting (encouragement)
                addXP(2); // 2 XP for attempting even if wrong
            }
            
            // Show feedback
            showQuestionFeedback(isCorrect, userAnswer, currentQuestion);
        }

        // Show Immediate Question Feedback
        function showQuestionFeedback(isCorrect, userAnswer, question) {
            // Hide question container and show feedback
            document.querySelector('.question-container').style.display = 'none';
            document.getElementById('feedbackContainer').style.display = 'block';
            
            // Update feedback content
            const feedbackIcon = document.getElementById('feedbackIcon');
            const feedbackTitle = document.getElementById('feedbackTitle');
            const feedbackMessage = document.getElementById('feedbackMessage');
            const explanationText = document.getElementById('explanationText');
            const runningScore = document.getElementById('runningScore');
            const streakText = document.getElementById('streakText');
            const continueBtnText = document.getElementById('continueBtnText');
            
            if (isCorrect) {
                // Correct answer feedback
                feedbackIcon.textContent = '';
                feedbackTitle.textContent = 'Correct!';
                feedbackTitle.className = 'feedback-title correct';
                
                const encouragingMessages = [
                    'Great job! You got it right.',
                    'Excellent work!',
                    'Perfect! Well done.',
                    'Fantastic! You nailed it.',
                    'Outstanding! Keep it up.'
                ];
                feedbackMessage.textContent = encouragingMessages[Math.floor(Math.random() * encouragingMessages.length)];
                
                // Show explanation or hint as reinforcement
                explanationText.textContent = question.hint || 'You demonstrated great understanding!';
            } else {
                // Incorrect answer feedback
                feedbackIcon.textContent = '';
                feedbackTitle.textContent = 'Not quite right';
                feedbackTitle.className = 'feedback-title incorrect';
                feedbackMessage.textContent = "Don't worry! Let's learn from this.";
                
                // Show correct answer and explanation
                let correctDisplay = question.answer;
                let userDisplay = userAnswer;
                
                if (question.type === 'punctuate') {
                    // For punctuate questions, show the visual representation
                    const userPositions = Array.isArray(userAnswer) ? userAnswer : [];
                    const correctPositions = question.positions || [];
                    
                    userDisplay = userPositions.length > 0 ? 
                        `Placed ${question.punctuation} at ${userPositions.length} position(s)` : 
                        'No punctuation placed';
                        
                    correctDisplay = question.answer; // Show the full correct sentence
                } else if (typeof question.answer === 'object' && question.answer.keywords) {
                    correctDisplay = question.answer.modelAnswer || question.answer.keywords.join(', ');
                }
                
                explanationText.innerHTML = `
                    <strong>Your answer:</strong> ${userDisplay}<br>
                    <strong>Correct answer:</strong> ${correctDisplay}<br>
                    <strong>Tip:</strong> ${question.hint}
                `;
            }
            
            // Update running score
            runningScore.textContent = `${score}/${questionsAnswered}`;
            
            // Update streak display
            if (currentStreak >= 3) {
                streakText.textContent = ` ${currentStreak} in a row!`;
                streakText.style.display = 'block';
            } else if (currentStreak >= 2) {
                streakText.textContent = ` ${currentStreak} correct!`;
                streakText.style.display = 'block';
            } else {
                streakText.style.display = 'none';
            }
            
            // Update continue button text
            if (currentQuestionIndex >= currentQuestions.length - 1) {
                continueBtnText.textContent = 'Complete Quest ';
            } else {
                continueBtnText.textContent = `Continue Quest `;
            }
        }

        // Continue to Next Question
        function continueToNextQuestion() {
            // Hide feedback and show question container
            document.getElementById('feedbackContainer').style.display = 'none';
            
            if (currentQuestionIndex >= currentQuestions.length - 1) {
                // Quiz complete - show results
                finishQuiz();
            } else {
                // Move to next question
                currentQuestionIndex++;
                document.querySelector('.question-container').style.display = 'block';
                displayQuestion();
            }
        }

        // Modified displayQuestion to show submit button instead of navigation
        function displayQuestion() {
            const question = currentQuestions[currentQuestionIndex];
            
            // Update question number and progress
            document.getElementById('questionNumber').textContent = `Question ${currentQuestionIndex + 1}`;
            document.getElementById('quizProgressText').textContent = `Question ${currentQuestionIndex + 1} of ${currentQuestions.length}`;
            const progressPercentage = ((currentQuestionIndex + 1) / currentQuestions.length) * 100;
            document.getElementById('quizProgressFill').style.width = `${progressPercentage}%`;
            
            // Show passage if exists
            const passageElement = document.getElementById('passageText');
            if (question.passage) {
                passageElement.textContent = question.passage;
                passageElement.style.display = 'block';
            } else {
                passageElement.style.display = 'none';
            }
            
            // Display question text
            document.getElementById('questionText').textContent = question.question;
            
            // Clear previous answers and show options
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            if (question.type === 'multiple') {
                question.options.forEach((option, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'option';
                    optionDiv.innerHTML = `
                        <input type="radio" id="option${index}" name="answer" value="${option}">
                        <label for="option${index}">${option}</label>
                    `;
                    optionsContainer.appendChild(optionDiv);
                });
            } else {
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'text-input';
                input.placeholder = 'Enter your answer here...';
                input.value = userAnswers[currentQuestionIndex] || '';
                optionsContainer.appendChild(input);
            }
            
            // Reset submit button
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = false;
            submitBtn.textContent = 'Submit Answer';
            
            // Show submit section
            document.getElementById('submitSection').style.display = 'block';
            
            // Hide hint initially and reset hint button
            const hintBox = document.getElementById('hintBox');
            hintBox.style.display = 'none';
            hintBox.classList.remove('show');
            document.getElementById('hintText').textContent = ''; // Clear hint text
            
            // Reset hint button for new question
            const hintBtn = document.getElementById('hintBtn');
            const hintsLeft = MAX_HINTS - hintsUsed;
            if (hintsLeft > 0) {
                hintBtn.textContent = ` Hint (${hintsLeft})`;
                hintBtn.disabled = false;
                hintBtn.style.opacity = '1';
            } else {
                hintBtn.textContent = ' No Hints Left';
                hintBtn.disabled = true;
                hintBtn.style.opacity = '0.3';
            }
        }

        // Test function for keyword matching system (for development/debugging)
        function testKeywordSystem() {
            console.log(' Testing Enhanced Keyword Matching System:');
            
            // Test Case 1: Fox question
            const foxKeywords = ['pause', 'stop', 'wait', 'rest', 'halt', 'still'];
            console.log('Test 1 - Fox paused:', checkAnswer("It paused under the tree", foxKeywords)); // Should be true
            console.log('Test 2 - Fox stopped:', checkAnswer("The fox stopped", foxKeywords)); // Should be true  
            console.log('Test 3 - Fox waited:', checkAnswer("it was waiting there", foxKeywords)); // Should be true
            console.log('Test 4 - Wrong answer:', checkAnswer("The fox ran away", foxKeywords)); // Should be false
            
            // Test Case 2: Hunting question
            const huntingKeywords = ['search', 'silent hunter', 'movement', 'focused', 'scan'];
            console.log('Test 5 - Searching:', checkAnswer("It was searching for prey", huntingKeywords)); // Should be true
            console.log('Test 6 - Silent hunter:', checkAnswer("The text calls it a silent hunter", huntingKeywords)); // Should be true
            console.log('Test 7 - Focused behavior:', checkAnswer("The fox remained focused", huntingKeywords)); // Should be true
            console.log('Test 8 - Wrong answer:', checkAnswer("It was just walking around", huntingKeywords)); // Should be false
            
            console.log(' Keyword system test complete!');
        }

        // Settings Management Functions
        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            const isOpen = panel.classList.contains('open');
            
            if (isOpen) {
                panel.classList.remove('open');
                panel.setAttribute('aria-hidden', 'true');
            } else {
                panel.classList.add('open');
                panel.setAttribute('aria-hidden', 'false');
                panel.focus();
            }
            
            playSound('click');
        }

        function changeFontFamily(font) {
            settings.fontFamily = font;
            document.body.className = document.body.className.replace(/font-\w+/g, '');
            document.body.classList.add(`font-${font}`);
            
            // Update active button
            document.querySelectorAll('[data-font]').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-font="${font}"]`).classList.add('active');
            
            saveSettings();
            playSound('success');
        }

        function changeFontSize(size) {
            settings.fontSize = size;
            document.body.className = document.body.className.replace(/text-\w+/g, '');
            document.body.classList.add(`text-${size}`);
            
            // Update active button
            document.querySelectorAll('[data-size]').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-size="${size}"]`).classList.add('active');
            
            saveSettings();
            playSound('success');
        }

        function changeLineHeight(height) {
            settings.lineHeight = height;
            document.body.className = document.body.className.replace(/leading-\w+/g, '');
            document.body.classList.add(`leading-${height}`);
            
            // Update active button
            document.querySelectorAll('[data-height]').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-height="${height}"]`).classList.add('active');
            
            saveSettings();
            playSound('success');
        }

        function changeTheme(theme) {
            settings.theme = theme;
            if (theme === 'default') {
                document.body.removeAttribute('data-theme');
            } else {
                document.body.setAttribute('data-theme', theme);
            }
            
            // Force style recalculation
            document.body.style.display = 'none';
            document.body.offsetHeight; // Trigger reflow
            document.body.style.display = '';
            
            // Update active button
            document.querySelectorAll('[data-theme]').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-theme="${theme}"]`).classList.add('active');
            
            saveSettings();
            playSound('success');
        }

        function toggleSounds() {
            soundsEnabled = !soundsEnabled;
            settings.soundsEnabled = soundsEnabled;
            
            const toggle = document.getElementById('soundToggle');
            const container = toggle.parentElement;
            
            if (soundsEnabled) {
                toggle.classList.add('active');
                container.classList.add('active');
                container.setAttribute('aria-pressed', 'true');
            } else {
                toggle.classList.remove('active');
                container.classList.remove('active');
                container.setAttribute('aria-pressed', 'false');
            }
            
            saveSettings();
            if (soundsEnabled) playSound('success');
        }

        function changeVolume(value) {
            volume = value / 100;
            settings.volume = value;
            document.getElementById('volumeValue').textContent = value + '%';
            saveSettings();
        }

        function resetApp() {
            // Confirm before resetting
            if (confirm('Are you sure you want to restart? This will clear ALL your progress, achievements, and streak data.')) {
                // Clear all localStorage data
                localStorage.removeItem('satsUserData');
                localStorage.removeItem('satsSettings');
                
                // Play sound effect
                playSound('click');
                
                // Close settings panel
                toggleSettings();
                
                // Reset all variables to default
                userData = {
                    name: '',
                    totalPoints: 0,
                    quizzesCompleted: 0,
                    topicScores: {},
                    achievements: [],
                    level: 1,
                    startTime: null,
                    lastLoginDate: null,
                    // New Gamification Fields
                    totalXP: 0,
                    adventurePoints: 0,
                    ownedItems: []
                };
                
                // Reset settings to default
                settings = {
                    fontFamily: 'inter',
                    fontSize: 'normal', 
                    lineHeight: 'relaxed',
                    theme: 'default',
                    soundsEnabled: true,
                    volume: 50
                };
                
                // Apply default settings
                applySettings();
                
                // Show welcome screen
                showWelcomeScreen();
                
                // Clear name input
                document.getElementById('userName').value = '';
                
                alert('App has been reset! Please enter your name to start fresh.');
            }
        }

        function saveSettings() {
            localStorage.setItem('satsSettings', JSON.stringify(settings));
        }

        function loadSettings() {
            const saved = localStorage.getItem('satsSettings');
            if (saved) {
                settings = { ...settings, ...JSON.parse(saved) };
                applySettings();
            }
        }

        function applySettings() {
            changeFontFamily(settings.fontFamily);
            changeFontSize(settings.fontSize);
            changeLineHeight(settings.lineHeight);
            changeTheme(settings.theme);
            
            soundsEnabled = settings.soundsEnabled;
            if (!soundsEnabled) {
                document.getElementById('soundToggle').classList.remove('active');
                document.querySelector('.sound-toggle').classList.remove('active');
            }
            
            volume = settings.volume / 100;
            document.getElementById('volumeSlider').value = settings.volume;
            document.getElementById('volumeValue').textContent = settings.volume + '%';
        }

        // Audio Context for Sound Effects
        let audioContext = null;

        // Sound Effects
        function playSound(type) {
            if (!soundsEnabled) return;
            
            try {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                const frequencies = {
                    'click': 800,
                    'success': 1000,
                    'error': 400,
                    'achievement': 1200,
                    'complete': 1500
                };
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(frequencies[type] || 800, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume * 0.1, audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.2);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.2);
            } catch (e) {
                console.log('Audio not supported');
            }
        }

        // Retry Quiz - restart the same quiz type and subject
        function retryQuiz() {
            // Determine quiz type based on number of questions
            const quizType = currentQuestions.length <= 10 ? 'quick' : 'full';
            startQuiz(quizType);
        }

        // Utility Functions
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Show Level Progress (Apprentice Scholar button)
        function showLevelProgress() {
            const currentPoints = userData.totalPoints;
            const currentLevel = Math.floor(currentPoints / 100) + 1;
            const pointsInCurrentLevel = currentPoints % 100;
            const pointsToNextLevel = 100 - pointsInCurrentLevel;
            
            let message = `${getQuestRank(currentLevel)}\n\n`;
            message += ` Quest Progress:\n   ${pointsInCurrentLevel}/100 adventure points\n\n`;
            message += ` Next Rank:\n   ${getNextQuestRank(currentLevel)}\n\n`;
            message += ` Points Needed:\n   ${pointsToNextLevel} more adventure points\n\n`;
            message += `------------------------------------\n\n`;
            message += ` HOW TO ADVANCE:\n`;
            message += `    Complete quiz challenges\n`;
            message += `    Each correct answer = 10 points\n`;
            message += `    Unlock new quest ranks!`;
            
            alert(message);
        }
    </script>
</body>
</html>